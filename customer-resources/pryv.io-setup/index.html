<!DOCTYPE html><html class="no-js" lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="description" property="og:description" content="Pryv API reference and resources for developers"><meta name="author" content="Pryv SA"><meta property="og:type" content="website"><meta name="image" property="og:image" content="/assets/images/logo-256.png"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Pryv.io platform setup guide | Pryv API</title><link rel="icon" href="/assets/images/favicon-black.ico" type="image/x-icon"><link rel="apple-touch-icon" sizes="120x120" href="/assets/images/apple-touch-icon-120x120-black.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/images/apple-touch-icon-152x152-black.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon-180x180-black.png"><!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]--><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:400,300,500,700,400italic|Roboto+Condensed:400,300,700"><link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/docco.min.css"><link rel="stylesheet" type="text/css" href="/assets/fonts/ss-gizmo.min.css"><link rel="stylesheet" type="text/css" href="/assets/style.css"></head><body class="pryv.io-setup with-toc"><header id="page-header"><nav class="navbar navbar-default navbar-fixed-top" role="navigation"><div class="container-fluid"><div class="navbar-header"><a class="navbar-brand logo pryv-home" href="https://pryv.com" title="Pryv home"><img src="/assets/images/icon-home.svg" alt="Pryv home" height="50"></a><a class="navbar-brand logo" href="/" title="Developers home"><img src="/assets/images/logo-256-black.png" alt="Developers home"></a><button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#main-nav"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div><div class="collapse navbar-collapse" id="main-nav"><ul class="nav navbar-nav"><li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">Guides <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="/getting-started/">Getting started</a></li><li><a href="/external-resources/">Apps &amp; Libs</a></li><li><a href="/concepts/">API concepts</a></li><li><a href="/guides/data-modelling/">Data modelling</a></li><li><a href="/guides/webhooks/">Webhooks</a></li><li><a href="/guides/custom-auth/">Custom auth</a></li><li><a href="/guides/consent/">Consent request</a></li><li><a href="/guides/app-guidelines/">App guidelines</a></li><li><a href="/guides/audit-logs/">Audit logs</a></li></ul></li><li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">Reference <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="/reference/">API reference</a></li><li><a href="/reference-admin/">Admin API reference</a></li><li><a href="/reference-system/">System API reference</a></li><li><a href="/event-types/">Event types</a></li><li><a href="/open-api/">Open API (Postman)</a></li><li><a href="/change-log/">API change log</a></li></ul></li><li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">FAQ <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="/faq-api/">API</a></li><li><a href="/faq-infra/">Infrastructure</a></li></ul></li><li><a href="https://github.com/pryv/open-pryv.io">Open Pryv.io</a></li><li><a href="/customer-resources/">Entreprise</a></li><li><a href="/roadmap/">Roadmap</a></li></ul><div class="navbar-right"><p class="navbar-text version"><a href="/change-log/" title="View change log">API version: <strong>1.8.0</strong></a></p></div></div></div></nav></header><div class="container container-narrow" id="main-wrapper"><div id="main"><h1 class="page-title" id="pryvio-platform-setup-guide"><!--pryvio-platform-setup-guide-->Pryv.io platform setup guide</h1><p>This guide, addressed to IT operators, walks you through the different steps that have to be performed in order to set up your Pryv.io platform.</p>
<h2 id="table-of-contents-"><!--table-of-contents--->Table of contents <!-- omit in toc --></h2>
<ol>
<li><a href="#set-up-the-machines">Set up the machines</a></li>
<li><a href="#obtain-a-domain-name">Obtain a domain name</a>
<ol>
<li><a href="#expose-the-pryvio-api-on-a-second-level-domain">Expose the Pryv.io API on a second-level domain</a></li>
<li><a href="#verify">Verify</a></li>
</ol>
</li>
<li><a href="#obtain-the-license-key-credentials-and-configuration-files">Obtain the license key, credentials and configuration files</a></li>
<li><a href="#set-the-platform-parameters">Set the platform parameters</a></li>
<li><a href="#obtain-an-ssl-certificate">Obtain an SSL certificate</a></li>
<li><a href="#validate-your-platform-installation">Validate your platform installation</a></li>
<li><a href="#set-up-the-platform-health-monitoring">Set up the platform health monitoring</a></li>
<li><a href="#customize-authentication-registration-and-reset-password-apps">Customize authentication, registration and reset password apps</a>
<ol>
<li><a href="#gh-pages">GH pages</a></li>
<li><a href="#your-own-server">Your own server</a></li>
</ol>
</li>
<li><a href="#set-up-email-sending">Set up email sending</a></li>
<li><a href="#define-your-data-model">Define your data model</a></li>
<li><a href="#customize-event-types-validation">Customize event types validation</a></li>
<li><a href="#other-documents">Other documents</a></li>
</ol>
<h2 id="set-up-the-machines"><!--set-up-the-machines-->Set up the machines</h2>
<p>You need first to define which hardware or virtual machines you will provision to host your Pryv.io instance.</p>
<p>The <strong>Infrastructure procurement guide</strong> for Pryv.io from the <a href="/customer-resources/infrastructure-procurement/">Customer Resources page</a> will guide you for the provisioning and deployment of your machines.</p>
<p>It will help you with the choice of your Pryv.io deployment (single node or cluster), and provide you with resources sizing considerations.</p>
<p>The system requirements for each machine are also specified.</p>
<h2 id="obtain-a-domain-name"><!--obtain-a-domain-name-->Obtain a domain name</h2>
<p>Now that your machines are ordered, you need to register your own domain name.</p>
<p>You can either:</p>
<ul>
<li>obtain one yourself through a domain name registrar of your choice, make sure that you can configure your domain&#x2019;s <strong>DNS zone</strong>, including records of type A &amp; NS for subdomains.</li>
<li>or contact us directly to obtain a pryv.io subdomain, e.g. <strong><em>your-platform-name</em>.pryv.io</strong></li>
</ul>
<p>You will have to define the following DNS Records:</p>
<pre><code>dns1-pryv 1800 IN A ${YOUR-REG-MASTER-IP-ADDRESS}
dns2-pryv 1800 IN A ${YOUR-REG-SLAVE-IP-ADDRESS}
pryv 1800 IN NS dns1-pryv.${YOUR-DOMAIN}.
pryv 1800 IN NS dns2-pryv.${YOUR-DOMAIN}.
</code></pre>
<ul>
<li><strong>If you have a <a href="/customer-resources/infrastructure-procurement/#cluster-with-a-single-core">single register machine</a></strong>, you can repeat the reg-master&#x2019;s IP address instead of the reg-slave one.</li>
<li><strong>If you have a <a href="/customer-resources/infrastructure-procurement/#single-node-mode">single-node setup</a></strong>, you can use the machine&#x2019;s IP address instead of the register IP addresses.</li>
</ul>
<p>Your Pryv.io platform domain will then be <code>pryv.${YOUR-DOMAIN}</code>. For other environments such as staging, we suggest to define a similar subdomain:</p>
<pre><code>dns1-pryv-staging 1800 IN A ${YOUR-REG-MASTER-IP-ADDRESS}
dns2-pryv-staging 1800 IN A ${YOUR-REG-SLAVE-IP-ADDRESS}
pryv-staging 1800 IN NS dns1-pryv.${YOUR-DOMAIN}.
pryv-staging 1800 IN NS dns2-pryv.${YOUR-DOMAIN}.
</code></pre>
<h3 id="expose-the-pryvio-api-on-a-second-level-domain"><!--expose-the-pryvio-api-on-a-second-level-domain-->Expose the Pryv.io API on a second-level domain</h3>
<p>Using the aforementioned steps, your Pryv.io API will be exposed under a subdomain like <code>pryv.${YOUR-DOMAIN}</code>. If you wish to expose it on a <em>second-level domain</em> such as <code>my-pryv-domain.io</code>, you will have to:</p>
<ul>
<li>obtain a domain name through a registrar that allows to <strong>change name servers</strong></li>
<li>use a second domain to define Type A DNS records pointing to your machine that you will provide as name servers by your registrar for your Pryv.io domain</li>
</ul>
<p>Second domain DNS Zone <code>${SECOND-DOMAIN}</code>:</p>
<pre><code>dns1-pryv 1800 IN A ${YOUR-REG-MASTER-IP-ADDRESS}
dns2-pryv 1800 IN A ${YOUR-REG-SLAVE-IP-ADDRESS}
</code></pre>
<p>You will then define name servers for your Pryv.io domain as:</p>
<ul>
<li><code>dns1-pryv.${SECOND-DOMAIN}</code></li>
<li><code>dns2-pryv.${SECOND-DOMAIN}</code></li>
</ul>
<h3 id="verify"><!--verify-->Verify</h3>
<p>If your domain is set up correctly, the following command should yield the hostname of the machine(s) you intend to use as a Pryv.io Register server:</p>
<pre><code>dig NS +trace +nodnssec ${DOMAIN}
</code></pre>
<p>This command should yield the hostnames you have set for the name servers of your Pryv.io domain in the last block as:</p>
<pre><code>${YOUR-DOMAIN}.		SOME_TTL_VALUE	IN	NS	dns1-pryv.${YOUR-DOMAIN}.
${YOUR-DOMAIN}.		SOME_TTL_VALUE	IN	NS	dns2-pryv.${YOUR-DOMAIN}.
</code></pre>
<h2 id="obtain-the-license-key-credentials-and-configuration-files"><!--obtain-the-license-key-credentials-and-configuration-files-->Obtain the license key, credentials and configuration files</h2>
<p>In order to be able to run your Pryv.io instance, you will need to get a license key for your platform from Pryv and the credentials to pull the Docker images defined in the configuration files, which you can download <a href="https://api.pryv.com/config-template-pryv.io/">here</a>.</p>
<h2 id="set-the-platform-parameters"><!--set-the-platform-parameters-->Set the platform parameters</h2>
<p>Along with the configuration files, you will find an Installation guide describing where to unpack them and how to set the platform variables.</p>
<h2 id="obtain-an-ssl-certificate"><!--obtain-an-ssl-certificate-->Obtain an SSL certificate</h2>
<p>You will need to obtain a wildcard SSL certificate for *.DOMAIN to enable encryption to the platform&#x2019;s API. For this, you can either obtain one from your hosting provider, or generate one <a href="/customer-resources/ssl-certificate/">using Let&#x2019;s Encrypt</a>.</p>
<p>If you are using an infrastructure with appliances that perform the SSL termination, you can simply adapt the NGINX configuration files to listen on port 80 and not perform encryption.</p>
<h2 id="validate-your-platform-installation"><!--validate-your-platform-installation-->Validate your platform installation</h2>
<p>Now that your Pryv.io platform is configured and running, you can run the validation procedure from the <a href="/customer-resources/platform-validation">Pryv.io platform validation guide</a>.</p>
<p>It will walk you through the validation steps of your platform and contains a troubleshooting part in case of issue.</p>
<h2 id="set-up-the-platform-health-monitoring"><!--set-up-the-platform-health-monitoring-->Set up the platform health monitoring</h2>
<p>You can monitor its status by setting up regular healthcheck API calls to the Pryv.io API.</p>
<p>The procedure for the platform health monitoring is described in the <a href="/customer-resources/healthchecks">Pryv.io Healthchecks guide</a>.</p>
<h2 id="customize-authentication-registration-and-reset-password-apps"><!--customize-authentication-registration-and-reset-password-apps-->Customize authentication, registration and reset password apps</h2>
<p>In order to perform the <a href="/reference/#authenticate-your-app">authentication procedure</a>, a web page is necessary. We deliver Pryv.io platforms with a web app for this as well as for other functions such as registration and password reset. You can find the code repository on <a href="https://github.com/pryv/app-web-auth3">github.com/pryv/app-web-auth3</a>.</p>
<p>In order to customize your own, we suggest that you fork this repository and host the web app on your environment. The easiest way to begin is to fork it on GitHub and host it using GitHub-pages.</p>
<p>To use your own page, you will have to update the following platform variables:</p>
<ul>
<li>TRUSTED_AUTH_URLS</li>
<li>TRUSTED_APPS</li>
<li>PASSWORD_RESET_URL</li>
<li>DEFAULT_AUTH_URL (optional)</li>
</ul>
<p>You will then need to provide your web page&#x2019;s URL in the <a href="/reference/#auth-request">Auth request</a> <code>authUrl</code> parameter, or if you want to make it default, change the <code>DEFAULT_AUTH_URL</code> in the platform variables.</p>
<p>Or if you wish to proxy your custom app-web-auth3 app through the <code>https://sw.DOMAIN/access/...</code> URL, you will only need to change the <code>APP_WEB_AUTH_URL</code> instead of all other changes.</p>
<h3 id="gh-pages"><!--gh-pages-->GH pages</h3>
<p>Make sure to implement the <a href="https://github.com/pryv/app-web-auth3/blob/master/README.md#fork-repository-for-github-pages">following change</a> on your fork.</p>
<p>If you are hosting it on GitHub pages, you will need to adapt the platform variables as following:</p>
<pre><code class="language-yaml">  TRUSTED_APPS: &quot;*@https://*.DOMAIN*, *@https://pryv.github.io*, *@https://YOUR-GITHUB-ACCOUNT.github.io*&quot;
  TRUSTED_AUTH_URLS:
    - &quot;https://sw.DOMAIN/access/access.html&quot;
    - &quot;https://YOUR-GITHUB-ACCOUNT.github.io/app-web-auth3/access/access.html&quot;
  PASSWORD_RESET_URL: &quot;https://YOUR-GITHUB-ACCOUNT.github.io/app-web-auth3/access/reset-password.html&quot;
</code></pre>
<p>If you wish to make it default, set:</p>
<pre><code class="language-yaml">  DEFAULT_AUTH_URL: &quot;https://YOUR-GITHUB-ACCOUNT.github.io/app-web-auth3/access/access.html&quot;
</code></pre>
<p>or if you wish to proxy it through <code>https://sw.DOMAIN/access/</code>, <strong>only</strong> set:</p>
<pre><code class="language-yaml">  APP_WEB_AUTH_URL: &quot;https://YOUR-GITHUB-ACCOUNT.github.io/app-web-auth3/&quot;
</code></pre>
<h3 id="your-own-server"><!--your-own-server-->Your own server</h3>
<p>If you are hosting it on your own server, you will need to adapt the platform variables as following:</p>
<pre><code class="language-yaml">  TRUSTED_APPS: &quot;*@https://*.DOMAIN*, *@https://pryv.github.io*, *@https://YOUR-SERVER-DOMAIN*&quot;
  TRUSTED_AUTH_URLS:
    - &quot;https://sw.DOMAIN/access/access.html&quot;
    - &quot;https://YOUR-SERVER-URL/access/access.html&quot;
  PASSWORD_RESET_URL: &quot;https://YOUR-SERVER-URL/access/reset-password.html&quot;
</code></pre>
<p>If you wish to make it default, set:</p>
<pre><code class="language-yaml">  DEFAULT_AUTH_URL: &quot;https://YOUR-SERVER-URL/access/access.html&quot;
</code></pre>
<p>or if you wish to proxy it through <code>https://sw.DOMAIN/access/</code>, <strong>only</strong> set:</p>
<pre><code class="language-yaml">  APP_WEB_AUTH_URL: &quot;https://YOUR-SERVER-URL/&quot;
</code></pre>
<h2 id="set-up-email-sending"><!--set-up-email-sending-->Set up email sending</h2>
<p>Pryv.io allows to send emails in two situations:</p>
<ul>
<li>Account creation,</li>
<li>Password reset requests.</li>
</ul>
<p>You might want to install and configure the sending of emails in these situations. You can do so by either using your SMTP server, or Sendmail.</p>
<p>In both cases, you will need to customize settings in the &#x201C;Email configuration&#x201D; section of the platform parameters file.</p>
<p>You can also customize the email templates in the configuration files.</p>
<p>More details are provided in the <a href="/customer-resources/emails-setup/">email configuration guide</a>.</p>
<h2 id="define-your-data-model"><!--define-your-data-model-->Define your data model</h2>
<p>As your Pryv.io platform is fully operational, you can start collecting data.</p>
<p>To do so, you need to design the data model your app(s) will use using Pryv&#x2019;s data structures: <strong>streams</strong> and <strong>events</strong>.</p>
<p>You can have a look at our <a href="/guides/data-modelling/">Data modelling guide</a> which describes the Pryv.io data structure and walks you through different use cases for your data model. We provide you with an <a href="https://docs.google.com/spreadsheets/d/1UUb94rovSegFucEUtl9jcx4UcTAClfkKh9T2meVM5Zo/edit#gid=0">Excel template</a> file describing a basic use case.</p>
<p>We advise you to build your own file based on this template to describe your own data structure (streams, events, permissions) depending on your use case.</p>
<p>We can also help you with the design and validation of your data model.</p>
<h2 id="customize-event-types-validation"><!--customize-event-types-validation-->Customize event types validation</h2>
<p>Your Pryv.io platform performs content validation for the types definition that you provide it. Events with undefined types are allowed but their content is not validated.</p>
<p>See the <a href="/event-types/">Event Types</a> page for more information.</p>
<p>You can host your definitions page on a public URL which will be loaded at the platform boot. You can define this URL in the platform parameters as following:</p>
<pre><code class="language-yaml">EVENT_TYPES_URL: &quot;https://api.pryv.com/event-types/flat.json&quot;
</code></pre>
<h2 id="other-documents"><!--other-documents-->Other documents</h2>
<p>More resources can be found in our <a href="/customer-resources/#guides-and-documents">customer resources page</a>, or in the <a href="/faq-infra/">FAQ</a>.</p>
</div><nav id="toc"></nav></div><footer id="page-footer"><nav class="navbar navbar-default"><div class="container-fluid"><div id="footer-nav"><ul class="nav navbar-nav"><li><a href="mailto:developers@pryv.com">Send a message</a></li><li><a href="https://github.com/pryv">GitHub</a></li><li><a href="https://pryv.com">pryv.com</a></li></ul></div></div></nav></footer><script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script><script src="/assets/bootstrap.min.js"></script><script src="/assets/js/toc.min.js"></script><!-- TOC generation--><script>jQuery(document).ready(function($) {
  // Header is about 51 pixels. This equals to 'header + fuzz', fuzz was
  // determined experimentally.
  var offset = 90;

  // Display TOC on the left side of the page.
  $('#toc').toc({
    selector: '#main h1:not(.page-title),#main h2,#main h3',
    ulClass: 'nav'
  });

  // Synchronise scroll/click motion with TOC display.
  $(document).ready(function() {
    // NOTE This is done at onLoad since we need to wait for all CSS
    // to appear.
    $('body').scrollspy({
      target: '#toc',
      offset: offset
    });
    scrollBy(0, 1); // make it scroll to be sure scrollspy gets it
    
    // fix offset when navigating
    $('#toc li a, a.toc-anchor').click(function (e) {
      e.preventDefault();
      var target = $(this).attr('href');
      window.location.hash = target;
      
      $(target)[0].scrollIntoView();
      if ($(window).scrollTop() + $(window).height() !== $(document).height()) {
        //only adjust when not at bottom
        scrollBy(0, -offset + 40);
      }
      return true;
    });
  
  });
});
</script><!-- Code blocks highlighting--><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();
</script><!-- Google Analytics--><script>var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-36589447-2']);
_gaq.push(['_trackPageview']);
(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></body></html>