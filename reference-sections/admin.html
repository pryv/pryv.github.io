<html><head></head><body><h1>Administration methods</h1>
<p>Administration methods allow to manage the user's <a href="#admin-user">account information</a>, <a href="#admin-channels">activity channels</a> and <a href="#admin-accesses">sharing</a> (via accesses).


</p>
<h2>Authorization</h2>
<p>Access to admin methods is managed by sessions. To create a session, you must successfully authenticate with a <code>/admin/login</code> request, which will return the session ID. Each request sent during the duration of the session must then contain the session ID in its <code>Authorization</code> header or, alternatively, in the query string's <code>auth</code> parameter. The session is terminated when <code>/admin/logout</code> is called or when the session times out (TODO: indicate session timeout delay).

</p>
<p>Here's what an admin request (with a session open) looks like:
</p>
<pre class="highlighted"><code class="language-http"><span class="request">GET <span class="string">/admin/accesses</span> HTTP/1.1</span>
<span class="attribute">Host</span>: <span class="string">cassis.pryv.io</span>
<span class="attribute">Authorization</span>: <span class="string">{session-id}</span></code></pre>
<p>Or, alternatively, passing the access token in the query string:
</p>
<pre class="highlighted"><code class="language-http"><span class="request">GET <span class="string">/admin/accesses?auth={session-id}</span> HTTP/1.1</span>
<span class="attribute">Host</span>: <span class="string">cassis.pryv.io</span></code></pre>
<h2>Common errors</h2>
<p>TODO: review and complete

</p>
<ul>
<li><code>400 Bad Request</code>, id <code>INVALID_PARAMETERS_FORMAT</code>: The request's parameters do not follow the expected format.</li>
<li><code>401 Unauthorized</code>, id <code>INVALID_CREDENTIALS</code>: User credentials are missing or invalid.</li>
<li><code>404 Not Found</code>, possible cases:<ul>
<li>Id <code>UNKNOWN_ACCESS</code>: The data access can't be found.</li>
<li>Id <code>UNKNOWN_CHANNEL</code>: The activity channel can't be found.</li>
</ul>
</li>
</ul>
<h2><a id="admin-session"></a>Session management</h2>
<h3>POST <code>/admin/login</code></h3>
<p>Opens a new admin session, authenticating with the provided credentials. TODO: possible support for OAuth/OpenID/BrowserID (for now, only local credentials are supported).

</p>
<h4>Body parameters</h4>
<ul>
<li><code>username</code> (string)</li>
<li><code>password</code> (string)</li>
<li><code>appId</code> (string): A URL-friendly name uniquely identifying your app. The value you provide is in any case slugified before use (see <a href="https://github.com/dodo/node-slug/blob/master/src/slug.coffee">how</a>).</li>
</ul>
<h4>Successful response: <code>200 OK</code></h4>
<ul>
<li><code>sessionID</code> (string): The newly created session's ID, to include in each subsequent request's <code>Authorization</code> header.</li>
</ul>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">curl -i -H <span class="string">"Content-Type: application/json"</span> -X POST -d <span class="string">'{"username":"{username}","password":"{password}","appId":"{appId}"}'</span> https://{username}.pryv.io/admin/login</code></pre>
<h3>POST <code>/admin/logout</code></h3>
<p>Terminates the admin session.

</p>
<h4>Successful response: <code>200 OK</code></h4>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">curl -i -H <span class="string">"Content-Type: application/json"</span> -H <span class="string">"Authorization: {session-id}"</span> -X POST -d <span class="string">"{}"</span> https://{username}.pryv.io/admin/logout</code></pre>
<h2><a id="admin-user"></a>User information</h2>
<h3>GET <code>/admin/user-info</code></h3>
<p>TODO: get user informations
Requires session token.

</p>
<h4>Successful response: <code>200 OK</code></h4>
<p>TODO: email, display name, language, ...

</p>
<h4>Successful response: <code>200 OK</code></h4>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">curl -i -H <span class="string">"Authorization: {session-id}"</span> https://{username}.pryv.io/admin/user-info</code></pre>
<h3>PUT <code>/admin/user-info</code></h3>
<p>TODO: change user information

</p>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
<h3>POST <code>/admin/change-password</code></h3>
<p>TODO: change user password
Requires session token, old password, new password.

</p>
<h4>Specific errors</h4>
<p>TODO: <code>WRONG_PASSWORD</code>, <code>INVALID_NEW_PASSWORD</code>

</p>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
<h2><a id="admin-accesses"></a>Accesses</h2>
<p>TODO: introductory text


</p>
<h3>POST <code>/admin/get-app-token</code></h3>
<p>Gets the token of the personal access your app must use when accessing the user's data on her behalf. The access is created if it is the first time your app (identified by its id when logging in) requests it.

</p>
<h4>Successful response: <code>200 OK</code></h4>
<ul>
<li><code>id</code> (<a href="#data-types-identity">identity</a>): Your app's dedicated personal <a href="#data-types-access">access</a> token.</li>
</ul>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">curl -i -H <span class="string">"Authorization: {session-id}"</span> -X POST https://{username}.pryv.io/admin/get-app-token</code></pre>
<h3>GET <code>/admin/accesses</code></h3>
<p>Gets all manageable accesses, which are the shared accesses. (Your app's own access token is retrieved with <code>POST /admin/get-app-token</code>.)

</p>
<h4>Successful response: <code>200 OK</code></h4>
<p>An array of <a href="#data-types-access">accesses</a> containing all manageable accesses in the user's account, ordered by name.

</p>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">curl -i -H <span class="string">"Authorization: {session-id}"</span> https://{username}.pryv.io/admin/accesses</code></pre>
<h3>POST <code>/admin/accesses</code></h3>
<p>Creates a new shared access.

</p>
<h4>Body parameters</h4>
<p>The new access's data: see <a href="#data-types-access">access</a>.

</p>
<h4>Successful response: <code>201 Created</code></h4>
<ul>
<li><code>token</code> (<a href="#data-types-identity">identity</a>): The created access's token.</li>
</ul>
<h4>Specific errors</h4>
<ul>
<li><code>400 Bad Request</code>, id <code>INVALID_ITEM_ID</code>: Occurs if trying to set the token to an invalid value (e.g. a reserved word like <code>"null"</code>).</li>
</ul>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
<h3>PUT <code>/admin/accesses/{token}</code></h3>
<p>Modifies the specified shared access.

</p>
<h4>Body parameters</h4>
<p>New values for the access's fields: see <a href="#data-types-access">access</a>. All fields are optional, and only modified values must be included. TODO: example

</p>
<h4>Successful response: <code>200 OK</code></h4>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
<h3>DELETE <code>/admin/accesses/{token}</code></h3>
<p>Deletes the specified shared access.

</p>
<h4>Successful response: <code>200 OK</code></h4>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
<h2><a id="admin-bookmarks"></a>Bookmarks</h2>
<p>TODO: introductory text


</p>
<h3>GET <code>/admin/bookmarks</code></h3>
<p>Gets all of the user's sharing bookmarks.

</p>
<h4>Successful response: <code>200 OK</code></h4>
<p>An array of <a href="#data-types-bookmark">bookmarks</a> containing all sharing bookmarks in the user's account, ordered by name.

</p>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
<h3>POST <code>/admin/bookmarks</code></h3>
<p>Creates a new sharing bookmark.

</p>
<h4>Body parameters</h4>
<p>The new bookmark's data: see <a href="#data-types-bookmark">bookmark</a>.

</p>
<h4>Successful response: <code>201 Created</code></h4>
<ul>
<li><code>id</code> (<a href="#data-types-identity">identity</a>): The created bookmark's id.</li>
</ul>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
<h3>PUT <code>/admin/bookmarks/{bookmark-id}</code></h3>
<p>Modifies the specified sharing bookmark.

</p>
<h4>Body parameters</h4>
<p>New values for the bookmark's fields: see <a href="#data-types-bookmark">bookmark</a>. All fields are optional, and only modified values must be included. TODO: example

</p>
<h4>Successful response: <code>200 OK</code></h4>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
<h3>DELETE <code>/admin/bookmarks/{bookmark-id}</code></h3>
<p>Deletes the specified sharing bookmark.

</p>
<h4>Successful response: <code>200 OK</code></h4>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
</body></html>