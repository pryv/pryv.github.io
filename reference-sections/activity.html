<html><head></head><body><h1>Activity methods</h1>
<p>TODO: introductory text


</p>
<h2>Authorization</h2>
<p>All requests for retrieving and manipulating activity data must carry a valid <a href="#data-structure-access">access token</a> in the HTTP <code>Authorization</code> header or, alternatively, in the query string's <code>auth</code> parameter.  (You get the token itself either by retrieving it in the <a href="#admin-accesses">administration</a> or from sharing.)

</p>
<p>Here's what a proper request looks like:
</p>
<pre class="highlighted"><code class="language-http"><span class="request">GET <span class="string">/{channel-id}/events</span> HTTP/1.1</span>
<span class="attribute">Host</span>: <span class="string">yacinthe.pryv.io</span>
<span class="attribute">Authorization</span>: <span class="string">{access-token}</span></code></pre>
<p>Or, alternatively, passing the access token in the query string:
</p>
<pre class="highlighted"><code class="language-http"><span class="request">GET <span class="string">/{channel-id}/events?auth={access-token}</span> HTTP/1.1</span>
<span class="attribute">Host</span>: <span class="string">yacinthe.pryv.io</span></code></pre>
<h2>Common errors</h2>
<p>Here are errors commonly returned for requests:

</p>
<ul>
<li><code>400 Bad Request</code>, id <code>INVALID_REQUEST_STRUCTURE</code>: The request's structure is not that expected. This can happen e.g. with invalid JSON syntax, or when using an unexpected multipart structure for uploading file attachments.</li>
<li><code>400 Bad Request</code>, id <code>INVALID_PARAMETERS_FORMAT</code>: The request's parameters do not follow the expected format.</li>
<li><code>401 Unauthorized</code>, id <code>INVALID_ACCESS_TOKEN</code>: The data access token is missing or invalid.</li>
<li><code>403 Forbidden</code>: The given access token does not grant permission for this operation. See <a href="#data-structure-access">accesses</a> for more details about accesses and permissions.</li>
<li><code>404 Not Found</code>, possible cases:<ul>
<li>Id <code>UNKNOWN_CHANNEL</code>: The activity channel can't be found.</li>
<li>Id <code>UNKNOWN_FOLDER</code>: The activity folder can't be found in the specified channel.</li>
<li>Id <code>UNKNOWN_EVENT</code>: The event can't be found in the specified channel.</li>
<li>Id <code>UNKNOWN_ATTACHMENT</code>: The attached file can't be found for the specified event.</li>
</ul>
</li>
</ul>
<h2>Channels</h2>
<p>For retrieving and manipulating <a href="#data-structure-channel">channels</a>.


</p>
<h3>GET <code>/channels</code></h3>
<p><em>Socket.IO command id: <code>channels.get</code></em>

</p>
<p>Gets the accessible activity channels (excluding those in the trash).

</p>
<h4>Query string parameters</h4>
<ul>
<li><code>state</code> (<code>default</code>, <code>trashed</code> or <code>all</code>): Optional. Indicates what items to return depending on their state. By default, only items that are not in the trash are returned; <code>trashed</code> returns only items in the trash, while <code>all</code> return all items regardless of their state.</li>
</ul>
<h4>Successful response: <code>200 OK</code></h4>
<p>An array of <a href="#data-structure-channel">activity channels</a>) containing the accessible channels in the user's account matching the specified state, ordered by name.

</p>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">curl -i https://{username}.pryv.io/channels?auth={access-token}</code></pre>
<h3>POST <code>/channels</code></h3>
<p>Creates a new activity channel. Only personal accesses allow creating new channels.

</p>
<h4>Body parameters</h4>
<p>The new channel's data: see <a href="#data-structure-channel">activity channel</a>.

</p>
<h4>Successful response: <code>201 Created</code></h4>
<ul>
<li><code>id</code> (<a href="#data-structure-identity">identity</a>): The created channel's id.</li>
</ul>
<h4>Specific errors</h4>
<ul>
<li><code>400 Bad Request</code>, id <code>INVALID_ITEM_ID</code>: Occurs if trying to set the id to an invalid value (e.g. a reserved word like <code>"null"</code>).</li>
<li><code>400 Bad Request</code>, id <code>ITEM_ID_ALREADY_EXISTS</code>: A channel already exists with the same id.</li>
<li><code>400 Bad Request</code>, id <code>ITEM_NAME_ALREADY_EXISTS</code>: A channel already exists with the same name.</li>
</ul>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
<h3>PUT <code>/channels/{channel-id}</code></h3>
<p>Modifies the activity channel's attributes.

</p>
<h4>Body parameters</h4>
<p>New values for the channel's fields: see <a href="#data-structure-channel">activity channel</a>. All fields are optional, and only modified values must be included. TODO: example

</p>
<h4>Successful response: <code>200 OK</code></h4>
<h4>Specific errors</h4>
<ul>
<li><code>400 Bad Request</code>, id <code>ITEM_NAME_ALREADY_EXISTS</code>: A channel already exists with the same name.</li>
</ul>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
<h3>DELETE <code>/channels/{channel-id}</code></h3>
<p>Trashes or deletes the given channel, depending on its current state:

</p>
<ul>
<li>If the channel is not already in the trash, it will be moved to the trash (i.e. flagged as <code>trashed</code>)</li>
<li>If the channel is already in the trash, it will be irreversibly deleted with all the folders and events it contains.</li>
</ul>
<p>Only personal accesses allow deleting channels.

</p>
<h4>Successful response: <code>200 OK</code></h4>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
<h2>Events</h2>
<p>Methods to retrieve and manipulate <a href="#data-structure-event">events</a>.


</p>
<h3>GET <code>/{channel-id}/events</code></h3>
<p><em>Socket.IO command id: <code>{channel-id}.events.get</code></em>

</p>
<p>Queries accessible events.

</p>
<h4>Query string parameters</h4>
<ul>
<li><code>fromTime</code> (<a href="#data-structure-timestamp">timestamp</a>): Optional. TODO. Default is 24 hours before <code>toTime</code>, if set.</li>
<li><code>toTime</code> (<a href="#data-structure-timestamp">timestamp</a>): Optional. TODO. Default is the current time.</li>
<li><code>onlyFolders</code> (array of <a href="#data-structure-identity">identity</a>): Optional. If set, only events assigned to the specified folders and their sub-folders will be returned. To retrieve events that are not assigned to any folder, just include a <code>null</code> value in the array. By default, all accessible events are returned (regardless of their folder assignment).</li>
<li><code>sortAscending</code> (<code>true</code> or <code>false</code>): If <code>true</code>, events will be sorted from oldest to newest. Default: false (sort descending).</li>
<li><code>skip</code> (number): Optional. The number of items to skip in the results.</li>
<li><code>limit</code> (number): Optional. The number of items to return in the results. A default value of 20 items is used if no other range limiting parameter is specified (<code>fromTime</code>, <code>toTime</code>).</li>
<li><code>state</code> (<code>default</code>, <code>trashed</code> or <code>all</code>): Optional. Indicates what items to return depending on their state. By default, only items that are not in the trash are returned; <code>trashed</code> returns only items in the trash, while <code>all</code> return all items regardless of their state.</li>
<li><code>modifiedSince</code> (<a href="#data-structure-timestamp">timestamp</a>): Optional. If specified, only events modified since that time will be returned.</li>
</ul>
<h4>Successful response: <code>200 OK</code></h4>
<p>An array of <a href="#data-structure-event">activity events</a> containing the accessible events ordered by time (see <code>sortAscending</code> above).

</p>
<h4>Specific errors</h4>
<ul>
<li><code>400 Bad Request</code>, id <code>UNKNOWN_FOLDER</code>: TODO may happen if one of the specified folders doesn't exist</li>
</ul>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">curl -i https://{username}.pryv.io/{channel-id}/events?auth={access-token}</code></pre>
<h3>POST <code>/{channel-id}/events</code></h3>
<p><em>Socket.IO command id: <code>{channel-id}.events.create</code></em>

</p>
<p>Records a new event. Events recorded this way must be completed events, i.e. either period events with a known duration or mark events. To start a running period event, post a <code>events/start</code> request.

</p>
<p>In addition to the usual JSON, this request accepts standard multipart/form-data content to support the creation of event with attached files in a single request. When sending a multipart request, one content part must hold the JSON for the new event and all other content parts must be the attached files.

</p>
<p>TODO: example

</p>
<h4>Body parameters</h4>
<p>The new event's data: see <a href="#data-structure-event">activity event</a>.

</p>
<h4>Successful response: <code>201 Created</code></h4>
<ul>
<li><code>id</code> (<a href="#data-structure-identity">identity</a>): The new event's id.</li>
<li><code>stoppedId</code> (<a href="#data-structure-identity">identity</a>): If set, indicates the id of the previously running period event that was stopped as a consequence of inserting the new event.</li>
</ul>
<h4>Specific errors</h4>
<ul>
<li><code>400 Bad Request</code>, id <code>UNKNOWN_FOLDER</code>: The specified folder cannot be found.</li>
</ul>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">curl -i -H <span class="string">"Content-Type: application/json"</span> -X POST -d <span class="string">'{"folderId":"{folder-id}"}'</span> https://{username}.pryv.io/{channel-id}/events?auth={access-token}</code></pre>
<h3>POST <code>/{channel-id}/events/start</code></h3>
<p><em>Socket.IO command id: <code>{channel-id}.events.start</code></em>

</p>
<p>Starts a new period event, stopping the previously running period event if any. See POST <code>/{channel-id}/events</code> for details. TODO: detail

</p>
<h4>Successful response: <code>201 Created</code></h4>
<h4>Specific errors</h4>
<ul>
<li><code>400 Bad Request</code>, id <code>MISSING_FOLDER</code>: The mandatory folder is missing.</li>
<li><code>400 Bad Request</code>, id <code>INVALID_OPERATION</code>: A period event cannot start if another period event already exists at a later time.</li>
<li><code>400 Bad request</code>, id <code>PERIODS_OVERLAP</code>: TODO (data: array of overlapped ids)</li>
</ul>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">curl -i -H <span class="string">"Content-Type: application/json"</span> -X POST -d <span class="string">'{"folderId":"{folder-id}"}'</span> https://{username}.pryv.io/{channel-id}/events/start?auth={access-token}</code></pre>
<h3>POST <code>/{channel-id}/events/stop</code></h3>
<p><em>Socket.IO command id: <code>{channel-id}.events.stop</code></em>

</p>
<p>Stops the previously running period event. See POST <code>/{channel-id}/events</code> for details. TODO: detail

</p>
<h4>Successful response: <code>200 OK</code></h4>
<ul>
<li><code>stoppedId</code> (<a href="#data-structure-identity">identity</a>): The id of the previously running period event that was stopped, or null if no running event was found.</li>
</ul>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
<h3>TODO: GET <code>/{channel-id}/events/start</code> and <code>.../stop</code> and <code>.../record</code> alternatives to the above to allow simple calls via e.g. wget/curl</h3>
<h3>GET <code>/{channel-id}/events/running</code></h3>
<p><em>Socket.IO command id: <code>{channel-id}.events.getRunning</code></em>

</p>
<p>Gets the currently running period events.

</p>
<h4>Successful response: <code>200 OK</code></h4>
<p>An array of <a href="#data-structure-event">activity events</a> containing the running period events.

</p>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
<h3>PUT <code>/{channel-id}/events/{event-id}</code></h3>
<p><em>Socket.IO command id: <code>{channel-id}.events.update</code></em>

</p>
<p>Modifies the activity event's attributes.

</p>
<h4>Body parameters</h4>
<p>New values for the event's fields: see <a href="#data-structure-event">activity event</a>. All fields are optional, and only modified values must be included. TODO: example

</p>
<h4>Successful response: <code>200 OK</code></h4>
<ul>
<li><code>stoppedId</code> (<a href="#data-structure-identity">identity</a>): If set, indicates the id of the previously running period event that was stopped as a consequence of modifying the event.</li>
</ul>
<h4>Specific errors</h4>
<ul>
<li><code>400 Bad Request</code>, id <code>INVALID_OPERATION</code>: Returned for period events, if attempting to set the event's duration to <code>undefined</code> (i.e. still running) while one or more other period events were recorded after it.</li>
<li><code>400 Bad Request</code>, id <code>PERIODS_OVERLAP</code>: Returned for period events, if attempting to change the event's duration to a value that causes an overlap with one or more subsequent period event(s). TODO format (list of unspecified overlapped event ids, or "too many" if more than 10)</li>
</ul>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
<h3>POST <code>/{channel-id}/events/{event-id}</code></h3>
<p>Adds one or more file attachments to the event. This request expects standard multipart/form-data content, with all content parts being the attached files.

</p>
<p>TODO: example

</p>
<h4>Successful response: <code>200 OK</code></h4>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
<h3>DELETE <code>/{channel-id}/events/{event-id}</code></h3>
<p><em>Socket.IO command id: <code>{channel-id}.events.delete</code></em>

</p>
<p>Trashes or deletes the specified event, depending on its current state:

</p>
<ul>
<li>If the event is not already in the trash, it will be moved to the trash (i.e. flagged as <code>trashed</code>)</li>
<li>If the event is already in the trash, it will be irreversibly deleted (including all its attached files, if any).</li>
</ul>
<h4>Successful response: <code>200 OK</code></h4>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
<h3>GET <code>/{channel-id}/events/{event-id}/{file name}</code></h3>
<p>Gets the attached file.

</p>
<h4>Successful response: <code>200 OK</code></h4>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
<h3>DELETE <code>/{channel-id}/events/{event-id}/{file name}</code></h3>
<p><em>Socket.IO command id: <code>{channel-id}.events.deleteAttachedFile</code></em>

</p>
<p>Irreversibly deletes the attached file.

</p>
<h4>Successful response: <code>200 OK</code></h4>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
<h3>POST <code>/{channel-id}/events/batch</code></h3>
<p>Batch upload events that were recorded by the client while offline. The submitted events are added in-order, with results returned individually for each (see response below).

</p>
<h4>Body parameters</h4>
<p>An array of client-recorded <a href="#data-structure-event">activity events</a>. Each event must have a unique <code>clientId</code> defined, and its time must be set in server time.

</p>
<h4>Successful response: <code>200 OK</code></h4>
<p>An object with one property per event submitted holding the result for that event. Each property's name is the submitted event's client id, and its value contains:

</p>
<ul>
<li>If the event was successful created, an object with the <code>id</code> of the event, and possibly the <code>stoppedId</code> of the running period event that was stopped as a result. (For details, see POST <code>/{channel-id}/events</code>.)</li>
<li>If there was an error creating the event: an object with an <code>error</code> property holding the encountered <a href="#data-structure-error">error</a>.</li>
</ul>
<p>Example:
</p>
<pre class="highlighted"><code class="language-json">{
    "<span class="attribute">client_id_1</span>": <span class="value">{"<span class="attribute">id</span>": <span class="value"><span class="string">"TTMyhYEZriJ"</span></span>}</span>,
    "<span class="attribute">client_id_2</span>": <span class="value">{"<span class="attribute">error</span>": <span class="value">{
        "<span class="attribute">id</span>": <span class="value"><span class="string">"UNKNOWN_FOLDER"</span></span>,
        "<span class="attribute">message</span>": <span class="value"><span class="string">"Folder 'bad-folder-id' is unknown."</span>
    </span>}</span>}
</span>}</code></pre>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
<h2>Folders</h2>
<p>Methods to retrieve and manipulate <a href="#data-structure-folder">folders</a>.


</p>
<h3>GET <code>/{channel-id}/folders</code></h3>
<p><em>Socket.IO command id: <code>{channel-id}.folders.get</code></em>

</p>
<p>Gets the accessible folders, either from the root level or only descending from a specified parent folder.

</p>
<h4>Query string parameters</h4>
<ul>
<li><code>parentId</code> (<a href="#data-structure-identity">identity</a>): Optional. The id of the parent folder to use as root for the request. Default: <code>null</code> (returns all accessible folders from the root level).</li>
<li><code>includeHidden</code> (<code>true</code> or <code>false</code>): Optional. When <code>true</code>, folders that are currently hidden will be included in the result. Default: <code>false</code>.</li>
<li><code>state</code> (<code>default</code>, <code>trashed</code> or <code>all</code>): Optional. Indicates what items to return depending on their state. By default, only items that are not in the trash are returned; <code>trashed</code> returns only items in the trash, while <code>all</code> return all items regardless of their state.</li>
<li><code>timeCountBase</code> (<a href="#data-structure-timestamp">timestamp</a>): Optional. If specified, the returned folders will include the summed duration of all their period events, starting from this timestamp (see <code>timeCount</code> in <a href="#data-structure-folder">activity folder</a>); otherwise no time count values will be returned.</li>
</ul>
<h4>Successful response: <code>200 OK</code></h4>
<p>An array of <a href="#data-structure-folder">activity folders</a> containing the tree of the accessible folders, sorted by name.

</p>
<h4>Specific errors</h4>
<ul>
<li><code>400 Bad Request</code>, id <code>UNKNOWN_FOLDER</code>: The specified parent folder can't be found.</li>
</ul>
<p>TODO: example (with and without time accounting)


</p>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
<h3>POST <code>/{channel-id}/folders</code></h3>
<p><em>Socket.IO command id: <code>{channel-id}.folders.create</code></em>

</p>
<p>Creates a new folder at the root level or as a child folder to the specified folder.

</p>
<h4>Body parameters</h4>
<p>The new folder's data: see <a href="#data-structure-folder">activity folder</a>.

</p>
<h4>Successful response: <code>201 Created</code></h4>
<ul>
<li><code>id</code> (<a href="#data-structure-identity">identity</a>): The created folder's id.</li>
</ul>
<h4>Specific errors</h4>
<ul>
<li><code>400 Bad Request</code>, id <code>ITEM_ID_ALREADY_EXISTS</code>: A folder already exists with the same id.</li>
<li><code>400 Bad Request</code>, id <code>ITEM_NAME_ALREADY_EXISTS</code>: A sibling folder already exists with the same name.</li>
<li><code>400 Bad Request</code>, id <code>INVALID_ITEM_ID</code>: Occurs if trying to set the id to an invalid value (e.g. a reserved word like <code>"null"</code>).</li>
</ul>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
<h3>PUT <code>/{channel-id}/folders/{folder-id}</code></h3>
<p><em>Socket.IO command id: <code>{channel-id}.folders.update</code></em>

</p>
<p>Modifies the activity folder's attributes.

</p>
<h4>Body parameters</h4>
<p>New values for the folder's fields: see <a href="#data-structure-folder">activity folder</a>. All fields are optional, and only modified values must be included.

</p>
<p>TODO: example

</p>
<h4>Successful response: <code>200 OK</code></h4>
<h4>Specific errors</h4>
<ul>
<li><code>400 Bad Request</code>, id <code>UNKNOWN_FOLDER</code>: The specified parent folder's id is unknown.</li>
<li><code>400 Bad Request</code>, id <code>ITEM_NAME_ALREADY_EXISTS</code>: A sibling folder already exists with the same name.</li>
</ul>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
<h3>DELETE <code>/{channel-id}/folders/{folder-id}</code></h3>
<p><em>Socket.IO command id: <code>{channel-id}.folders.delete</code></em>

</p>
<p>Trashes or deletes the specified folder, depending on its current state:

</p>
<ul>
<li>If the folder is not already in the trash, it will be moved to the trash (i.e. flagged as <code>trashed</code>)</li>
<li>If the folder is already in the trash, it will be irreversibly deleted with its possible descendants. If events exist that refer to the deleted item(s), you must indicate how to handle them with the parameter <code>mergeEventsWithParent</code>..</li>
</ul>
<h4>Query string parameters</h4>
<ul>
<li><code>mergeEventsWithParent</code> (<code>true</code> or <code>false</code>): Required if actually deleting the item and if it (or any of its descendants) has linked events, ignored otherwise. If <code>true</code>, the linked events will be assigned to the parent of the deleted item; if <code>false</code>, the linked events will be deleted.</li>
</ul>
<h4>Successful response: <code>200 OK</code></h4>
<h4>Specific errors</h4>
<ul>
<li><code>400 Bad Request</code>, id <code>MISSING_PARAMETER</code>: There are events referring to the deleted items and the <code>mergeEventsWithParent</code> parameter is missing.</li>
</ul>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
<h2><a id="activity-accesses"></a>Accesses</h2>
<p>While full access management is reserved for trusted apps via <a href="#admin-accesses">methods in the administration</a>, any app can retrieve and manage shared accesses depending on its own permissions. All methods here only deal with shared accesses whose permissions are a subset of that linked to the token used for the requests. (You'll get a <code>403 Forbidden</code> error if trying to touch other types of accesses, or shared accesses with greater permissions.)


</p>
<h3>GET <code>/accesses</code></h3>
<p>Gets all manageable shared accesses.

</p>
<h4>Successful response: <code>200 OK</code></h4>
<p>An array of <a href="#data-structure-access">accesses</a> containing all manageable shared accesses in the user's account, ordered by name.

</p>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">curl -i -H <span class="string">"Authorization: {access-token}"</span> https://{username}.pryv.io/accesses</code></pre>
<h3>POST <code>/accesses</code></h3>
<p>Creates a new shared access. You can only create accesses whose permissions are a subset of those linked to your own access token.

</p>
<h4>Body parameters</h4>
<p>The new access's data: see <a href="#data-structure-access">access</a>.

</p>
<h4>Successful response: <code>201 Created</code></h4>
<ul>
<li><code>token</code> (<a href="#data-structure-identity">identity</a>): The created access's token.</li>
</ul>
<h4>Specific errors</h4>
<ul>
<li><code>400 Bad Request</code>, id <code>INVALID_ITEM_ID</code>: Occurs if trying to set the token to an invalid value (e.g. a reserved word like <code>"null"</code>).</li>
</ul>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
<h3>PUT <code>/accesses/{token}</code></h3>
<p>Modifies the specified shared access. You can only modify accesses whose permissions are a subset of those linked to your own access token.

</p>
<h4>Body parameters</h4>
<p>New values for the access's fields: see <a href="#data-structure-access">access</a>. All fields are optional, and only modified values must be included. TODO: example

</p>
<h4>Successful response: <code>200 OK</code></h4>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
<h3>DELETE <code>/accesses/{token}</code></h3>
<p>Deletes the specified shared access. You can only delete accesses whose permissions are a subset of those linked to your own access token.

</p>
<h4>Successful response: <code>200 OK</code></h4>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
</body></html>