<!DOCTYPE html><html lang="en" class="no-js"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="description" property="og:description" content="Pryv API reference and resources for developers"><meta name="author" content="Pryv SA"><meta property="og:type" content="website"><meta name="image" property="og:image" content="/assets/images/logo-256.png"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Data Modelling | Pryv API</title><link rel="icon" href="/assets/images/favicon-black.ico" type="image/x-icon"><link rel="apple-touch-icon" sizes="120x120" href="/assets/images/apple-touch-icon-120x120-black.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/images/apple-touch-icon-152x152-black.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon-180x180-black.png"><!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]--><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:400,300,500,700,400italic|Roboto+Condensed:400,300,700"><link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/docco.min.css"><link rel="stylesheet" type="text/css" href="/assets/fonts/ss-gizmo.min.css"><link rel="stylesheet" type="text/css" href="/assets/style.css"></head><body class="data-modelling with-toc"><header id="page-header"><nav role="navigation" class="navbar navbar-default navbar-fixed-top"><div class="container-fluid"><div class="navbar-header"><a href="https://pryv.com" title="Pryv home" class="navbar-brand logo pryv-home"><img src="/assets/images/icon-home.svg" alt="Pryv home" height="50"></a><a href="/" title="Developers home" class="navbar-brand logo"><img src="/assets/images/logo-256-black.png" alt="Developers home"></a><button type="button" data-toggle="collapse" data-target="#main-nav" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div><div id="main-nav" class="collapse navbar-collapse"><ul class="nav navbar-nav"><li class="dropdown"><a href="#" data-toggle="dropdown" class="dropdown-toggle">Guides <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="/getting-started/">Getting started</a></li><li><a href="/concepts/">API concepts</a></li><li><a href="/guides/data-modelling/">Data modelling</a></li><li><a href="/guides/webhooks/">Webhooks</a></li><li><a href="/guides/app-guidelines/">App guidelines</a></li><li><a href="/external-resources/">External resources</a></li></ul></li><li class="dropdown"><a href="#" data-toggle="dropdown" class="dropdown-toggle">Reference <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="/reference/">API reference</a></li><li><a href="/reference-system/">API System reference</a></li><li><a href="/event-types/">Event types</a></li><li><a href="/open-api/">Open API (Postman)</a></li><li><a href="/change-log/">API change log</a></li><!--+menuItem('standardStructure')--></ul></li><li class="dropdown"><a href="#" data-toggle="dropdown" class="dropdown-toggle">FAQ <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="/faq-api/">API</a></li><li><a href="/faq-infra/">Infrastructure</a></li></ul></li><li><a href="https://support.pryv.com/hc/en-us/community/topics">Community</a></li></ul><div class="navbar-right"><p class="navbar-text version"><a href="/change-log/" title="View change log">API version: <strong>1.5.9</strong></a></p></div></div></div></nav></header><div id="main-wrapper" class="container container-narrow"><div id="main"><h1 class="page-title">Data Modelling</h1><p>In the following section, you will find all the necessary information to design your own data model and implement it under Pryv&#39;s conventions.</p>
<p>We describe two basic use cases : <strong>data collection</strong> to store and aggregate data from multiple data sources for a subject and <strong>consent aggregation</strong> of multiple subjects that granted permission to access their data.</p>
<h2 id="data-collection">Data collection</h2>
<p>Let&#39;s say you built an algorithm that computes allergen exposure based on geolocation data from your users and integrates it to their health profile.</p>
<p>All the different data sources store their data in the user&#39;s account:</p>
<ul>
<li><strong>Smartwatch</strong>: Collects in real-time the GPS position of the user, which represents a high volume of data.</li>
<li><strong>Allergen Exposure Mobile App</strong>: Tracks the allergen exposure using the geolocation data from the smartwatch of the user.</li>
<li><strong>Digital Tensiometer</strong>: Used at home to daily monitor blood pressure and added in the health profile of the user.</li>
</ul>
<p>Here is a list of data generated by the applications and their corresponding Pryv types :</p>
<table>
<thead>
<tr>
<th style="text-align:left">Data</th>
<th style="text-align:left">Type</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Position</td>
<td style="text-align:left"><code>position/wgs84</code></td>
</tr>
<tr>
<td style="text-align:left">Allergen exposure</td>
<td style="text-align:left"><code>density/kg-m3</code></td>
</tr>
<tr>
<td style="text-align:left">Blood pressure</td>
<td style="text-align:left"><code>blood-pressure/mmhg-bpm</code></td>
</tr>
</tbody>
</table>
<h3 id="stream-structure">Stream structure</h3>
<p>One general advice is to use one stream or substream per device.
Given this situation, we would recommend a stream structure similar to the following:</p>
<p><img src="/assets/images/data_model_allergens.svg" alt="Example Streams Structure"></p>
<p>This stream structure has multiple benefits:</p>
<ul>
<li>Allows aggregation of data originating from different data sources</li>
<li>Provides enough context to the data and thus avoids ambiguities</li>
<li>Enables granular permissions to streams</li>
</ul>
<p>Let&#39;s imagine now that you want doctors to provide feedback to users after consulting their health profile and allergen exposure. 
You can easily do so by adding a new stream <code>Doctor&#39;s feedback</code> in which the doctor will be communicating with his patient.</p>
<h3 id="access-structure">Access structure</h3>
<p>As multiple actors are involved in your process, you might need to restrict accesses to particular streams of the user&#39;s data.
For example, you can restrict the access to the stream <code>Position</code> to the <strong>Allergen Exposure App</strong> only and the access to the stream <code>Health Profile</code> to the <strong>Doctor</strong> only, so that personal and sensitive data from the user is protected.</p>
<p>The streams structure and accesses over it would look like the following:</p>
<p><img src="/assets/images/data_model_allergens_doctor.svg" alt="Example Streams Structure"></p>
<p>This structure allows you a granular level of control to accesses to the data. Different permissions can be defined for each stream and substream, therefore enabling you to share only necessary information with third-parties.<br>For example, the access you will create (see <a href="/reference/#create-access">accesses.create</a> call for more details) for the <strong>Allergen Exposure App</strong> will enable your app to <code>read</code> the geolocation data from the user and to <code>manage</code> the stream in which allergen exposure data will be added:</p>
<pre><code class="lang-json">{
  &quot;access&quot;: {
    &quot;id&quot;: &quot;cka6h2b2t00065wpvubqj12xb&quot;,
    &quot;token&quot;: &quot;cka6h2b2t00075wpvgcuy4ocn&quot;,
    &quot;type&quot;: &quot;shared&quot;,
    &quot;name&quot;: &quot;For Allergen Exposure App&quot;,
    &quot;permissions&quot;: [
      {
        &quot;streamId&quot;: &quot;position&quot;,
        &quot;level&quot;: &quot;read&quot;
      },
      {
        &quot;streamId&quot;: &quot;allergen-exposure-app&quot;,
        &quot;level&quot;: &quot;manage&quot;
      }
    ],
</code></pre>
<p>Available levels of permissions (<code>read</code>, <code>manage</code>, <code>contribute</code>, <code>create-only</code>) are defined and explained <a href="/reference/#access">here</a>.   </p>
<h3 id="implementation">Implementation</h3>
<p>A global overview of the streams and permissions structure of this use case is provided in this <a href="https://docs.google.com/spreadsheets/d/1UUb94rovSegFucEUtl9jcx4UcTAClfkKh9T2meVM5Zo/edit#gid=0">Excel template</a>. We advise you to build your own file based on this template in which you will describe your own data model depending on the use cases of your app/device.</p>
<p>To implement this structure, you first need to create the root streams <code>smartwatch</code>, <code>allergen exposure app</code> and <code>health profile</code> and then the corresponding substreams, in which you will be able to insert the events (see <a href="/reference/#create-stream">streams.create</a> call for more details).</p>
<p>Alternatively, you can also do a <a href="/reference/#call-batch">&quot;batch call&quot;</a> to create all the streams using a single API call. </p>
<p>In our case :</p>
<pre><code class="lang-json">[
  {
    &quot;method&quot;: &quot;streams.create&quot;,
    &quot;params&quot;: {
      &quot;id&quot;: &quot;smartwatch&quot;,
      &quot;name&quot;: &quot;Smartwatch&quot;
    }
  },
  {
    &quot;method&quot;: &quot;streams.create&quot;,
    &quot;params&quot;: {
      &quot;id&quot;: &quot;position&quot;,
      &quot;parentId&quot;: &quot;smartwatch&quot;,
      &quot;name&quot;: &quot;Position&quot;
    },
  }
    {
    &quot;method&quot;: &quot;streams.create&quot;,
    &quot;params&quot;: {
      &quot;id&quot;: &quot;allergen-exposure-app&quot;,
      &quot;name&quot;: &quot;Allergen Exposure App&quot;
    }
  },
  {
    &quot;method&quot;: &quot;streams.create&quot;,
    &quot;params&quot;: {
      &quot;id&quot;: &quot;pollen&quot;,
      &quot;parentId&quot;: &quot;allergen-exposure-app&quot;,
      &quot;name&quot;: &quot;Pollen&quot;
    }
  },
  {
    &quot;method&quot;: &quot;streams.create&quot;,
    &quot;params&quot;: {
      &quot;id&quot;: &quot;cereal-crops&quot;,
      &quot;parentId&quot;: &quot;allergen-exposure-app&quot;,
      &quot;name&quot;: &quot;Cereal crops&quot;
    }
  },
  {
    &quot;method&quot;: &quot;streams.create&quot;,
    &quot;params&quot;: {
      &quot;id&quot;: &quot;hazelnut-tree&quot;,
      &quot;parentId&quot;: &quot;allergen-exposure-app&quot;,
      &quot;name&quot;: &quot;Hazelnut tree&quot;
    }
  },
  {
    &quot;method&quot;: &quot;streams.create&quot;,
    &quot;params&quot;: {
      &quot;id&quot;: &quot;health-profile&quot;,
      &quot;name&quot;: &quot;Health Profile&quot;
    }
  },
  {
    &quot;method&quot;: &quot;streams.create&quot;,
    &quot;params&quot;: {
      &quot;id&quot;: &quot;digital-tensiometer&quot;,
      &quot;parentId&quot;: &quot;health-profile&quot;,
      &quot;name&quot;: &quot;Digital tensiometer&quot;
    }
  },
  {
    &quot;method&quot;: &quot;streams.create&quot;,
    &quot;params&quot;: {
      &quot;id&quot;: &quot;blood-pressure&quot;,
      &quot;parentId&quot;: &quot;digital-tensiometer&quot;,
      &quot;name&quot;: &quot;Blood pressure&quot;
    }
  },
  {
    &quot;method&quot;: &quot;streams.create&quot;,
    &quot;params&quot;: {
      &quot;id&quot;: &quot;weight&quot;,
      &quot;parentId&quot;: &quot;health-profile&quot;,
      &quot;name&quot;: &quot;Weight&quot;
    }
  },
  {
    &quot;method&quot;: &quot;streams.create&quot;,
    &quot;params&quot;: {
      &quot;id&quot;: &quot;doctor-feedback&quot;,
      &quot;name&quot;: &quot;Doctor&#39;s feedback&quot;
    }
  },
  {
    &quot;method&quot;: &quot;streams.create&quot;,
    &quot;params&quot;: {
      &quot;id&quot;: &quot;comment&quot;,
      &quot;parentId&quot;: &quot;doctor-feedback&quot;,
      &quot;name&quot;: &quot;Comment&quot;
    }
  }
]
</code></pre>
<h2 id="consent-aggregation">Consent aggregation</h2>
<p>Let&#39;s imagine now a slightly different use case. You are conducting an Allergology Exposition research, in which you analyze the exposition of subjects to allergens by tracking their geolocation through your app.</p>
<h3 id="stream-structure">Stream structure</h3>
<p>You have been collecting consent from your app users to use their data and you need to store these accesses on Pryv.io. You will therefore need a &quot;campaign&quot; stream structure which allows you to store the accesses for your app.</p>
<p><img src="/assets/images/Campaign.svg" alt="Example Campaign Structure"></p>
<p>The &quot;campaign&quot; data structure will contain the following streams:</p>
<ul>
<li>The stream <strong>Campaign description</strong>, in which you will store information about the authorization you are requesting. You can do a <a href="/reference/#create-stream">streams.create</a> call with the following data:</li>
</ul>
<pre><code class="lang-json">{
  &quot;id&quot;: &quot;campaign-description&quot;,
  &quot;name&quot;: &quot;Campaign description&quot;,
  &quot;parentId&quot;: &quot;allergology-exposition-campaign&quot;
}
</code></pre>
<p>Its events will include the fields necessary to perform an <a href="/reference/#auth-request">Auth request</a>:</p>
<ul>
<li><code>requestingAppId</code>, your app&#39;s identifier that wishes to access data from the users</li>
<li><code>requestedPermissions</code>, containing the streams your app wants to access and their associated level of permission</li>
<li><code>clientData</code>, containing the consent information of your user</li>
</ul>
<p>You can do an <a href="/reference/#create-event">events.create</a> call containing this information:</p>
<pre><code class="lang-json">{
  &quot;event&quot;: {
    &quot;id&quot;: &quot;ck9ckvwfo000vt4pvrudxci9b&quot;,
    &quot;time&quot;: 1385046854.282,
    &quot;streamIds&quot;: [&quot;campaign-description]&quot;,
    &quot;type&quot;: &quot;campaign/auth-request&quot;,
    &quot;content&quot;: {
      &quot;requestingAppId&quot;: &quot;allergen-exposure-app-id&quot;,
      &quot;requestedPermissions&quot;: [
      {
          &quot;streamId&quot;: &quot;geolocation&quot;,
          &quot;level&quot;: &quot;read&quot;,
          &quot;defaultName&quot;: &quot;Geolocation&quot;
      }],
      &quot;clientData&quot;: {
        &quot;app-web-auth:description&quot;: {
          &quot;type&quot;: &quot;note/txt&quot;,
          &quot;content&quot;: &quot;This is a consent message.&quot;
        }
      }
    }
  }
}
</code></pre>
<ul>
<li>The stream <strong>Patient accesses</strong> that will store the credentials in <code>pryvApiEndpoint</code> format (see <a href="/guides/app-guidelines/">App guidelines</a>) for every subject that granted access to their data. You can do a <a href="/reference/#create-stream">streams.create</a> call with the following data:</li>
</ul>
<pre><code class="lang-json">{
  &quot;id&quot;: &quot;patient-accesses&quot;,
  &quot;name&quot;: &quot;Patient accesses&quot;,
  &quot;parentId&quot;: &quot;allergology-exposition-campaign&quot;
}
</code></pre>
<p>The events of this stream will contain the credentials of every subject that granted access to their data, in particular the <code>pryvApiEndpoint</code> associated with their Pryv.io account.</p>
<p>You can do an <a href="/reference/#create-event">events.create</a> call to store the credentials of &quot;Subject 01&quot; for example:</p>
<pre><code class="lang-json">{
  &quot;event&quot;: {
    &quot;id&quot;: &quot;jk8ujvwfo000vt4vprfriwd5a&quot;,
    &quot;time&quot;: 1385046854.285,
    &quot;streamIds&quot;: [&quot;patient-accesses&quot;],
    &quot;type&quot;: &quot;access/pryv-api-endpoint&quot;,
    &quot;content&quot;: &quot;https://ck0qmnwo40007a8ivbxn12zt7@subject01.pryv.me/&quot;
  }
}
</code></pre>
<h3 id="implementation">Implementation</h3>
<p>For this stream structure, you can create the streams as explained <a href="/reference/#create-stream">here</a> or all in one by doing a &quot;batch call&quot; :</p>
<pre><code class="lang-json">[
  {
    &quot;method&quot;: &quot;streams.create&quot;,
    &quot;params&quot;: {
      &quot;id&quot;: &quot;allergology-exposition-campaign&quot;,
      &quot;name&quot;: &quot;Allergology Exposition Campaign&quot;
    }
  },
    {
    &quot;method&quot;: &quot;streams.create&quot;,
    &quot;params&quot;: {
      &quot;id&quot;: &quot;campaign-description&quot;,
      &quot;parentId&quot;: &quot;allergology-exposition-campaign&quot;,
      &quot;name&quot;: &quot;Campaign description&quot;
    }
  },
  {
    &quot;method&quot;: &quot;streams.create&quot;,
    &quot;params&quot;: {
      &quot;id&quot;: &quot;patient-accesses&quot;,
      &quot;parentId&quot;: &quot;allergology-exposition-campaign&quot;,
      &quot;name&quot;: &quot;Patient accesses&quot;
    }
  }
]
</code></pre>
</div><nav id="toc"></nav></div><footer id="page-footer"><nav class="navbar navbar-default"><div class="container-fluid"><div id="footer-nav"><ul class="nav navbar-nav"><li><a href="mailto:developers@pryv.com">Send a message</a></li><li><a href="https://github.com/pryv">GitHub</a></li><li><a href="https://pryv.com">pryv.com</a></li></ul></div></div></nav></footer><script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script><script src="/assets/bootstrap.min.js"></script><script src="/assets/js/toc.min.js"></script><!-- TOC generation--><script>jQuery(document).ready(function($) {
  // Header is about 51 pixels. This equals to 'header + fuzz', fuzz was
  // determined experimentally.
  var offset = 100;

  // Display TOC on the left side of the page.
  $('#toc').toc({
    selector: '#main h1:not(.page-title),#main h2,#main h3',
    ulClass: 'nav'
  });

  // Synchronise scroll/click motion with TOC display.
  $(document).ready(function() {
    // NOTE This is done at onLoad since we need to wait for all CSS
    // to appear.
    $('body').scrollspy({
      target: '#toc',
      offset: offset
    });
  });
});
</script><!-- Code blocks highlighting--><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();
</script><!-- Google Analytics--><script>var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-36589447-2']);
_gaq.push(['_trackPageview']);
(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></body></html>