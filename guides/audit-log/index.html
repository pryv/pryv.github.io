<!DOCTYPE html><html lang="en" class="no-js"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="description" property="og:description" content="Pryv API reference and resources for developers"><meta name="author" content="Pryv SA"><meta property="og:type" content="website"><meta name="image" property="og:image" content="/assets/images/logo-256.png"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Audit logs | Pryv API</title><link rel="icon" href="/assets/images/favicon-black.ico" type="image/x-icon"><link rel="apple-touch-icon" sizes="120x120" href="/assets/images/apple-touch-icon-120x120-black.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/images/apple-touch-icon-152x152-black.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon-180x180-black.png"><!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]--><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:400,300,500,700,400italic|Roboto+Condensed:400,300,700"><link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/docco.min.css"><link rel="stylesheet" type="text/css" href="/assets/fonts/ss-gizmo.min.css"><link rel="stylesheet" type="text/css" href="/assets/style.css"></head><body class="audit-log with-toc"><header id="page-header"><nav role="navigation" class="navbar navbar-default navbar-fixed-top"><div class="container-fluid"><div class="navbar-header"><a href="https://pryv.com" title="Pryv home" class="navbar-brand logo pryv-home"><img src="/assets/images/icon-home.svg" alt="Pryv home" height="50"></a><a href="/" title="Developers home" class="navbar-brand logo"><img src="/assets/images/logo-256-black.png" alt="Developers home"></a><button type="button" data-toggle="collapse" data-target="#main-nav" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div><div id="main-nav" class="collapse navbar-collapse"><ul class="nav navbar-nav"><li class="dropdown"><a href="#" data-toggle="dropdown" class="dropdown-toggle">Guides <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="/getting-started/">Getting started</a></li><li><a href="/external-resources/">Apps &amp; Libs</a></li><li><a href="/concepts/">API concepts</a></li><li><a href="/guides/data-modelling/">Data modelling</a></li><li><a href="/guides/webhooks/">Webhooks</a></li><li><a href="/guides/custom-auth/">Custom auth</a></li><li><a href="/guides/consent/">Consent request</a></li><li><a href="/guides/app-guidelines/">App guidelines</a></li></ul></li><li class="dropdown"><a href="#" data-toggle="dropdown" class="dropdown-toggle">Reference <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="/reference/">API reference</a></li><li><a href="/reference-admin/">Admin API reference</a></li><li><a href="/reference-system/">System API reference</a></li><li><a href="/event-types/">Event types</a></li><li><a href="/open-api/">Open API (Postman)</a></li><li><a href="/change-log/">API change log</a></li></ul></li><li class="dropdown"><a href="#" data-toggle="dropdown" class="dropdown-toggle">FAQ <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="/faq-api/">API</a></li><li><a href="/faq-infra/">Infrastructure</a></li></ul></li><li><a href="https://support.pryv.com/hc/en-us/community/topics">Community</a></li><li><a href="https://github.com/pryv/open-pryv.io">Open Pryv.io</a></li><li><a href="/roadmap/">Roadmap</a></li></ul><div class="navbar-right"><p class="navbar-text version"><a href="/change-log/" title="View change log">API version: <strong>1.6.20</strong></a></p></div></div></div></nav></header><div id="main-wrapper" class="container container-narrow"><div id="main"><h1 class="page-title">Audit logs</h1><p>In this guide we address developers that wish to use audit logs on Pryv.io to capture changes to a system and keep records of the interactions that were made with the data.<br>It describes what Audit Logs are, why to use them and how they were designed on Pryv.io. It goes through a possible use case to explain how auditing works with Pryv.io.</p>
<h2 id="table-of-content">Table of content</h2>
<ol>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#audit-logs">Audit Logs</a><ol>
<li><a href="#what-are-audit-logs">What are Audit Logs?</a></li>
<li><a href="#why-using-audit-logs">Why using Audit Logs?</a></li>
<li><a href="#how-are-logs-organized-in-pryv.io">How are logs organized in Pryv.io?</a> </li>
<li><a href="#retrieving-audit-logs-in-pryv.io">Retrieving Audit Logs in Pryv.io</a>)</li>
</ol>
</li>
<li><a href="#use-case">Use case: Keeping track of an API call</a></li>
<li><a href="#hands-on-example">Hands-on example</a></li>
<li><a href="#special-features">Special features</a><ol>
<li><a href="#api-endpoint">API endpoints</a></li>
<li><a href="#query-parameters">Query parameters</a></li>
<li><a href="#search-interface">Search interface</a></li>
<li><a href="#api-results">API results</a> </li>
<li><a href="#configuration">Configuration</a></li>
</ol>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ol>
<h2 id="introduction">Introduction</h2>
<p>In regards to new requirements on data privacy, you need to be able by now to track all activities related to the personal data you hold on your servers. This includes tracking of consents, data accesses, data retrievals, but also tracking of data changes. </p>
<p>Audit logs are considered to be the best way of demonstrating compliance – and “demonstrating compliance” is a key point of new privacy regulations. Keeping logs of processes made on personal data is not only a best practice, but a must for you to achieve compliance.</p>
<p>Audit capabilities on Pryv.io now enable you to keep track of data in your system and to generate audit logs.</p>
<h2 id="definition">Definition</h2>
<p>Let’s take a quick overview of what exactly are <code>Audit logs</code>.</p>
<p>An audit log shows “who” did “what” activity and “how” the system behaved. It comes in the form of a document that records chronologically all the interactions that were made with the personal data stored on the servers : what resources were accessed, the destination and source addresses, a timestamp and the user login information.</p>
<p>When using Pryv.io, it enables you to keep track of details about the actions performed by clients against Pryv.io accounts through the Pryv.io API. </p>
<p>You can take a look on what an <code>Audit log</code> looks like on Pryv.io :</p>
<pre><code class="lang-json">{
  &quot;id&quot;: &quot;:_audit:ckqujnth400081eow07wcbfr7&quot;,
  &quot;streamIds&quot;: [
    &quot;:_audit:access-ck6j78uj600011ss2neygkpub&quot;,
    &quot;:_audit:action-events.get&quot;
  ],
  &quot;time&quot;: 1625726631.928,
  &quot;type&quot;: &quot;audit-log/pryv-api&quot;,
  &quot;content&quot;: {
    &quot;source&quot;: {
      &quot;name&quot;: &quot;http&quot;,
      &quot;ip&quot;: &quot;85.5.225.68&quot;
    },
    &quot;action&quot;: &quot;events.get&quot;,
    &quot;query&quot;: {
      &quot;toTime&quot;: &quot;9900000000&quot;,
      &quot;fromTime&quot;: &quot;0&quot;,
      &quot;limit&quot;: &quot;100&quot;,
      &quot;sortAscending&quot;: &quot;false&quot;,
      &quot;state&quot;: &quot;all&quot;
    }
  },
  &quot;created&quot;: 1625726631.928,
  &quot;createdBy&quot;: &quot;system&quot;,
  &quot;modified&quot;: 1625726631.928,
  &quot;modifiedBy&quot;: &quot;system&quot;,
}
</code></pre>
<p>As you may have recognized, it is an event of type <code>log/user-api</code>. You can find its defails <a href="/event-types/#log">here</a>.</p>
<p>Audit logs are available through the <a href="/reference/#get-events">Events API</a>. However they are read only, thus cannot be modified.</p>
<h3 id="filtering">Filtering</h3>
<p>You can filter the sort of logs you wish to query by <strong>action</strong> and <strong>access id</strong>. Each audit log gets 2 streamIds in the form of:</p>
<ol>
<li><code>:_audit:action-{method-id}</code>, see <a href="/reference/#method-ids">API method ids</a>.</li>
<li><code>:_audit:access-{access-id}</code>, the id of the access that performed the action.</li>
</ol>
<h2 id="permissions">Permissions</h2>
<p>The logs you are allowed to query depend on the access you are using.</p>
<p>Whe using a <strong>personal</strong> token, you can query actions performed by any other access.</p>
<p>When using an <strong>app</strong> or <strong>shared</strong> token, you can only query actions performed by the access you are using.</p>
<h2 id="setup">Setup</h2>
<p>For information regarding the setup of</p>
<h3 id="why-using-audit-logs-on-pryv-io">Why using Audit Logs on Pryv.io</h3>
<p><em>Text to keep or replace by the drawing</em></p>
<p>In addition to providing proof of compliance and operational integrity, audit logs can help you monitor activity on your servers :</p>
<ul>
<li><p>by tracking access to data : <strong>who</strong> accessed <strong>what</strong> and <strong>when</strong>. You can track all accesses to data and check that only the authorized users have read the data. 
It can be used to see whether a user account has been hacked, or whether user account privileges were escalated to access specific files or directories with sensitive information. </p>
</li>
<li><p>by tracking data changes. One of the principles of GDPR being “integrity”, you have to be able to reconstruct the lifecycle of any data flowing in your system. This means keeping the data correct and logging any modification. </p>
</li>
<li><p>by logging GDPR-specific activities, e.g. when a data subject invokes his rights. Each request can be securely logged so that you can prove to authorities the exact sequence of events relating to the particular data subject.</p>
</li>
<li><p>by logging consent and the accompanying context (date, time, IP address, etc). The consent withdrawal must also be logged, so that the whole history of the consent of the data subject is transparent. This way you will be able to prove to regulators when you had and when you did not have consent for processing.</p>
</li>
</ul>
<p><img src="/assets/images/Audit_log_why.png" alt="Why using Audit Logs"></p>
<h2 id="how-to-filter-what-to-log">How to filter what to log</h2>
<h3 id="how-are-logs-organized-in-pryv-io-">How are logs organized in Pryv.io ?</h3>
<ul>
<li><p>Organization of the audit logs per username. In other words, the username, extracted from the log message, will be used as log folder name, so one log folder will be created per username.</p>
</li>
<li><p>Log rotation explanation ?</p>
</li>
</ul>
<h3 id="retrieving-audit-logs-in-pryv-io">Retrieving Audit Logs in Pryv.io</h3>
<ul>
<li>should I explain audit API setup, configuration (config file <code>core/audit/conf/audit.json</code>)?</li>
<li>log format (example of syslog entry for an incoming API request or for the execution of a request ?)</li>
</ul>
<p>Importantly, the logs on Pryv.io can only be fetched by presenting an authorization token, allowing to audit the actions that involved a given token.</p>
<h2 id="use-case-keeping-track-of-an-api-call">Use case: Keeping track of an API call</h2>
<p>Go through Emma use case.</p>
<p><img src="/assets/images/use_case_audit.png" alt="Use case"></p>
<h2 id="hands-on-example">Hands-on example</h2>
<p>Explain the use case with API calls description.</p>
<h2 id="special-features">Special features</h2>
<h3 id="api-endpoints">API endpoints</h3>
<ul>
<li>Provide an &#39;authorization token&#39; as Authorization header
GET {username}.{domain}/audit/logs
Retrieves log entries from syslog logs for a specific user and current access id.</li>
</ul>
<h3 id="query-parameters">Query parameters</h3>
<ul>
<li>Set several search criteria by providing them as query parameters (examples: Access id, Date: fromTime, toTime, Http code: range or single, details such as forwarded for, action HTTP verb, path or error id)</li>
</ul>
<h3 id="search-interface">Search interface</h3>
<ul>
<li>Explain the Filter class (instanciated with a map of property:value provided by the Express application after extracting the query parameters.)</li>
<li>Give some examples ?</li>
</ul>
<h3 id="api-results">API results</h3>
<ul>
<li>Log format</li>
<li>Organization of the log records in a structure similar to Events (with type and content) and accumulated in a result array, possibly streamed.</li>
<li>Give examples ?</li>
</ul>
<h3 id="configuration">Configuration</h3>
<ul>
<li>Log location ?</li>
<li>Service-core endpoint ?</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>If you wish to get more information on the data structure of an <code>Audit Log</code> in Pryv.io, please refer to the corresponding section of the <a href="/reference/#audit-log">API reference</a>. 
It describes the main features of the data structure, while the methods relative to audit logs can be found in the <a href="/reference/#audit">API methods section</a>.</p>
</div><nav id="toc"></nav></div><footer id="page-footer"><nav class="navbar navbar-default"><div class="container-fluid"><div id="footer-nav"><ul class="nav navbar-nav"><li><a href="mailto:developers@pryv.com">Send a message</a></li><li><a href="https://github.com/pryv">GitHub</a></li><li><a href="https://pryv.com">pryv.com</a></li></ul></div></div></nav></footer><script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script><script src="/assets/bootstrap.min.js"></script><script src="/assets/js/toc.min.js"></script><!-- TOC generation--><script>jQuery(document).ready(function($) {
  // Header is about 51 pixels. This equals to 'header + fuzz', fuzz was
  // determined experimentally.
  var offset = 90;

  // Display TOC on the left side of the page.
  $('#toc').toc({
    selector: '#main h1:not(.page-title),#main h2,#main h3',
    ulClass: 'nav'
  });

  // Synchronise scroll/click motion with TOC display.
  $(document).ready(function() {
    // NOTE This is done at onLoad since we need to wait for all CSS
    // to appear.
    $('body').scrollspy({
      target: '#toc',
      offset: offset
    });
    scrollBy(0, 1); // make it scroll to be sure scrollspy gets it
    
    // fix offset when navigating
    $('#toc li a, a.toc-anchor').click(function (e) {
      e.preventDefault();
      var target = $(this).attr('href');
      window.location.hash = target;
      
      $(target)[0].scrollIntoView();
      if ($(window).scrollTop() + $(window).height() !== $(document).height()) {
        //only adjust when not at bottom
        scrollBy(0, -offset + 40);
      }
      return true;
    });
  
  });
});
</script><!-- Code blocks highlighting--><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();
</script><!-- Google Analytics--><script>var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-36589447-2']);
_gaq.push(['_trackPageview']);
(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></body></html>