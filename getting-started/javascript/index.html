<!DOCTYPE html><html lang="en" class="no-js"><head><meta charset="UTF-8"><meta name="description" content="TODO"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Getting started: Javascript | Pryv API</title><link rel="icon" href="/assets/images/favicon-black.ico" type="image/x-icon"><link rel="apple-touch-icon" sizes="120x120" href="/assets/images/apple-touch-icon-120x120-black.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/images/apple-touch-icon-152x152-black.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon-180x180-black.png"><!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]--><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:400,300,500,700,400italic|Roboto+Condensed:400,300,700"><link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/docco.min.css"><link rel="stylesheet" type="text/css" href="/assets/fonts/ss-gizmo.min.css"><link rel="stylesheet" type="text/css" href="/assets/style.css"></head><body class="javascript with-toc"><header id="page-header"><nav role="navigation" class="navbar navbar-default navbar-fixed-top"><div class="container-fluid"><div class="navbar-header"><a href="https://pryv.com" title="Pryv home" class="navbar-brand logo pryv-home"><img src="/assets/images/icon-home.svg" alt="Pryv home" height="50"></a><a href="/" title="Developers home" class="navbar-brand logo"><img src="/assets/images/logo-256-black.png" alt="Developers home"></a><button type="button" data-toggle="collapse" data-target="#main-nav" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div><div id="main-nav" class="collapse navbar-collapse"><ul class="nav navbar-nav"><li class="dropdown"><a href="#" data-toggle="dropdown" class="dropdown-toggle">Guides <b class="caret"></b></a><ul class="dropdown-menu"><!--+menuItem('getting-started', 'Getting started (soon)', {disabled: true})--><li class="active"><a href="/getting-started/javascript/">Getting started: Javascript</a></li><li><a href="/getting-started/java/">Getting started: Java</a></li><li><a href="/concepts/">API concepts</a></li><!--+menuItem('data-modeling', 'Data modeling') â€”> into "Concepts"??--></ul></li><li class="dropdown"><a href="#" data-toggle="dropdown" class="dropdown-toggle">Reference <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="/reference/">API reference</a></li><li><a href="/change-log/">API change log</a></li><li><a href="/event-types/">Event types</a></li><!--+menuItem('standardStructure')--></ul></li><li class="dropdown"><a href="#" data-toggle="dropdown" class="dropdown-toggle">Code <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="/code-libraries/">Code libraries</a></li><li><a href="/apps-and-services/">Example apps</a></li></ul></li><!--lia(href='#') Blog--></ul><div class="navbar-right"><p class="navbar-text version"><a href="/change-log" title="View change log">API version: <strong>1.1.2</strong></a></p></div></div></div></nav></header><div id="main-wrapper" class="container container-narrow"><div id="main"><h1 class="page-title">Getting started: Javascript</h1><p>A few initial pointers to get going with <a href="https://github.com/pryv/lib-javascript">our Javacript library</a>.<br>
<a href="http://github.com/pryv/dev-site/issues">Feedback and suggestions welcome</a>.</p>
<h3 id="quick-examples">Quick examples</h3>
<p>On JSFiddle:</p>
<ul>
<li><a href="http://jsfiddle.net/pryv/fr4e834p/">Basic example: authenticate &amp; retrieve data</a></li>
<li><a href="https://jsfiddle.net/pryv/kmtyxj37/">Second step: create notes &amp; numerical values</a></li>
<li><a href="http://jsfiddle.net/pryv/bwpv0b3o/">Events monitor: manipulate events &amp; monitor changes</a></li>
</ul>
<h3 id="install-the-library">Install the library</h3>
<div class="row">

<div class="col-md-6">
<h6>Node.js / Browserify</h6>
<p>Install the module...</p>
<pre><code class="lang-bash">npm install pryv --save</code></pre>
<p>...then require it in your JS:</p>
<pre><code class="lang-javascript">var pryv = require(&#39;pryv&#39;);</code></pre>
</div>

<div class="col-md-6">
<h6>Browser, old style</h6>
<p><a href="https://api.pryv.com/lib-javascript/latest/pryv.js">Download</a> then include the library file:</p>
<pre><code class="lang-html">&lt;script type=&quot;text/javascript&quot; src=&quot;pryv.js&quot;&gt;&lt;/script&gt;</code></pre>
</div>

<p></div></p>
<h3 id="authorize-your-app">Authorize your app</h3>
<p>First choose an app identifier (min. length 6 chars), then in your client code:</p>
<pre><code class="lang-html">&lt;!-- Add the &quot;Pryv&quot; auth button somewhere (skip this for custom UI/behavior) --&gt;
&lt;span id=&quot;pryv-button&quot;&gt;&lt;/span&gt;
</code></pre>
<pre><code class="lang-javascript">var credentials = null;
var pryvDomain = &#39;pryv.me&#39;;
var requestedPermissions = [{
  // Here we request full permissions on a custom stream;
  // in practice, scope and permission level will vary depending on your needs
  streamId: &#39;example-app-id&#39;,
  defaultName: &#39;Example app&#39;,
  level: &#39;manage&#39;
}];

var settings = {
  requestingAppId: &#39;example-app-id&#39;,
  requestedPermissions: requestedPermissions,
  spanButtonID: &#39;pryv-button&#39;,
  callbacks: {
    initialization: function () {
      // ...
    },
    needSignin: function (popupUrl, pollUrl, pollRateMs) {
      // ...
    },
    signedIn: function (authData) {
      credentials = authData;
      // ...
    },
    refused: function (code) {
      // ...
    },
    error: function (code, message) {
      // ...
    }
  }
};

pryv.Auth.config.registerURL.host = &#39;reg.&#39; + pryvDomain;
pryv.Auth.setup(settings);
</code></pre>
<p>See also: <a href="/reference/#authorizing-your-app">App authorization</a></p>
<h3 id="connect-to-the-account">Connect to the account</h3>
<pre><code class="lang-javascript">var connection = new pryv.Connection(credentials);
</code></pre>
<h3 id="fetch-the-stream-structure">Fetch the stream structure</h3>
<pre><code class="lang-javascript">// Required by the monitors
connection.fetchStructure(function (err, streams) {
  // ...
})
</code></pre>
<h3 id="manage-events">Manage events</h3>
<h4 id="retrieve">Retrieve</h4>
<pre><code class="lang-javascript">var filter = new pryv.Filter({limit : 10});
connection.events.get(filter, function (err, events) {
  // ...
});
</code></pre>
<h4 id="create">Create</h4>
<pre><code class="lang-javascript">var event = {
  streamId: &#39;valid-stream-id&#39;,
  type: &#39;note/txt&#39;,
  content: &#39;This is an example.&#39;
};
connection.events.create(event, function (err, eventCreated) { 
  // ...
});
</code></pre>
<h4 id="create-with-attachment">Create with attachment</h4>
<pre><code class="lang-javascript">var fs = require(&#39;fs&#39;);

var event = {
  type: &#39;picture/attached&#39;,
  streamId: &#39;valid-stream-id&#39;,
  description: &#39;This is a description.&#39;
};
var pictureData = fs.readFileSync(&#39;pathToFile/image.jpg&#39;);
var formData = pryv.utility.forgeFormData(&#39;attachment-id&#39;, pictureData, {
  type: &#39;image/jpg&#39;,
  filename: &#39;attachment&#39;
});

connection.events.createWithAttachment(event, formData, function (err, event) {
  // ...
});
</code></pre>
<p>See also: <a href="/event-types/">More about types</a></p>
<h4 id="update">Update</h4>
<pre><code class="lang-javascript">event.content = &#39;This is an update.&#39;;
connection.events.update(event, function (err, eventUpdated) {
  // ...
});
</code></pre>
<h4 id="delete">Delete</h4>
<pre><code class="lang-javascript">connection.events.delete(event, function (err, eventDeleted) {
  // ...
});
</code></pre>
<h3 id="manage-streams">Manage streams</h3>
<h4 id="retrieve">Retrieve</h4>
<pre><code class="lang-javascript">var options;

// Here we will get all streams (including root and trashed streams)
options = {
    // If null, retrieve active streams only
    state: &#39;all&#39;
};

// Same as above but in a selected stream
options = {
    parentId: &#39;valid-stream-id&#39;,
    state: &#39;all&#39;
};

connection.streams.get(options, function (err, streams) {
  // ...
});
</code></pre>
<h4 id="create">Create</h4>
<pre><code class="lang-javascript">// If no id is set, one is generated;
// If parentId is null, the stream is created at the root
var stream = {
  name: &#39;A Stream&#39;,
  id: &#39;a-stream-id&#39;,
  parentId: &#39;valid-stream-id&#39;
};

connection.streams.create(stream, function (err, streamCreated) { 
  // ...
});
</code></pre>
<h4 id="update">Update</h4>
<pre><code class="lang-javascript">stream.name: &#39;An Updated Stream&#39;;
connection.streams.update(stream, function (err, streamUpdated) {
  // ...
});
</code></pre>
<h4 id="delete">Delete</h4>
<pre><code class="lang-javascript">connection.streams.delete(stream, function (err, streamDeleted) {
  // ...
});
</code></pre>
<h3 id="manage-accesses">Manage accesses</h3>
<h4 id="retrieve">Retrieve</h4>
<pre><code class="lang-javascript">connection.accesses.get(function (err, accesses) {
  // ...
});
</code></pre>
<h4 id="create">Create</h4>
<pre><code class="lang-javascript">var access = {
  name: &#39;An Access&#39;,
  permissions: [
    {
      streamId: &#39;valid-stream-id&#39;,
      level: &#39;manage&#39;
    }
  ]
};

connection.accesses.create(access, function (err, accessCreated) { 
  // ...
});
</code></pre>
<h4 id="update">Update</h4>
<pre><code class="lang-javascript">access.name: &#39;An Updated Access&#39;;
access.permissions[0].level: &#39;contribute&#39;;
connection.accesses.update(access, function (err, accessUpdated) {
  // ...
});
</code></pre>
<h4 id="delete">Delete</h4>
<pre><code class="lang-javascript">connection.accesses.delete(access, function (err, accessDeletion) {
  // ...
});
</code></pre>
<h3 id="batch-call">Batch call</h3>
<pre><code class="lang-javascript">var methodsData = [
  {
    &#39;method&#39;: &#39;streams.create&#39;,
    &#39;params&#39;: {
      &#39;id&#39;: &#39;a-new-stream&#39;,
      &#39;name&#39;: &#39;A New Stream&#39;
    }
  },
  {
    &#39;method&#39;: &#39;events.create&#39;,
    &#39;params&#39;: {
      &#39;streamId&#39;: &#39;a-new-stream&#39;,
      &#39;type&#39;: &#39;note/txt&#39;,
      &#39;content&#39;: &#39;This is a new event.&#39;
    }
  },
  {
    &#39;method&#39;: &#39;accesses.create&#39;,
    &#39;params&#39;: {
      &#39;name&#39;: &#39;A New Access&#39;,
      &#39;permissions&#39;: [
        {
          &#39;streamId&#39;: &#39;a-new-stream&#39;,
          &#39;level&#39;: &#39;read&#39;
        }
      ]
    }
  }
];

connection.batchCall(methodsData, function (err, results) {
  //...
});
</code></pre>
<h3 id="monitors">Monitors</h3>
<p>Monitors watch the changes to selected data structures (i.e: Errors, Events, Streams or Filters). They are used to fetch the current state of all the elements in an app upon loading. Therefore it allows to manage data in a user account at runtime.</p>
<p>To use monitors you will need to:</p>
<ul>
<li>Setup a monitor variable.</li>
<li>Add the requested event listener(s).</li>
<li>Call the <code>monitor.start</code>.</li>
</ul>
<h4 id="setup-monitors">Setup Monitors</h4>
<pre><code class="lang-javascript">var filter = new pryv.Filter({limit: 5});
var monitor = connection.monitor(filter);


//This will use the local cache before fetching data online, default is true
monitor.useCacheForEventsGetAllAndCompare = false;
// This will fetch all events on start up, default is true
monitor.ensureFullCache = false;
// This will optimize start up by prefecthing some events, default is 100
monitor.initWithPrefetch = 0;
</code></pre>
<h4 id="load">Load</h4>
<pre><code class="lang-javascript">// Will fetch events depending on the filter set in &#39;Setup Monitors&#39; above
var onLoad = pryv.MESSAGES.MONITOR.ON_LOAD;
monitor.addEventListener(onLoad, function (events) {
  // ...
});
</code></pre>
<h4 id="error">Error</h4>
<pre><code class="lang-javascript">var onError = pryv.MESSAGES.MONITOR.ON_ERROR;
monitor.addEventListener(onError, function (error) {
  // ...
});
</code></pre>
<h4 id="event-change">Event change</h4>
<pre><code class="lang-javascript">// Will trigger if any event is created, updated or trashed;
// the array index is used to distinguish which type of change was made
var onEventChange = pryv.MESSAGES.MONITOR.ON_EVENT_CHANGE;
monitor.addEventListener(onEventChange, function (changes) {
  [ &#39;created&#39;, &#39;modified&#39;, &#39;trashed&#39;  ].forEach(function (action) {
  changes[action].forEach(function (event) {
    // ...
  });
});
</code></pre>
<h4 id="structure-change">Structure change</h4>
<pre><code class="lang-javascript">// Will trigger if any stream is created, updated, trashed or deleted;
// the array index is used to distinguish which type of change was made
var onStructureChange = pryv.MESSAGES.MONITOR.ON_STRUCTURE_CHANGE;
monitor.addEventListener(onStructureChange, function (changes) {
  [ &#39;created&#39;, &#39;modified&#39;, &#39;trashed&#39;, &#39;deleted&#39; ].forEach(function (action) {
    changes[action].forEach(function (stream) {
      // ...
    });

});
</code></pre>
<h4 id="filter-change">Filter change</h4>
<pre><code class="lang-javascript">// Will trigger if any filter is updated ;
// the array index gives informations about the new filter (&#39;enter&#39;),
// and the old filter (&#39;leave&#39;)
var onFilterChange = pryv.MESSAGES.MONITOR.ON_FILTER_CHANGE;
monitor.addEventListener(onFilterChange, function (changes) {
  [ &#39;enter&#39;, &#39;leave&#39; ].forEach(function (action) {
    changes[action].forEach(function (filter) {
      // ...
    });
});
</code></pre>
<h4 id="start">Start</h4>
<pre><code class="lang-javascript">monitor.start(function (err) {
  // ...
});
</code></pre>
<h3 id="further-resources">Further resources</h3>
<ul>
<li><a href="/reference/">API reference</a></li>
<li><a href="/lib-javascript/latest/docs/">Library JS docs</a></li>
</ul>
</div><nav id="toc"></nav></div><footer id="page-footer"><nav class="navbar navbar-default"><div class="container-fluid"><div id="footer-nav"><ul class="nav navbar-nav"><li><a href="mailto:developers@pryv.com">Send a message</a></li><li><a href="https://github.com/pryv">GitHub</a></li><li><a href="https://pryv.com">pryv.com</a></li></ul></div></div></nav></footer><script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script><script src="/assets/bootstrap.min.js"></script><script src="/assets/js/toc.min.js"></script><!-- TOC generation--><script>jQuery(document).ready(function($) {
  var offset = 50;

  $('#toc').toc({
    selector: '#main h1:not(.page-title),#main h2,#main h3',
    ulClass: 'nav'
  });

  $('body').scrollspy({
    target: '#toc',
    offset: offset
  });

  // fix offset when navigating
  $('#toc li a, a.toc-anchor').click(function (e) {
    e.preventDefault();
    var target = $(this).attr('href');
    window.location.hash = target;
    $(target)[0].scrollIntoView();
    if ($(window).scrollTop() + $(window).height() !== $(document).height()) {
      // only adjust when not at bottom
      scrollBy(0, -offset + 1);
    }
  });
});
</script><!-- Code blocks highlighting--><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();
</script><!-- Google Analytics--><script>var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-36589447-2']);
_gaq.push(['_trackPageview']);
(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script><!-- Sales-Wings--><script src="//go.saleswingsapp.com/assets/javascripts/sw2.js"></script><script>window.ch.saleswings.start(null, "b05f9a01-cc65-4b59-a727-d3d9b97bddfd");</script></body></html>