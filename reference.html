<!DOCTYPE html><html lang="en" class="no-js"><head><meta charset="UTF-8" /><title>Pryv API reference</title><meta name="description" content="TODO" /><meta name="viewport" content="width=device-width, initial-scale=1" /><link rel="stylesheet" type="text/css" href="bootstrap.min.css" /><link rel="stylesheet" type="text/css" href="github.css" /><link rel="stylesheet" type="text/css" href="highlight.css" /><link rel="stylesheet" type="text/css" href="style.css" /><script src="scripts/modernizr.min.js"></script><script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.js"></script><script src="scripts/jquery.toc.min.js"></script><script>var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-36589447-2']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script></head><body><header id="page-header" class="navbar navbar-fixed-top"><div class="navbar-inner"><a href="/index.html" class="brand">Pryv</a><div class="nav-collapse collapse"><ul class="nav pull-right"><li><a href="dev-index.html">Home</a></li><li><div class="version">API version: <strong>0.4.22</strong></div></li></ul></div></div></header><div id="main"><div id="sections"><section id="basics"><h1>Basics</h1><section><h2>API style</h2><div class="content"><p>Most of the API follows REST principles, meaning each item has its own unique resource URL and can be read or modified via HTTP verbs:</p>
<ul>
<li>GET to read the item(s)</li>
<li>POST to create a new item, with a JSON message in the request body</li>
<li>PUT to modify the item, with a JSON message in the request body</li>
<li>DELETE to delete the item (note that logical deletion, or trashing, is supported for items like events, folders and channels)</li>
</ul>
<p>Note that the API also supports Socket.IO, for both calling API methods and receiving live notifications of changes to activity data. See <a href="#socketio">the dedicated section</a>.</p>
</div><aside><h4>Example request</h4>
<pre class="highlighted"><code class="language-http"><span class="request">GET <span class="string">/{channel-id}/events</span> HTTP/1.1</span>
<span class="attribute">Host</span>: <span class="string">{user-name}.pryv.io</span>
<span class="attribute">Authorization</span>: <span class="string">{access-token}</span></code></pre>
</aside></section><section><h2>Base URL</h2><div class="content"><p><code>https://{username}.pryv.io</code> (where <code>{username}</code> is the name of the user whose data you want to access)</p>
<p>Because Pryv potentially stores each user's data in a different location according to the user's choice, the API's base URL is unique for each user.</p>
</div></section><section><h2>Data format</h2><div class="content"><p>The API exchanges data with the client in JSON.</p>
</div><aside><h4>Example event</h4>
<pre class="highlighted"><code class="language-json">{
  "<span class="attribute">id</span>": <span class="value"><span class="string">"5051941d04b8ffd00500000d"</span></span>,
  "<span class="attribute">time</span>": <span class="value"><span class="number">1347864935.964</span></span>,
  "<span class="attribute">folderId</span>": <span class="value"><span class="string">"5058370ade44feaa03000015"</span></span>,
  "<span class="attribute">type</span>": <span class="value">{ "<span class="attribute">class</span>": <span class="value"><span class="string">"position"</span></span>, "<span class="attribute">format</span>": <span class="value"><span class="string">"wgs84"</span> </span>}</span>,
  "<span class="attribute">value</span>": <span class="value">{ "<span class="attribute">location</span>": <span class="value">{ "<span class="attribute">lat</span>": <span class="value"><span class="number">40.714728</span></span>, "<span class="attribute">lng</span>": <span class="value">-<span class="number">73.998672</span> </span>} </span>}</span>,
}</code></pre>
</aside></section><section><h2>Alternative request method</h2><div class="content"><p>Because we can't fathom out the crazy rationale behind <a href="https://developer.mozilla.org/en-US/docs/HTTP/Access_control_CORS">HTTP access control (CORS) rules</a>, we offer web apps an alternative way to place POST, PUT and DELETE requests in the API by using <code>application/x-www-form-urlencoded</code> POST requests with the following fields (all optional):</p>
<ul>
<li><code>_method</code>: The HTTP override method to use (usually <code>PUT</code> or <code>DELETE</code>; <code>POST</code> is used if not set).</li>
<li><code>_auth</code>: The <code>Authorization</code> header value (alternative to sending the header itself).</li>
<li><code>_json</code>: Considered as the JSON request body if set (overriding all other body content, if any).</li>
</ul>
<p>This is intended for web apps only; if your app isn't running in browsers you should use regular requests.</p>
</div></section><section><h2>Common HTTP headers</h2><div class="content"><p>The following headers are included in every response:</p>
<ul>
<li><code>API-Version</code>: The version of the API in the form <code>{major}.{minor}.{revision}</code>.</li>
<li><code>Server-Time</code>: The current server time as a <a href="#data-structure-timestamp">timestamp</a>. Keeping reference of the server time is an absolute necessity to properly read and write event times.</li>
</ul>
</div></section><section><h2>Errors</h2><div class="content"><p>When an error occurs, the API returns a 4xx or 5xx status code, with the response body usually containing an <a href="#data-structure-error">error</a> object detailing the cause.</p>
</div><aside><h4>Example error response</h4>
<pre class="highlighted"><code class="language-json">{
  "<span class="attribute">id</span>": <span class="value"><span class="string">"invalid-access-token"</span></span>,
  "<span class="attribute">message</span>": <span class="value"><span class="string">"Cannot find access with token 'bad-token'."</span>
</span>}</code></pre>
</aside></section></section><section id="activity"><h1>API methods</h1><div class="intro"><p>TODO: introductory text</p>
</div><section><h2>Preliminary information</h2><section><h3>Authorization</h3><div class="content"><p>All requests for retrieving and manipulating activity data must carry a valid <a href="#data-structure-access">access token</a> in the HTTP <code>Authorization</code> header or, alternatively, in the query string's <code>auth</code> parameter.  (You get the token by using one of the <a href="app-access.html">access SDKs</a> or from sharing.)</p>
</div><aside><h4>Example with <code>Authorization</code> header</h4>
<pre class="highlighted"><code class="language-http"><span class="request">GET <span class="string">/{channel-id}/events</span> HTTP/1.1</span>
<span class="attribute">Host</span>: <span class="string">yacinthe.pryv.io</span>
<span class="attribute">Authorization</span>: <span class="string">{access-token}</span></code></pre>
<h4>Example with <code>auth</code> query string parameter</h4>
<pre class="highlighted"><code class="language-http"><span class="request">GET <span class="string">/{channel-id}/events?auth={access-token}</span> HTTP/1.1</span>
<span class="attribute">Host</span>: <span class="string">yacinthe.pryv.io</span></code></pre>
</aside></section><section><h3>Common errors</h3><div class="content"><p>Here are errors commonly returned for requests:</p>
<ul>
<li><code>400 Bad Request</code>, id <code>invalid-request-structure</code>: The request's structure is not that expected. This can happen e.g. with invalid JSON syntax, or when using an unexpected multipart structure for uploading file attachments.</li>
<li><code>400 Bad Request</code>, id <code>invalid-parameters-format</code>: The request's parameters do not follow the expected format. The error's <code>data</code> contains an array of validation errors.</li>
<li><code>401 Unauthorized</code>, id <code>invalid-access-token</code>: The data access token is missing or invalid.</li>
<li><code>403 Forbidden</code>: The given access token does not grant permission for this operation. See <a href="#data-structure-access">accesses</a> for more details about accesses and permissions.</li>
<li><code>404 Not Found</code>, possible cases:<ul>
<li>Id <code>unknown-channel</code>: The activity channel can't be found.</li>
<li>Id <code>unknown-folder</code>: The activity folder can't be found in the specified channel.</li>
<li>Id <code>unknown-event</code>: The event can't be found in the specified channel.</li>
<li>Id <code>unknown-attachment</code>: The attached file can't be found for the specified event.</li>
</ul>
</li>
</ul>
<p>And a couple of others, related to the status of the user's account:</p>
<ul>
<li><code>301 Moved</code>, id <code>user-account-relocated</code>: The user has relocated her account to another Pryv server. Both the <code>Location</code> header and the error's <code>data</code> contain the equivalent URL pointing to the physical server now hosting the user's account. Note that this error can only occur between the moment the account is relocated and the moment your DNS is updated with the new server. So we're stretching the HTTP convention a little, in that the returned URL should not be used permanently (only until <code>{username}.pryv.io</code> points to the correct server again). You can decide whether you keep it for the duration of the session (if you have such a thing), for N hours, etc. (TODO: review and detail more if needed)</li>
<li><code>402 Payment Required</code>, id <code>user-intervention-required</code>: We cannot serve the request at the moment, because the user's account has exceeded the limits of its plan. The user must log into Pryv to fix her account.</li>
</ul>
</div></section></section><section><h2>Channels</h2><div class="intro"><p>Methods for retrieving and manipulating <a href="#data-structure-channel">channels</a>.</p>
</div><section class="method"><h3>Get channels</h3><div class="content"><p><code>GET /channels</code>, Socket.IO: <code>channels.get</code></p>
<p>Gets the accessible activity channels (excluding those in the trash).</p>
<h4>Parameters</h4>
<ul>
<li><code>state</code> (<code>default</code>, <code>trashed</code> or <code>all</code>): Optional. Indicates what items to return depending on their state. By default, only items that are not in the trash are returned; <code>trashed</code> returns only items in the trash, while <code>all</code> return all items regardless of their state.</li>
</ul>
<h4>Successful response: <code>200 OK</code></h4>
<p>An array of <a href="#data-structure-channel">activity channels</a>) containing the accessible channels in the user's account matching the specified state, ordered by name.</p>
</div><aside><h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">curl -i https://{username}.pryv.io/channels?auth={access-token}</code></pre>
</aside></section><section class="method"><h3>Create channel</h3><div class="content"><p><code>POST /channels</code>, Socket.IO: <code>channels.create</code></p>
<p>Creates a new activity channel. Only personal accesses allow creating new channels.</p>
<h4>Body parameters</h4>
<p>The new channel's data: see <a href="#data-structure-channel">activity channel</a>.</p>
<h4>Successful response: <code>201 Created</code></h4>
<ul>
<li><code>id</code> (<a href="#data-structure-identity">identity</a>): The created channel's id.</li>
</ul>
<h4>Specific errors</h4>
<ul>
<li><code>400 Bad Request</code>, id <code>invalid-item-id</code>: Occurs if trying to set the id to an invalid value (e.g. a reserved word like <code>"null"</code>).</li>
<li><code>400 Bad Request</code>, id <code>item-id-already-exists</code>: A channel already exists with the same id.</li>
<li><code>400 Bad Request</code>, id <code>item-name-already-exists</code>: A channel already exists with the same name.</li>
</ul>
</div><aside><h4>Simple example</h4>
<pre class="highlighted"><code class="language-json">{ "<span class="attribute">name</span>": <span class="value"><span class="string">"Undercover Activities"</span> </span>}</code></pre>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
</aside></section><section class="method"><h3>Update channel</h3><div class="content"><p><code>PUT /channels/{channel-id}</code>, Socket.IO: <code>channels.update</code></p>
<p>Modifies the activity channel's attributes.</p>
<h4>Body parameters</h4>
<p>New values for the channel's fields: see <a href="#data-structure-channel">activity channel</a>. All fields are optional, and only modified values must be included.</p>
<h4>Successful response: <code>200 OK</code></h4>
<h4>Specific errors</h4>
<ul>
<li><code>400 Bad Request</code>, id <code>item-name-already-exists</code>: A channel already exists with the same name.</li>
</ul>
</div><aside><h4>Simple example</h4>
<pre class="highlighted"><code class="language-json">{ "<span class="attribute">clientData</span>": <span class="value">{ "<span class="attribute">new-or-updated-client-specific-metadata</span>": <span class="value"><span class="number">42</span> </span>} </span>}</code></pre>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
</aside></section><section class="method"><h3>Delete channel</h3><div class="content"><p><code>DELETE /channels/{channel-id}</code>, Socket.IO: <code>channels.del</code></p>
<p>Trashes or deletes the given channel, depending on its current state:</p>
<ul>
<li>If the channel is not already in the trash, it will be moved to the trash (i.e. flagged as <code>trashed</code>)</li>
<li>If the channel is already in the trash, it will be irreversibly deleted with all the folders and events it contains.</li>
</ul>
<p>Only personal accesses allow deleting channels.</p>
<h4>Successful response: <code>200 OK</code></h4>
</div><aside><h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
</aside></section></section><section><h2>Events</h2><div class="intro"><p>Methods to retrieve and manipulate <a href="#data-structure-event">events</a>.</p>
</div><section class="method"><h3>Get events</h3><div class="content"><p><code>GET /{channel-id}/events</code>, Socket.IO: <code>{channel-id}.events.get</code></p>
<p>Queries accessible events.</p>
<h4>Parameters</h4>
<ul>
<li><code>fromTime</code> (<a href="#data-structure-timestamp">timestamp</a>): Optional. The start time of the timeframe you want to retrieve events for. Default is 24 hours before <code>toTime</code> if the latter is set; otherwise it is not taken into account.</li>
<li><code>toTime</code> (<a href="#data-structure-timestamp">timestamp</a>): Optional. The end time of the timeframe you want to retrieve events for. Default is the current time. Note: events are considered to be within a given timeframe based on their <code>time</code> only (<code>duration</code> is not considered).</li>
<li><code>onlyFolders</code> (array of <a href="#data-structure-identity">identity</a>): Optional. If set, only events assigned to the specified folders and their sub-folders will be returned. To retrieve events that are not assigned to any folder, just include a <code>null</code> value in the array. By default, all accessible events are returned (regardless of their folder assignment).</li>
<li><code>tags</code> (array of strings): Optional. If set, only events assigned to all of the listed tags will be returned.</li>
<li><code>sortAscending</code> (<code>true</code> or <code>false</code>): If <code>true</code>, events will be sorted from oldest to newest. Default: false (sort descending).</li>
<li><code>skip</code> (number): Optional. The number of items to skip in the results.</li>
<li><code>limit</code> (number): Optional. The number of items to return in the results. A default value of 20 items is used if no other range limiting parameter is specified (<code>fromTime</code>, <code>toTime</code>).</li>
<li><code>state</code> (<code>default</code>, <code>trashed</code> or <code>all</code>): Optional. Indicates what items to return depending on their state. By default, only items that are not in the trash are returned; <code>trashed</code> returns only items in the trash, while <code>all</code> return all items regardless of their state.</li>
<li><code>modifiedSince</code> (<a href="#data-structure-timestamp">timestamp</a>): Optional. If specified, only events modified since that time will be returned.</li>
</ul>
<h4>Successful response: <code>200 OK</code></h4>
<p>An array of <a href="#data-structure-event">events</a> containing the accessible events ordered by time (see <code>sortAscending</code> above).</p>
<h4>Specific errors</h4>
<ul>
<li><code>400 Bad Request</code>, id <code>unknown-folder</code>: one (or more) of the specified folders does not exist. The unknown folders' ids are listed as an array in the error's <code>data.unknownIds</code>.</li>
</ul>
</div><aside><h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">curl -i https://{username}.pryv.io/{channel-id}/events?auth={access-token}</code></pre>
</aside></section><section class="method"><h3>Create event</h3><div class="content"><p><code>POST /{channel-id}/events</code>, Socket.IO: <code>{channel-id}.events.create</code></p>
<p>Records a new event. Events recorded this way must be completed events, i.e. either period events with a known duration or mark events. To start a running period event, post a <code>events/start</code> request.</p>
<p>In addition to the usual JSON, this request accepts standard multipart/form-data content to support the creation of event with attached files in a single request. When sending a multipart request, one content part must hold the JSON for the new event and all other content parts must be the attached files.</p>
<h4>Body parameters</h4>
<p>The new event's data: see <a href="#data-structure-event">Event</a>.</p>
<h4>Successful response: <code>201 Created</code></h4>
<ul>
<li><code>id</code> (<a href="#data-structure-identity">identity</a>): The new event's id.</li>
<li><code>stoppedId</code> (<a href="#data-structure-identity">identity</a>): Only in channels with <code>enforceNoEventsOverlap</code>. If set, indicates the id of the previously running period event that was stopped as a consequence of inserting the new event.</li>
</ul>
<h4>Specific errors</h4>
<ul>
<li><code>400 Bad Request</code>, id <code>unknown-folder</code>: The specified folder cannot be found.</li>
<li><code>400 Bad Request</code>, id <code>invalid-operation</code>: The channel or specified folder is in the trash, and we prevent the recording of new events into trashed channels / folders. The error's <code>data.trashed</code> property indicates either <code>"channel"</code> or <code>"folder"</code>.</li>
<li><code>400 Bad request</code>, id <code>periods-overlap</code>: Only in channels with <code>enforceNoEventsOverlap</code>: the new event overlaps existing period events. The overlapped events' ids are listed as an array in the error's <code>data.overlappedIds</code>.</li>
</ul>
</div><aside><h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">curl -i -H <span class="string">"Content-Type: application/json"</span> -X POST -d <span class="string">'{"folderId":"{folder-id}"}'</span> https://{username}.pryv.io/{channel-id}/events?auth={access-token}</code></pre>
<p>TODO: multipart/form-data example</p>
</aside></section><section class="method"><h3>Start period</h3><div class="content"><p><code>POST /{channel-id}/events/start</code>, Socket.IO: <code>{channel-id}.events.start</code></p>
<p>Starts a new period event. In channels with <code>enforceNoEventsOverlap</code>, also stops the previously running period event if any. See POST <code>/{channel-id}/events</code> for details. TODO: detail</p>
<h4>Body parameters</h4>
<p>See POST <code>{channel-id}/events</code>.</p>
<h4>Successful response: <code>201 Created</code></h4>
<h4>Specific errors</h4>
<p>See POST <code>/{channel-id}/events</code>.</p>
</div><aside><h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">curl -i -H <span class="string">"Content-Type: application/json"</span> -X POST -d <span class="string">'{"folderId":"{folder-id}"}'</span> https://{username}.pryv.io/{channel-id}/events/start?auth={access-token}</code></pre>
</aside></section><section class="method"><h3>Stop period</h3><div class="content"><p><code>POST /{channel-id}/events/stop</code>, Socket.IO: <code>{channel-id}.events.stop</code></p>
<p>Stops a previously running period event. In channels with <code>enforceNoEventsOverlap</code>, which guarantee that only one event is running at any given time, that event is automatically determined; for regular channels, the event to stop must be specified.</p>
<h4>Body parameters</h4>
<ul>
<li><code>id</code> (<a href="#data-structure-identity">identity</a>): The id of the event to stop. Optional in channels with <code>enforceNoEventsOverlap</code>.</li>
<li><code>time</code> (<a href="#data-structure-timestamp">timestamp</a>): Optional. The stop time. Default: now.</li>
</ul>
<h4>Successful response: <code>200 OK</code></h4>
<ul>
<li><code>stoppedId</code> (<a href="#data-structure-identity">identity</a>): The id of the previously running period event that was stopped, or null if no running event was found.</li>
</ul>
<h4>Specific errors</h4>
<ul>
<li><code>400 Bad Request</code>, id <code>unknown-event</code>: The specified event cannot be found.</li>
<li><code>400 Bad Request</code>, id <code>invalid-operation</code>: The specified event is not a running period event.</li>
<li><code>400 Bad Request</code>, id <code>missing-parameter</code>: No event was specified and the channel does not <code>enforceNoEventsOverlap</code> (so that there can be more than one running event).</li>
</ul>
</div><aside><h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
</aside></section><section class="method"><h3>Get running periods</h3><div class="content"><p><code>GET /{channel-id}/events/running</code>, Socket.IO: <code>{channel-id}.events.getRunning</code></p>
<p>Gets the currently running period events.</p>
<h4>Successful response: <code>200 OK</code></h4>
<p>An array of <a href="#data-structure-event">events</a> containing the running period events.</p>
</div><aside><h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
</aside></section><section class="method"><h3>Update event</h3><div class="content"><p><code>PUT /{channel-id}/events/{event-id}</code>, Socket.IO: <code>{channel-id}.events.update</code>*</p>
<p>Modifies the event's attributes.</p>
<h4>Body parameters</h4>
<p>New values for the event's fields: see <a href="#data-structure-event">event</a>. All fields are optional, and only modified values must be included. TODO: example</p>
<h4>Successful response: <code>200 OK</code></h4>
<ul>
<li><code>stoppedId</code> (<a href="#data-structure-identity">identity</a>): If set, indicates the id of the previously running period event that was stopped as a consequence of modifying the event.</li>
</ul>
<h4>Specific errors</h4>
<ul>
<li><code>400 Bad Request</code>, id <code>invalid-operation</code>: Returned for period events, if attempting to set the event's duration to <code>undefined</code> (i.e. still running) while one or more other period events were recorded after it. The error's <code>data.conflictingPeriodId</code> provides the id of the closest conflicting event.</li>
<li><code>400 Bad Request</code>, id <code>periods-overlap</code>: Returned for period events, if attempting to change the event's duration to a value that causes an overlap with one or more subsequent period event(s). The overlapped events' ids are listed as an array in the error's <code>data.overlappedIds</code>.</li>
</ul>
</div><aside><h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
</aside></section><section class="method"><h3>Add attached file(s) to event</h3><div class="content"><p><code>POST /{channel-id}/events/{event-id}</code></p>
<p>Adds one or more file attachments to the event. This request expects standard multipart/form-data content, with all content parts being the attached files.</p>
<h4>Successful response: <code>200 OK</code></h4>
</div><aside><h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">curl -i -F <span class="string">'event={"type":{"class":"picture","format":"attached"}}'</span>  -F <span class="string">'file=@-'</span> https://{username}.rec.la/{channel-id}/events?auth={token} &lt; {filename}</code></pre>
<p>...or...</p>
<pre class="highlighted"><code class="language-bash">curl -i -F <span class="string">'event={"type":{"class":"picture","format":"attached"}}'</span>  -F <span class="string">"file=@{filename}"</span> https://{username}.rec.la/{channel-id}/events?auth={token}</code></pre>
</aside></section><section class="method"><h3>Delete event</h3><div class="content"><p><code>DELETE /{channel-id}/events/{event-id}</code>, Socket.IO: <code>{channel-id}.events.del</code></p>
<p>Trashes or deletes the specified event, depending on its current state:</p>
<ul>
<li>If the event is not already in the trash, it will be moved to the trash (i.e. flagged as <code>trashed</code>)</li>
<li>If the event is already in the trash, it will be irreversibly deleted (including all its attached files, if any).</li>
</ul>
<h4>Successful response: <code>200 OK</code></h4>
</div><aside><h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
</aside></section><section class="method"><h3>Get attached file</h3><div class="content"><p><code>GET /{channel-id}/events/{event-id}/{file name}</code></p>
<p>Gets the attached file.</p>
<h4>Successful response: <code>200 OK</code></h4>
</div><aside><h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
</aside></section><section class="method"><h3>Delete attached file</h3><div class="content"><p><code>DELETE /{channel-id}/events/{event-id}/{filename}</code>, Socket.IO: <code>{channel-id}.events.deleteAttachedFile</code></p>
<p>Irreversibly deletes the attached file.</p>
<h4>Successful response: <code>200 OK</code></h4>
</div><aside><h4>cURL example</h4>
<p><code>bash</code></p>
</aside></section><section class="method"><h3>Batch-create events</h3><div class="content"><p><code>POST /{channel-id}/events/batch</code>, Socket.IO: <code>{channel-id}.events.createBatch</code></p>
<p>Batch upload events that were recorded by the client while offline. The submitted events are added in-order, with results returned individually for each (see response below).</p>
<h4>Body parameters</h4>
<p>An array of client-recorded <a href="#data-structure-event">events</a>. In addition to the regular properties, each event must have a unique <code>tempRefId</code> defined (as it's temporary it must only be unique within the request). Also, make sure that the events' <code>time</code> is set in server time (as for single event requests).</p>
<h4>Successful response: <code>200 OK</code></h4>
<p>An object with one property per event submitted holding the result for that event. Each property's name is the submitted event's client id, and its value contains:</p>
<ul>
<li>If the event was successful created, an object with the <code>id</code> of the event, and possibly the <code>stoppedId</code> of the running period event that was stopped as a result. (For details, see POST <code>/{channel-id}/events</code>.)</li>
<li>If there was an error creating the event: an object with an <code>error</code> property holding the encountered <a href="#data-structure-error">error</a>.</li>
</ul>
</div><aside><h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">```

<span class="comment">#### Example response</span>
```json
{
  <span class="string">"temp_ref_id_1"</span>: {<span class="string">"id"</span>: <span class="string">"TTMyhYEZriJ"</span>},
  <span class="string">"temp_ref_id_2"</span>: {<span class="string">"error"</span>: {
    <span class="string">"id"</span>: <span class="string">"unknown-folder"</span>,
    <span class="string">"message"</span>: <span class="string">"Folder 'bad-folder-id' is unknown."</span>
  }}
}</code></pre>
</aside></section></section><section><h2>Folders</h2><div class="intro"><p>Methods to retrieve and manipulate <a href="#data-structure-folder">folders</a>.</p>
</div><section class="method"><h3>Get folders</h3><div class="content"><p><code>GET /{channel-id}/folders</code>, Socket.IO: <code>{channel-id}.folders.get</code></p>
<p>Gets the accessible folders, either from the root level or only descending from a specified parent folder.</p>
<h4>Parameters</h4>
<ul>
<li><code>parentId</code> (<a href="#data-structure-identity">identity</a>): Optional. The id of the parent folder to use as root for the request. Default: <code>null</code> (returns all accessible folders from the root level).</li>
<li><code>includeHidden</code> (<code>true</code> or <code>false</code>): Optional. When <code>true</code>, folders that are currently hidden will be included in the result. Default: <code>false</code>.</li>
<li><code>state</code> (<code>default</code>, <code>trashed</code> or <code>all</code>): Optional. Indicates what items to return depending on their state. By default, only items that are not in the trash are returned; <code>trashed</code> returns only items in the trash, while <code>all</code> return all items regardless of their state.</li>
<li><code>timeCountBase</code> (<a href="#data-structure-timestamp">timestamp</a>): Optional. If specified, the returned folders will include the summed duration of all their period events, starting from this timestamp (see <code>timeCount</code> in <a href="#data-structure-folder">activity folder</a>); otherwise no time count values will be returned.</li>
</ul>
<h4>Successful response: <code>200 OK</code></h4>
<p>An array of <a href="#data-structure-folder">activity folders</a> containing the tree of the accessible folders, sorted by name.</p>
<h4>Specific errors</h4>
<ul>
<li><code>400 Bad Request</code>, id <code>unknown-folder</code>: The specified parent folder can't be found.</li>
</ul>
</div><aside><h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
</aside></section><section class="method"><h3>Create folder</h3><div class="content"><p><code>POST /{channel-id}/folders</code>, Socket.IO: <code>{channel-id}.folders.create</code></p>
<p>Creates a new folder at the root level or as a child folder to the specified folder.</p>
<h4>Body parameters</h4>
<p>The new folder's data: see <a href="#data-structure-folder">activity folder</a>.</p>
<h4>Successful response: <code>201 Created</code></h4>
<ul>
<li><code>id</code> (<a href="#data-structure-identity">identity</a>): The created folder's id.</li>
</ul>
<h4>Specific errors</h4>
<ul>
<li><code>400 Bad Request</code>, id <code>item-id-already-exists</code>: A folder already exists with the same id.</li>
<li><code>400 Bad Request</code>, id <code>item-name-already-exists</code>: A sibling folder already exists with the same name.</li>
<li><code>400 Bad Request</code>, id <code>invalid-item-id</code>: Occurs if trying to set the id to an invalid value (e.g. a reserved word like <code>"null"</code>).</li>
</ul>
</div><aside><h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
</aside></section><section class="method"><h3>Update folder</h3><div class="content"><p><code>PUT /{channel-id}/folders/{folder-id}</code>, Socket.IO: <code>{channel-id}.folders.update</code>*</p>
<p>Modifies the activity folder's attributes.</p>
<h4>Body parameters</h4>
<p>New values for the folder's fields: see <a href="#data-structure-folder">activity folder</a>. All fields are optional, and only modified values must be included.</p>
<h4>Successful response: <code>200 OK</code></h4>
<h4>Specific errors</h4>
<ul>
<li><code>400 Bad Request</code>, id <code>unknown-folder</code>: The specified parent folder's id is unknown.</li>
<li><code>400 Bad Request</code>, id <code>item-name-already-exists</code>: A sibling folder already exists with the same name.</li>
</ul>
</div><aside><h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
</aside></section><section class="method"><h3>Delete folder</h3><div class="content"><p><code>DELETE /{channel-id}/folders/{folder-id}</code>, Socket.IO: <code>{channel-id}.folders.del</code></p>
<p>Trashes or deletes the specified folder, depending on its current state:</p>
<ul>
<li>If the folder is not already in the trash, it will be moved to the trash (i.e. flagged as <code>trashed</code>)</li>
<li>If the folder is already in the trash, it will be irreversibly deleted with its possible descendants. If events exist that refer to the deleted item(s), you must indicate how to handle them with the parameter <code>mergeEventsWithParent</code>..</li>
</ul>
<h4>Parameters</h4>
<ul>
<li><code>mergeEventsWithParent</code> (<code>true</code> or <code>false</code>): Required if actually deleting the item and if it (or any of its descendants) has linked events, ignored otherwise. If <code>true</code>, the linked events will be assigned to the parent of the deleted item; if <code>false</code>, the linked events will be deleted.</li>
</ul>
<h4>Successful response: <code>200 OK</code></h4>
<h4>Specific errors</h4>
<ul>
<li><code>400 Bad Request</code>, id <code>missing-parameter</code>: There are events referring to the deleted items and the <code>mergeEventsWithParent</code> parameter is missing.</li>
</ul>
</div><aside><h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
</aside></section></section><section><h2><a id="activity-accesses"></a>Accesses</h2><div class="intro"><p>While full access management is reserved for trusted apps, any app can retrieve and manage shared accesses depending on its own permissions. All methods here only deal with shared accesses whose permissions are a subset of that linked to the token used for the requests. (You'll get a <code>403 Forbidden</code> error if trying to touch other types of accesses, or shared accesses with greater permissions.)</p>
</div><section class="method"><h3>Get current access info</h3><div class="content"><p><code>GET /access-info</code></p>
<p>Retrieves information about the current access.</p>
<h4>Successful response: <code>200 OK</code></h4>
<p>An object with the <a href="#data-structure-access">access'</a> <code>name</code>, <code>type</code> and <code>permissions</code>.</p>
</div><aside><h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">curl -i -H <span class="string">"Authorization: {access-token}"</span> https://{username}.pryv.io/access-info</code></pre>
</aside></section><section class="method"><h3>Get accesses</h3><div class="content"><p><code>GET /accesses</code></p>
<p>Gets all manageable shared accesses.</p>
<h4>Successful response: <code>200 OK</code></h4>
<p>An array of <a href="#data-structure-access">accesses</a> containing all manageable shared accesses in the user's account, ordered by name.</p>
</div><aside><h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">curl -i -H <span class="string">"Authorization: {access-token}"</span> https://{username}.pryv.io/accesses</code></pre>
</aside></section><section class="method"><h3>Create access</h3><div class="content"><p><code>POST /accesses</code></p>
<p>Creates a new shared access. You can only create accesses whose permissions are a subset of those linked to your own access token.</p>
<h4>Parameters</h4>
<p>The new access's data: see <a href="#data-structure-access">access</a>.</p>
<h4>Successful response: <code>201 Created</code></h4>
<ul>
<li><code>token</code> (<a href="#data-structure-identity">identity</a>): The created access's token.</li>
</ul>
<h4>Specific errors</h4>
<ul>
<li><code>400 Bad Request</code>, id <code>invalid-item-id</code>: Occurs if trying to set the token to an invalid value (e.g. a reserved word like <code>"null"</code>).</li>
</ul>
</div><aside><h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
</aside></section><section class="method"><h3>Update access</h3><div class="content"><p><code>PUT /accesses/{token}</code></p>
<p>Modifies the specified shared access. You can only modify accesses whose permissions are a subset of those linked to your own access token.</p>
<h4>Parameters</h4>
<p>New values for the access's fields: see <a href="#data-structure-access">access</a>. All fields are optional, and only modified values must be included. TODO: example</p>
<h4>Successful response: <code>200 OK</code></h4>
</div><aside><h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
</aside></section><section class="method"><h3>Delete access</h3><div class="content"><p><code>DELETE /accesses/{token}</code></p>
<p>Deletes the specified shared access. You can only delete accesses whose permissions are a subset of those linked to your own access token.</p>
<h4>Successful response: <code>200 OK</code></h4>
</div><aside><h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
</aside></section></section><section><h2><a id="activity-profile-app"></a>App profile</h2><div class="intro"><p>The app profile is a simple key-value store available for your app to keep user settings. It is exposed as a plain object with free structure. The adding/updating/deleting of settings is designed in the expectation that each setting is a key at the profile object's root, but you can structure your profile differently if you wish.</p>
<p>The app profile can only be used if authentified with an app access token.</p>
</div><section class="method"><h3>Get app settings</h3><div class="content"><p><code>GET /profile/app</code></p>
<p>Gets your app profile settings.</p>
<h4>Successful response: <code>200 OK</code></h4>
<p>An object containing your app's current profile settings. The method always returns an object (which will be empty if your app never defined any setting).</p>
</div><aside><h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
</aside></section><section class="method"><h3>Update profile settings</h3><div class="content"><p><code>PUT /profile/app</code></p>
<p>Adds, updates or delete settings.</p>
<ul>
<li>To add or update a setting, just set its value</li>
<li>To delete a field, set its value to <code>null</code></li>
</ul>
<p>Settings you don't specify in the update are left untouched.</p>
<h4>Parameters</h4>
<p>An object with the desired changes to the settings (see above).</p>
<h4>Successful response: <code>200 OK</code></h4>
</div><aside><h4>Simple example</h4>
<pre class="highlighted"><code class="language-json">{
  "<span class="attribute">keyToAddOrUpdate</span>": <span class="value"><span class="string">"value"</span></span>,
  "<span class="attribute">keyToDelete</span>": <span class="value"><span class="literal">null</span>
</span>}</code></pre>
<h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
</aside></section></section><section><h2><a id="activity-profile-public"></a>Public profile</h2><div class="intro"><p>The public profile is a simple read-only object exposing publicly shared user information (e.g. avatar image) for use in your app.</p>
</div><section class="method"><h3>Get public info</h3><div class="content"><p><code>GET /profile/public</code></p>
<p>Gets the user's public profile info.</p>
<h4>Successful response: <code>200 OK</code></h4>
<p>An object containing the user's current public profile information.</p>
</div><aside><h4>cURL example</h4>
<pre class="highlighted"><code class="language-bash">
</code></pre>
</aside></section></section></section><section id="socketio"><h1>Socket.IO support</h1><div class="intro"><p>The activity service supports real-time interaction with <a href="http://socket.io">Socket.IO</a>, both by accepting equivalent messages for most API methods and by emitting data change notification messages. (Code examples below are in Javascript.)</p>
</div><section><h3>Connecting</h3><div class="content"><p>In order to use Socket.IO, your app must first load the appropriate Socket.IO client library. For a Javascript web app, that's the <code>socket.io.js</code> file served by the activity server at the following URL: <code>https://{username}.pryv.io/socket.io/socket.io.js</code>. (For other languages see the related section on the <a href="https://github.com/learnboost/socket.io/wiki">Socket.IO wiki</a>.)</p>
<p>The second step is to initialize the connection. Here's the URL you need to use:</p>
<pre class="highlighted"><code class="ruby">https<span class="symbol">:</span>/<span class="regexp">/{username}.pryv.io:443/</span>{username}<span class="number">?a</span>uth={accessToken}&amp;resource=<span class="regexp">/{username}</span></code></pre>
</div><aside><p>For example, in Javascript do:</p>
<pre class="highlighted"><code class="language-javascript"><span class="keyword">var</span> socket = io.connect(<span class="string">"https://mathurin.pryv.io:443/mathurin?auth=TVVro8e8T5&amp;resource=/mathurin"</span>)</code></pre>
</aside></section><section><h3>Calling API methods</h3><div class="content"><p>Every method in the activity service can be called by sending a corresponding Socket.IO <code>command</code> message, providing a data object specifying the command (or method) and possible parameters, and a callback function for the response:</p>
<pre class="highlighted"><code class="language-javascript">socket.emit(<span class="string">'command'</span>, {id: <span class="string">'{id}'</span>, params: {<span class="comment">/*parameters*/</span>}}, <span class="function"><span class="keyword">function</span> <span class="params">(error, data)</span> {</span>
  <span class="comment">// handle response here</span>
});</code></pre>
<p>Command ids are indicated for each API method and are modeled after the equivalent URL path.</p>
</div><aside><p>Here's how you could retrieve events:</p>
<pre class="highlighted"><code class="language-javascript"><span class="keyword">var</span> cmdData = {
  id: <span class="string">'{channel-id}.events.get'</span>,
  params: {
    sortAscending: <span class="literal">true</span>
  }
};
socket.emit(<span class="string">'command'</span>, cmdData, <span class="function"><span class="keyword">function</span> <span class="params">(error, data)</span> {</span>
  <span class="comment">// handle response</span>
});</code></pre>
</aside></section><section><h3>Receiving data change notifications</h3><div class="content"><p>You can be notified of changes to channels, folders and events by subscribing to the corresponding messages <code>channelsChanged</code>, <code>eventsChanged</code> and <code>foldersChanged</code>. For the latter two, the message is passed a parameters object with a <code>channelId</code> property to help you refresh only what's necessary.</p>
</div><aside><p>For example:</p>
<pre class="highlighted"><code class="language-javascript">socket.on(<span class="string">'channelsChanged'</span>, <span class="keyword">function</span>() { <span class="comment">// no scope parameter for channels</span>
  <span class="comment">// ... (retrieve latest changes and update)</span>
});
socket.on(<span class="string">'eventsChanged'</span>, <span class="keyword">function</span>(scope) {
  <span class="comment">// scope.channelId contains the related channel id</span>
  <span class="comment">// ... (retrieve latest changes and update)</span>
});</code></pre>
</aside></section></section><section id="data-structure"><h1>Data structure</h1><div class="intro"><p>This section describes the structure of the different types of objects and values exchanged in the API.</p>
<p>Notes:</p>
<ul>
<li>"Read-only" = server-assigned, never set or modified by clients</li>
<li>We should and will reformat items structure for quick visual parsing (e.g. using tables, or at least coloured labels for stuff like "optional")—for the moment we've consciously chosen low-formatting, quick-to-edit bullet lists</li>
</ul>
</div><section><h2><a id="data-structure-channel"></a>Channel</h2><div class="content"><p>Each activity channel represents a "stream" or "type" of activity to track, acting as a storage bucket for related events.
Fields:</p>
<ul>
<li><code>id</code> (<a href="#data-structure-identity">identity</a>): Unique, read-only (except at creation). The identifier for the channel. Automatically generated if not set when creating the channel; <strong>slugified if necessary</strong>.</li>
<li><code>name</code> (string): Unique. The name identifying the channel for users.</li>
<li><code>enforceNoEventsOverlap</code> (boolean): Optional. If specified and <code>true</code>, the system will ensure that period events in this channel never overlap.</li>
<li><code>clientData</code> (<a href="#data-structure-additional-data">item additional data</a>): Optional. Additional client data for the channel.</li>
<li><code>timeCount</code> (<a href="#data-structure-timestamp">timestamp</a>): Read-only. Only optionally returned when querying channels, indicating the total time tracked in that channel since a given reference date and time. <strong>This will be implemented later.</strong></li>
<li><code>trashed</code> (boolean): Optional. <code>true</code> if the channel is in the trash.</li>
</ul>
</div><aside><p>TODO: example</p>
</aside></section><section><h2><a id="data-structure-event"></a>Event</h2><div class="content"><p>Events can be period events, which are associated with a period of time, or mark events, which are just associated with a single point in time:</p>
<ul>
<li>Period events are used to track everything with a duration, like time spent drafting a project proposal, meeting with the customer or staying at a particular location.</li>
<li>Mark events are used to track everything else, like a note, a log message, a GPS location, a temperature measurement, or a stock market asset value.</li>
</ul>
<p>Period events carry a duration, mark events do not. Like folders, events always belong to an activity channel.</p>
<p>Fields:</p>
<ul>
<li><code>id</code> (<a href="#data-structure-identity">identity</a>): Unique, read-only. The server-assigned identifier for the event.</li>
<li><code>channelId</code> (<a href="#data-structure-identity">identity</a>): Read-only. The id of the belonging channel.</li>
<li><code>time</code> (<a href="#data-structure-timestamp">timestamp</a>): The event's time. For period events, this is the time the event started.</li>
<li><code>duration</code> (<a href="#data-structure-timestamp">timestamp</a> difference): Optional. If present, indicates that the event is a period event. <strong>Running period events have a duration set to <code>null</code></strong>. (We use a dedicated field for duration—instead of using the <code>value</code> field—as we do specific processing of event durations, intervals and overlapping.)</li>
<li><code>type</code> (object): The type of the event. See the <a href="event-types.html#directory">event type directory</a> for a list of standard types.<ul>
<li><code>class</code> (string): The type's class. Events in the same class are considered comparable and convertible.</li>
<li><code>format</code> (string): The type's format. Depending on the class, it may indicate a measurement unit, a currency, a string format, an object structure, etc. Together with <code>class</code>, it indicates how to handle the event's <code>value</code>, if any.</li>
</ul>
</li>
<li><code>value</code> (any type): Optional. The value associated with the event, if any. Depending on the <code>type</code>, this may be a mathematical value (e.g. mass, money, length, position, etc.), a link to a page, location coordinates, etc.</li>
<li><code>folderId</code>(<a href="#data-structure-identity">identity</a>): Optional but always present in read items. Indicates the particular folder the event is associated with; <code>null</code> if no folder is assigned.</li>
<li><code>tags</code> (array of strings): Optional but always present in read items. The tags associated with the event.</li>
<li><code>description</code> (string): Optional. User description or comment for the event.</li>
<li><code>attachments</code>: Optional and read-only. An object describing the files attached to the event. Each of its properties corresponds to one file and has the following structure:<ul>
<li><code>fileName</code> (string): The file's name. The attached file's URL is obtained by appending this file name to the event's resource URL.</li>
<li><code>type</code> (string): The MIME type of the file.</li>
<li><code>size</code> (number): The size of the file, in bytes.</li>
</ul>
</li>
<li><code>clientData</code> (<a href="#data-structure-additional-data">additional item data</a>):  Optional. Additional client data for the event.</li>
<li><code>trashed</code> (boolean): Optional. <code>true</code> if the event is in the trash.</li>
<li><code>modified</code> (<a href="#data-structure-timestamp">timestamp</a>): Read-only. The time the event was last modified.</li>
</ul>
</div><aside><h4>Example</h4>
<pre class="highlighted"><code class="language-javascript">[
  { <span class="string">"time"</span>: <span class="number">1350365877.359</span>, <span class="string">"description"</span> : <span class="string">"Some pics"</span>, <span class="string">"id"</span> : <span class="string">"event_0"</span>, <span class="string">"folderId"</span> : <span class="literal">null</span>,
    <span class="string">"tags"</span>: [<span class="string">"foraging"</span>, <span class="string">"funny"</span>],
    <span class="string">"type"</span>: { <span class="string">"class"</span>: <span class="string">"picture"</span>, <span class="string">"format"</span>: <span class="string">"attached"</span> },
    <span class="string">"attachments"</span> : {
      <span class="string">"Gina"</span>: { <span class="string">"fileName"</span>: <span class="string">"gina.jpeg"</span>, <span class="string">"type"</span>: <span class="string">"image/jpeg"</span>, <span class="string">"size"</span>: <span class="number">1236701</span> },
      <span class="string">"Enzo"</span>: { <span class="string">"fileName"</span>: <span class="string">"enzo.jpeg"</span>, <span class="string">"type"</span>: <span class="string">"image/jpeg"</span>, <span class="string">"size"</span>: <span class="number">1127465</span> }},
      <span class="string">"modified"</span> : <span class="number">1350463077.359</span> },
  { <span class="string">"time"</span> : <span class="number">1350369477.359</span>, <span class="string">"duration"</span> : <span class="number">7140</span>, <span class="string">"description"</span>: <span class="string">"A period of work"</span>,
    <span class="string">"id"</span> : <span class="string">"event_1"</span>, <span class="string">"folderId"</span> : <span class="string">"free-veggies"</span>,
    <span class="string">"tags"</span>: [<span class="string">"proposal"</span>],
    <span class="string">"type"</span>: { <span class="string">"class"</span>: <span class="string">"activity"</span>, <span class="string">"format"</span>: <span class="string">"pryv"</span> },
    <span class="string">"modified"</span> : <span class="number">1350369477.359</span> },
  { <span class="string">"time"</span> : <span class="number">1350373077.359</span>, <span class="string">"description"</span> : <span class="string">"A position"</span>, <span class="string">"id"</span> : <span class="string">"event_2"</span>, <span class="string">"folderId"</span> : <span class="literal">null</span>,
    <span class="string">"tags"</span>: [],
    <span class="string">"type"</span>: { <span class="string">"class"</span>: <span class="string">"position"</span>, <span class="string">"format"</span>: <span class="string">"wgs84"</span> },
    <span class="string">"value"</span>: { <span class="string">"location"</span>: { <span class="string">"lat"</span>: <span class="number">40.714728</span>, <span class="string">"lng"</span>: -<span class="number">73.998672</span>, <span class="number">12</span> } },
    <span class="string">"modified"</span> : <span class="number">1350373077.359</span> }
]</code></pre>
</aside></section><section><h2><a id="data-structure-folder"></a>Folder</h2><div class="content"><p>Activity folders are the possible states or categories you track the channel's events into (folders are always specific to an activity channel). Every period event belongs to one folder, while mark events can be recorded "off-folder" as well. Activity folders follow a hierarchical tree structure: every folder can contain "child" folders (sub-folders).</p>
<p>Fields:</p>
<ul>
<li><code>id</code> (<a href="#data-structure-identity">identity</a>): Unique, read-only (except at creation). The identifier for the folder. Automatically generated if not set when creating the folder; <strong>slugified if necessary</strong>.</li>
<li><code>channelId</code> (<a href="#data-structure-identity">identity</a>): Read-only. The id of the belonging channel.</li>
<li><code>name</code> (string): A name identifying the folder for users. The name must be unique among the folder's siblings in the folders tree structure.</li>
<li><code>parentId</code> (<a href="#data-structure-identity">identity</a>): Optional. The identifier of the folder's parent, if any. A value of <code>null</code> indicates that the folder has no parent (i.e. root folder).</li>
<li><code>hidden</code> (<code>true</code> or <code>false</code>): Optional. Whether the folder is currently in use or visible. Default: <code>true</code>.</li>
<li><code>clientData</code> (<a href="#data-structure-additional-data">item additional data</a>):  Optional. Additional client data for the folder.</li>
<li><code>timeCount</code> (<a href="#data-structure-timestamp">timestamp</a>): Read-only. Only optionally returned when querying folders, indicating the total time spent in that folder, including sub-folders, since a given reference date and time. <strong>This will be implemented later.</strong></li>
<li><code>children</code> (array of folders): Read-only. The folder's sub-folders, if any. This field cannot be set in requests creating a new folders: folders are created individually by design.</li>
<li><code>trashed</code> (boolean): Optional. <code>true</code> if the folder is in the trash.</li>
</ul>
</div><aside><h4>Example</h4>
<p>A folder structure for activities:</p>
<pre class="highlighted"><code class="language-javascript">[
  { <span class="string">"name"</span>: <span class="string">"Sport"</span>, <span class="string">"id"</span>: <span class="string">"sport"</span>, <span class="string">"parentId"</span>: <span class="literal">null</span>,
    <span class="string">"children"</span>: [
      { <span class="string">"name"</span>: <span class="string">"Jogging"</span>, <span class="string">"id"</span>: <span class="string">"jogging"</span>, <span class="string">"parentId"</span>: <span class="string">"sport"</span>, <span class="string">"children"</span>: [] },
      { <span class="string">"name"</span>: <span class="string">"Bicycling"</span>, <span class="string">"id"</span>: <span class="string">"bicycling"</span>, <span class="string">"parentId"</span>: <span class="string">"sport"</span>, <span class="string">"children"</span>: [] }
  ]},
  { <span class="string">"name"</span>: <span class="string">"Work"</span>, <span class="string">"id"</span>: <span class="string">"work"</span>, <span class="string">"parentId"</span>: <span class="literal">null</span>,
    <span class="string">"children"</span>: [
      { <span class="string">"name"</span>: <span class="string">"Noble Works Co."</span>, <span class="string">"id"</span>: <span class="string">"noble-works"</span>,<span class="string">"parentId"</span>: <span class="string">"work"</span>, <span class="string">"children"</span>: [
          { <span class="string">"name"</span>: <span class="string">"Last Be First"</span>, <span class="string">"id"</span>: <span class="string">"last-be-first"</span>,<span class="string">"parentId"</span>: <span class="string">"noble-works"</span>, <span class="string">"children"</span>: [] },
          { <span class="string">"name"</span>: <span class="string">"Big Tree"</span>, <span class="string">"id"</span>: <span class="string">"big-tree"</span>,<span class="string">"parentId"</span>: <span class="string">"noble-works"</span>, <span class="string">"children"</span>: [] },
          { <span class="string">"name"</span>: <span class="string">"Inner Light"</span>, <span class="string">"id"</span>: <span class="string">"inner-light"</span>,<span class="string">"parentId"</span>: <span class="string">"noble-works"</span>, <span class="string">"children"</span>: [] }
      ]},
      { <span class="string">"name"</span>: <span class="string">"Freelancing"</span>, <span class="string">"id"</span>: <span class="string">"freelancing"</span>,<span class="string">"parentId"</span>: <span class="string">"work"</span>, <span class="string">"children"</span>: [
          { <span class="string">"name"</span>: <span class="string">"Funky Veggies"</span>, <span class="string">"id"</span>: <span class="string">"funky-veggies"</span>,<span class="string">"parentId"</span>: <span class="string">"freelancing"</span>, <span class="string">"children"</span>: [] },
          { <span class="string">"name"</span>: <span class="string">"Jojo Lapin &amp; sons"</span>, <span class="string">"id"</span>: <span class="string">"jojo-lapin"</span>,<span class="string">"parentId"</span>: <span class="string">"freelancing"</span>, <span class="string">"children"</span>: [] }
      ]}
    ]
  }
];</code></pre>
</aside></section><section><h2><a id="data-structure-access"></a>Access</h2><div class="content"><p>An access defines a set of permissions on a user's activity data (channels, folders and events). (See <a href="overview.html#sharing">how sharing works</a>.)</p>
<p>Fields:</p>
<ul>
<li><code>token</code> (string): Unique, read-only (except at creation). The token identifying the access. Automatically generated if not set when creating the access; <strong>slugified if necessary</strong>.</li>
<li><code>type</code> (<code>"personal"</code>, <code>"app"</code> or <code>"shared"</code>): Optional. The type — or usage — of the access. Default: <code>"shared"</code>.</li>
<li><code>name</code> (string): Unique <em>per type and device name (if defined)</em>. The name identifying the access for the user. (Note that for personal and app access, the name is used as a technical identifier and not shown as-is to the user.)</li>
<li><code>deviceName</code> (string): Optional. Unique <em>per type and name (if defined)</em>. For app accesses only. The name of the client device running the app, if applicable.</li>
<li><code>permissions</code>: an array of channel permission objects as described below. Ignored for personal accesses. Shared accesses are only granted access to activity data objects listed in here.<ul>
<li><code>channelId</code> (<a href="#data-structure-identity">identity</a>): The accessible channel's id, or <code>"*"</code> for "all channels".</li>
<li><code>level</code> (<code>"read"</code>, <code>"contribute"</code> or <code>"manage"</code>): The level of access to the channel. With <code>"contribute"</code>, the access's token holder(s) can see and record events in the channel; with <code>"manage"</code>, the access's token holder(s) can in addition modify the channel itself. This is overridden if specific folder permissions are defined (see below).</li>
<li><code>folderPermissions</code>: Optional. An array of folder permission objects to define specific per-folder permissions. If defined, only the folders listed here will be accessible.<ul>
<li><code>folderId</code> (<a href="#data-structure-identity">identity</a>): The accessible folder's id. If the folder has child folders, they will be accessible too. A  value of <code>null</code> can be used to set permissions for events that have no folder assigned.</li>
<li><code>level</code> (<code>"read"</code>, <code>"contribute"</code> or <code>"manage"</code>): The level of access to the folder. With <code>"contribute"</code>, the access's token holder(s) can see and record events for the folder (and its child folders, if any); with <code>"manage"</code>, the access's token holder(s) can in addition create, modify and delete child folders.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>A note about permissions: if the access defines conflicting permission levels (e.g. a folder set to "manage" but a child folder within it set to "contribute"), only the highest level is considered.</p>
</div><aside><p>TODO: example</p>
</aside></section><section><h2><a id="data-structure-bookmark"></a>Bookmark</h2><div class="content"><p>Sharing bookmarks allow the user to keep track of accesses shared with her by other users.</p>
<p>Fields:</p>
<ul>
<li><code>id</code> (<a href="#data-structure-identity">identity</a>): Unique, read-only. The server-assigned identifier for the bookmark.</li>
<li><code>name</code> (string): Unique. A name identifying the bookmark for the user.</li>
<li><code>url</code> (string): The url pointing to the shared access's owning user's server. Not modifiable after creation.</li>
<li><code>accessToken</code> <a href="#data-structure-identity">identity</a>: The token of the shared access itself. Not modifiable after creation.</li>
</ul>
</div><aside><p>TODO: example</p>
</aside></section><section><h2><a id="data-structure-additional-data"></a>Item additional data</h2><div class="content"><p>An object (key-value map) for client apps to store additional data about the containing item (channel, event, etc.), such as a color, a reference to an associated icon, or other app-specific metadata.</p>
<h3>Adding, updating and removing client data</h3>
<p>When the containing item is updated, additional data fields can be added, updated and removed as follows:</p>
<ul>
<li>To add or update a field, just set its value; for example: <code>{"clientData": {"keyToAddOrUpdate": "value"}}</code></li>
<li>To delete a field, set its value to <code>null</code>; for example: <code>{"clientData": {"keyToDelete": null}}</code></li>
</ul>
<p>Fields you don't specify in the update are left untouched.</p>
<h3>Naming convention</h3>
<p>The convention is that each app names the keys it uses with an <code>"{app-id}:"</code> prefix. For example, an app with id "riki" would store its data in fields such as <code>"riki:key": "some value"</code>.</p>
</div></section><section><h2><a id="data-structure-error"></a>Error</h2><div class="content"><p>Fields:</p>
<ul>
<li><code>id</code> (string): Identifier for the error; complements the response's HTTP error code.</li>
<li><code>message</code> (string): A human-readable description of the error.</li>
<li><code>subErrors</code> (array of errors): Optional. Lists the detailed causes of the main error, if any.</li>
</ul>
</div><aside><p>TODO: example</p>
</aside></section><section><h2>Simple types</h2><section><h3><a id="data-structure-identity"></a>Item identity</h3><div class="content"><p>A string value uniquely identifying an item of a given type (e.g. channel, event) for a given user. For some types of items ("structural" ones such as channels and folders), it is allowed for the identity to be optionally set by API clients; otherwise the identity is generated by the server as an alphanumeric string.</p>
</div></section><section><h3><a id="data-structure-timestamp"></a>Timestamp</h3><div class="content"><p>A positive floating-point number representing a number of seconds since any reference date and time, <strong>independently from the time zone</strong>. Because date and time synchronization between server time and client time is done by the client simply comparing the current server timestamp with its own, the reference date and time does not matter.</p>
</div><aside><p>Some examples of getting a valid timestamp in various environments:</p>
<ul>
<li>JavaScript: <code>Date.now() / 1000</code></li>
<li>PHP (5+): <code>microtime(true)</code></li>
<li>TODO: more examples</li>
</ul>
</aside></section><section><h3><a id="data-structure-language-code"></a>Two-letter ISO language code</h3><div class="content"><p>A two-letter string specifying a language following the ISO 639-1 standard (see <a href="http://en.wikipedia.org/wiki/ISO_639-1">the related Wikipedia definition</a>).</p>
</div></section></section></section></div></div><div id="toc"></div><script>jQuery(document).ready(function($) {
  $('#toc').toc({
    'selectors': 'h1,h2',
    'container': '#sections',
    'smoothScrolling': false,
    'prefix': 'toc',
    'onHighlight': function(el) {},
    'highlightOnScroll': true,
    'highlightOffset': 100,
    'anchorName': function(i, heading, prefix) {
      var $heading = $(heading),
          sectionId = $heading.parents('section[id]').attr('id');
      return sectionId + ($heading.is('h1') ? '' : '-' + slugify($heading.text()));
    },
    'headerText': function(i, heading, $heading) {
      return $heading.text();
    }
  });
  
  function slugify(text) {
    return text.toLowerCase().replace(/[^\w ]+/g,'').replace(/ +/g,'-');
  }
});</script></body></html>