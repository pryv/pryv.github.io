<h1>THIS SECTION IS OBSOLETE AS OF API v0.5; TODO: update</h1>
<h1>Custom</h1>
<p>Implementing the authorization process and obtaining an access token all by yourself.</p>
<p><strong>For testing: </strong>
Use our staging servers: <a href="https://access.rec.la/access">https://access.rec.la/access</a></p>
<p><strong>Steps: </strong></p>
<ol>
<li>start an access request by calling <strong>POST <a href="https://access.pryv.io/access">https://access.pryv.io/access</a></strong></li>
<li>open <strong>response.url</strong>  in a webview</li>
<li>poll <strong>response.pollurl</strong> ï»¿until you get the an ACCEPTED / REFUSED or ERROR status</li>
</ol>
<h2>Sequence diagram</h2>
<p><img src="app-access-files/custom-sequence.png" alt="Sequence Diagram"></p>
<h2>Json Examples</h2>
<p>You can reporoduce this examples and try other combinations
from <a href="https://sw.rec.la/access/test.html"><a href="https://sw.rec.la/access/test.html">https://sw.rec.la/access/test.html</a></a></p>
<h3>Access request</h3>
<p><strong>request</strong>: <code>POST https://reg.rec.la/access</code>
<strong>payload</strong>:</p>
<pre class="highlighted"><code class="json">{
  "<span class="attribute">requestingAppId</span>": <span class="value"><span class="string">"web-page-test"</span></span>,
  "<span class="attribute">requestedPermissions</span>": <span class="value">[
    {
      "<span class="attribute">channelId</span>": <span class="value"><span class="string">"diary"</span></span>,
      "<span class="attribute">defaultName</span>": <span class="value"><span class="string">"Journal"</span></span>,
      "<span class="attribute">level</span>": <span class="value"><span class="string">"read"</span></span>,
      "<span class="attribute">folderPermissions</span>": <span class="value">[
        {
          "<span class="attribute">folderId</span>": <span class="value"><span class="string">"notes"</span></span>,
          "<span class="attribute">level</span>": <span class="value"><span class="string">"manage"</span></span>,
          "<span class="attribute">defaultName</span>": <span class="value"><span class="string">"Notes"</span>
        }</span>
      ]
    }</span>,
    {
      "<span class="attribute">channelId</span>": <span class="value"><span class="string">"position"</span></span>,
      "<span class="attribute">defaultName</span>": <span class="value"><span class="string">"Position"</span></span>,
      "<span class="attribute">level</span>": <span class="value"><span class="string">"read"</span></span>,
      "<span class="attribute">folderPermissions</span>": <span class="value">[
        {
          "<span class="attribute">folderId</span>": <span class="value"><span class="string">"iphone"</span></span>,
          "<span class="attribute">level</span>": <span class="value"><span class="string">"manage"</span></span>,
          "<span class="attribute">defaultName</span>": <span class="value"><span class="string">"iPhone"</span>
        }</span>
      ]
    }</span>
  ]</span>,
  "<span class="attribute">languageCode</span>": <span class="value"><span class="string">"en"</span></span>,
  "<span class="attribute">returnURL</span>": <span class="value"><span class="literal">false</span>
}</span></code></pre>
<p><strong>response</strong>:</p>
<pre class="highlighted"><code class="perl">{
  <span class="string">"status"</span>: <span class="string">"NEED_SIGNIN"</span>,
  <span class="string">"code"</span>: <span class="number">201</span>,
  <span class="string">"key"</span>: <span class="string">"dXRqBezem8v3mNxf"</span>,
  <span class="string">"requestingAppId"</span>: <span class="string">"web-page-test"</span>,
  <span class="string">"requestedPermissions"</span>: [
    {
      <span class="string">"channelId"</span>: <span class="string">"diary"</span>,
      <span class="string">"defaultName"</span>: <span class="string">"Journal"</span>,
      <span class="string">"level"</span>: <span class="string">"read"</span>,
      <span class="string">"folderPermissions"</span>: [
        {
          <span class="string">"folderId"</span>: <span class="string">"notes"</span>,
          <span class="string">"level"</span>: <span class="string">"manage"</span>,
          <span class="string">"defaultName"</span>: <span class="string">"Notes"</span>
        }
      ]
    },
    {
      <span class="string">"channelId"</span>: <span class="string">"position"</span>,
      <span class="string">"defaultName"</span>: <span class="string">"Position"</span>,
      <span class="string">"level"</span>: <span class="string">"read"</span>,
      <span class="string">"folderPermissions"</span>: [
        {
          <span class="string">"folderId"</span>: <span class="string">"iphone"</span>,
          <span class="string">"level"</span>: <span class="string">"manage"</span>,
          <span class="string">"defaultName"</span>: <span class="string">"iPhone"</span>
        }
      ]
    }
  ],
  <span class="string">"url"</span>: <span class="string">"https://sw.rec.la:2443/access/v1/access.html?lang=en&amp;key=dXRqBezem8v3mNxf&amp;requestingAppId=web-page-test&amp;returnURL=false&amp;domain=rec.la&amp;registerURL=https<span class="variable">%3A</span><span class="variable">%2F</span><span class="variable">%2Freg</span>.rec.la<span class="variable">%3A443</span>&amp;requestedPermissions=<span class="variable">%5B</span><span class="variable">%7B</span><span class="variable">%22channelId</span><span class="variable">%22</span><span class="variable">%3A</span><span class="variable">%22diary</span><span class="variable">%22</span><span class="variable">%2C</span><span class="variable">%22defaultName</span><span class="variable">%22</span><span class="variable">%3A</span><span class="variable">%22Journal</span><span class="variable">%22</span><span class="variable">%2C</span><span class="variable">%22level</span><span class="variable">%22</span><span class="variable">%3A</span><span class="variable">%22read</span><span class="variable">%22</span><span class="variable">%2C</span><span class="variable">%22folderPermissions</span><span class="variable">%22</span><span class="variable">%3A</span><span class="variable">%5B</span><span class="variable">%7B</span><span class="variable">%22folderId</span><span class="variable">%22</span><span class="variable">%3A</span><span class="variable">%22notes</span><span class="variable">%22</span><span class="variable">%2C</span><span class="variable">%22level</span><span class="variable">%22</span><span class="variable">%3A</span><span class="variable">%22manage</span><span class="variable">%22</span><span class="variable">%2C</span><span class="variable">%22defaultName</span><span class="variable">%22</span><span class="variable">%3A</span><span class="variable">%22Notes</span><span class="variable">%22</span><span class="variable">%7D</span><span class="variable">%5D</span><span class="variable">%7D</span><span class="variable">%2C</span><span class="variable">%7B</span><span class="variable">%22channelId</span><span class="variable">%22</span><span class="variable">%3A</span><span class="variable">%22position</span><span class="variable">%22</span><span class="variable">%2C</span><span class="variable">%22defaultName</span><span class="variable">%22</span><span class="variable">%3A</span><span class="variable">%22Position</span><span class="variable">%22</span><span class="variable">%2C</span><span class="variable">%22level</span><span class="variable">%22</span><span class="variable">%3A</span><span class="variable">%22read</span><span class="variable">%22</span><span class="variable">%2C</span><span class="variable">%22folderPermissions</span><span class="variable">%22</span><span class="variable">%3A</span><span class="variable">%5B</span><span class="variable">%7B</span><span class="variable">%22folderId</span><span class="variable">%22</span><span class="variable">%3A</span><span class="variable">%22iphone</span><span class="variable">%22</span><span class="variable">%2C</span><span class="variable">%22level</span><span class="variable">%22</span><span class="variable">%3A</span><span class="variable">%22manage</span><span class="variable">%22</span><span class="variable">%2C</span><span class="variable">%22defaultName</span><span class="variable">%22</span><span class="variable">%3A</span><span class="variable">%22iPhone</span><span class="variable">%22</span><span class="variable">%7D</span><span class="variable">%5D</span><span class="variable">%7D</span><span class="variable">%5D</span>"</span>,
  <span class="string">"poll"</span>: <span class="string">"https://reg.rec.la:443/access/dXRqBezem8v3mNxf"</span>,
  <span class="string">"returnURL"</span>: false,
  <span class="string">"poll_rate_ms"</span>: <span class="number">1000</span>
}</code></pre>
<h3>Polling</h3>
<p><strong>request</strong>: GET <code>https://reg.rec.la/access/dXRqBezem8v3mNxf</code></p>
<p>3 response codes:</p>
<p><strong>1 response</strong>: <code>NEED_SIGNIN</code></p>
<p>Content is the same than for the initial POST request.
<strong>poll</strong> and <strong>poll_rate_ms</strong> may vary</p>
<p><strong>2 response</strong>: 200 <code>ACCEPTED</code></p>
<pre class="highlighted"><code class="json">{
  "<span class="attribute">status</span>": <span class="value"><span class="string">"ACCEPTED"</span></span>,
  "<span class="attribute">username</span>": <span class="value"><span class="string">"jondoe"</span></span>,
  "<span class="attribute">token</span>": <span class="value"><span class="string">"VTR7DOKN1J"</span></span>,
  "<span class="attribute">code</span>": <span class="value"><span class="number">200</span>
}</span></code></pre>
<p><strong>3 response</strong>: 403 <code>REFUSED</code></p>
<pre class="highlighted"><code class="json">{
  "<span class="attribute">status</span>": <span class="value"><span class="string">"REFUSED"</span></span>,
  "<span class="attribute">reasonID</span>": <span class="value"><span class="string">"REFUSED_BY_USER"</span></span>,
  "<span class="attribute">message</span>": <span class="value"><span class="string">"access refused by user"</span></span>,
  "<span class="attribute">code</span>": <span class="value"><span class="number">403</span>
}</span></code></pre>
