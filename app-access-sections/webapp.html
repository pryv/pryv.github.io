<html><head></head><body><h1>Web app (Javascript)</h1>
<p>Obtaining an access token for your web app.


</p>
<h2>What you need</h2>
<ul>
<li>make sure you got the <a href="#intro-initial-requirements">initial requirements</a> ready.</li>
<li>include the following script in your page:<ul>
<li>Staging version (recommended at the moment):<pre class="highlighted"><code class="language-html xml"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"https://sw.rec.la:2443/access/v0/pryv-access-sdk.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></code></pre>
</li>
<li>Production version:<pre class="highlighted"><code class="language-html xml"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"https://sw.pryv.io/access/v0/pryv-access-sdk.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></code></pre>
</li>
<li>or the optimized CloudFront cache:<pre class="highlighted"><code class="language-html xml"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"//dlw0lofo79is5.cloudfront.net/sdk-access-webapp/v0/pryv-access-sdk.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></code></pre>
</li>
</ul>
</li>
<li>construct a <code>settings</code> JSON object</li>
<li>call <code>pryvAccess.setup(settings)</code></li>
</ul>
<p>For a more fleshed-out example look at the source code of <a href="https://sw.rec.la:2443/access/demo.html"></a><a href="https://sw.rec.la:2443/access/demo.html">https://sw.rec.la:2443/access/demo.html</a>.

</p>
<p><a name="webapp.test"></a>Or make your own tests from the page:
<a href="https://sw.rec.la:2443/access/test.html"></a><a href="https://sw.rec.la:2443/access/test.html">https://sw.rec.la:2443/access/test.html</a>


</p>
<h3>Exemple: Minimalistic</h3>
<p>This app requests a "contribute" access to the "diary" channel, using the PrYv button and a popup for sign-in.

</p>
<p><strong>TODO: review this code</strong>

</p>
<pre class="highlighted"><code class="xml">```html
<span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;<span class="title">html</span>&gt;</span>
<span class="tag">&lt;<span class="title">head</span>&gt;</span>
<span class="tag">&lt;<span class="title">title</span>&gt;</span>Minimalistic example<span class="tag">&lt;/<span class="title">title</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"//dlw0lofo79is5.cloudfront.net/sdk-access-webapp/v0/pryv-access-sdk.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
<span class="tag">&lt;/<span class="title">head</span>&gt;</span>
<span class="tag">&lt;<span class="title">body</span>&gt;</span>
    <span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript">

    <span class="function"><span class="keyword">function</span> <span class="title">callMeWithCredentials</span><span class="params">(username, appToken, languageCode)</span> {</span>
        alert(<span class="string">"SUCCESS! username:"</span> + username + <span class="string">" appToken:"</span> + 
                appToken + <span class="string">" language:"</span> + languageCode);
    }

    <span class="keyword">var</span> requestedPermissions = [{<span class="string">"channelId"</span> : <span class="string">"diary"</span>,
                                     <span class="string">"level"</span> : <span class="string">"contribute"</span>}];

    pryvAccess.setup({
        requestingAppId : <span class="string">'Minimalistic Exemple For SDK Access'</span>,
        requestedPermissions : requestedPermissions,
        returnURL: <span class="string">'auto#'</span>,
        spanButtonID : <span class="string">'pryvButton'</span>,
        callbacks : callMeWithCredentials
    });

    </span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
    <span class="tag">&lt;<span class="title">span</span> <span class="attribute">id</span>=<span class="value">'pryvButton'</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span>
<span class="tag">&lt;/<span class="title">body</span>&gt;</span>
<span class="tag">&lt;/<span class="title">html</span>&gt;</span>
```</code></pre>
<h2>pryvAccess.setup(settings)</h2>
<p>The <strong>settings</strong> object supports the following parameters:

</p>
<ul>
<li><code>requestingAppId</code> (string): Unique. Given by PrYv identifier for this app. It will be the key for the requested set of permission after user agreement.</li>
<li><code>languageCode</code>(2 characters ISO 639-1 Code): Optional. If known the current language used by the user. This will influence the signin and register interface language.</li>
<li><code>requestedPermissions</code> (object): The requested set of permissions to access user's channels &amp; folders.</li>
<li><code>returnURL</code> (url or 'auto<extra>'): Optional. If you don't want (or can't have) the popup signin-process and prefer set a returnURL. This URL will be called at the en of the SIGNIN process.This provides a better user experience on mobile devices. Details: <a href="#webapp.returnURL">settings.returnURL</a></extra></li>
<li><code>spanButtonID</code> (string) Optional. The id of a <code>&lt;span /&gt;</code> element in the DOM of your web page. Details: <a href="#webapp.spanButtonID">settings.spanButtonID</a></li>
<li><code>callbacks</code> (functionS): called on each step of the sign-in process. Most of them are optional if you decided to rely on PrYv signin Button. All are optional excepted "accepted". Details: <a href="#webapp.callbacks">settings.callbacks</a><ul>
<li><code>initialization</code> (function()): When the initialization process is started. You may display a "loading" animation or for the user.</li>
<li><code>needSignin</code> (function(popupUrl,pollUrl,pollRateMs)): Optional. Triggered when the user need to be redirected to PrYv Signin or register from.<ul>
<li>param <code>popupUrl</code> (string): The URL to open in it's own window and to present to the user.</li>
<li>param <code>pollUrl</code> (string): The URL to poll regularly in the background to grab the result of the sigin process.</li>
<li>param <code>pollRateMs</code> (int): The minimum interval in milliseconds between to polling.</li>
</ul>
</li>
<li><code>accepted</code> (function(username,appToken)): <strong>Mandatory</strong>. Called when the signin process succeed and the permissions requested a granted.</li>
<li><code>refused</code> (function(reason)): called when the user refuse to grant the requested permissions.<ul>
<li>param <code>reason</code>(string): Technical information on how the user refused (not to be displayed).</li>
</ul>
</li>
<li><code>error</code> (function(pryvError)): called when an error interupting the signup process occured.<ul>
<li>param <code>pryvError</code> (object): <code>{id: .., message: .., detail: ..}</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><a name="webapp.returnURL"></a> settings.returnURL : Popup or URL Callback</h3>
<p>During the authentication process, we need to open a PrYv access web page in a separate window. This is in order to secure personal user's information.  

</p>
<p>This window can be opened in:

</p>
<ul>
<li>A popup, leaving the actual window open behind. This should be more comfortable on desktop browsers.</li>
<li>In place of the actual window, the user goes thru the process and come back to the URL you set at the end of the process.</li>
</ul>
<h4>* Popup</h4>
<p>If you want the authorization process to take place in a popup just set the <code>returnURL</code> settings to <code>false</code>.

</p>
<h4>* Self or Auto</h4>
<p>If you want the authorization process to take place in the same windows, returning to this same exact url you can use <code>self[extra_params]&lt;trailer&gt;</code> or <code>auto[extra_params]&lt;trailer&gt;</code>.

</p>
<p>When the user returns to this same page, the pryv-access-sdk will parse <code>prYv</code> parameters.

</p>
<ul>
<li>command<ul>
<li><strong>self</strong>: Use the current page as returnURL value</li>
<li><strong>auto</strong>: (prefered method) Use a returnURL when a mobile or tablet browser is detected and a popupOtherwise</li>
</ul>
</li>
<li>parameters<ul>
<li><strong>&lt;trailer&gt;</strong>: one of <code>?</code>, a <code>#</code> or a <code>&amp;</code></li>
<li><strong>[extra_parms]</strong>: Use this space (uri_encoded) as a custom payload for the returning user.</li>
</ul>
</li>
</ul>
<p>EXEMPLES

</p>
<ul>
<li><p>with <code>https://mysite.com/page.php</code> as source URL.</p>
<ul>
<li><strong>self#</strong> -&gt; <code>https://mysite.com/page.php#prYvkey=JDJKhadja&amp;prYvstatus=...</code></li>
<li><strong>self?</strong> -&gt; <code>https://mysite.com/page.php?prYvkey=JDJKhadja&amp;prYvstatus=...</code></li>
<li><strong>self?mycustom=A&amp;</strong> -&gt; <code>https://mysite.com/page.php?mycustom=A&amp;prYvkey=JDJKh...</code></li>
<li><strong>auto?mobile=1&amp;</strong> (if mobile) -&gt; <code>https://mysite.com/page.php?mobile=1&amp;prYvkey=JD...</code></li>
</ul>
</li>
<li><p>with <code>https://mysite.com/page.php?mycustom=1</code> as source URL.</p>
<ul>
<li><strong>self&amp;</strong> -&gt; <code>https://mysite.com/page.php?mycustom=1&amp;prYvk...</code></li>
</ul>
</li>
</ul>
<p>Make your own tests from the <a href="webapp.test">test page</a>.

</p>
<h4>* Custom</h4>
<p>Set the return URL to your own page such as

</p>
<pre class="highlighted"><code class="avrasm"><span class="label">https:</span>//www<span class="preprocessor">.mysite</span><span class="preprocessor">.com</span>/end-of-pryvAccess-process<span class="preprocessor">.php</span>?</code></pre>
<p><strong>Attention!!</strong> The url submitted <em>must</em> end with a <code>?</code>, a <code>#</code> or a <code>&amp;</code>
Returned status will be appended to this URL.

</p>
<h4>Exemples of return URL</h4>
<p>ACCEPTED

</p>
<pre class="highlighted"><code class="avrasm">    https://www<span class="preprocessor">.mysite</span><span class="preprocessor">.com</span>/end-of-pryvAccess-process<span class="preprocessor">.php</span>?
prYvkey=GSbdasjgdv&amp;prYvstatus=ACCEPTED&amp;prYvusername=yacinthe&amp;prYvtoken=VVhjDJDDG</code></pre>
<p>REFUSED

</p>
<pre class="highlighted"><code class="avrasm">    https://www<span class="preprocessor">.mysite</span><span class="preprocessor">.com</span>/end-of-pryvAccess-process<span class="preprocessor">.php</span>?
prYvkey=GSbdasjgdv&amp;prYvstatus=REFUSED&amp;prYvmessage=refused+by+user</code></pre>
<p>ERROR

</p>
<pre class="highlighted"><code class="r">    https://www.mysite.com/end-of-pryvAccess-process.php?
prYvkey=GSbdasjgdv&amp;prYvstatus=ERROR&amp;prYvid=INTERNAL_ERROR&amp;prYvmessage=<span class="keyword">...</span></code></pre>
<h3><a name="webapp.spanButtonID"></a> settings.spanButtonID : Rely on PrYv standard Button</h3>
<p>TODO

</p>
<h3><a name="webapp.callbacks"></a> settings.callbacks Custom handling of the signin process</h3>
<p>TODO

</p>
<h2>pryvAccess.popupLogin()</h2>
<p>Once setup is done, you can trigger the populLogin window from your own button.<br />Note: Trigger it from a user-click event.

</p>
<h2>pryvAccess.logout()</h2>
<p>Once setup is done, and user logged in. Erase current credential and restart setup with the same settings.

</p>
<h2>pryvAccess.retry()</h2>
<p>If a user refused to grant access, restart the setup process with the same settings. 

</p>
<h2>Other Examples</h2>
<h3>Full</h3>
</body></html>