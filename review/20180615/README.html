<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui">
    <title>Get started with Pryv.IO API</title>
    <link type="text/css" rel="stylesheet" href="assets/css/github-markdown.css">
    <link type="text/css" rel="stylesheet" href="assets/css/pilcrow.css">
    <link type="text/css" rel="stylesheet" href="assets/css/hljs-github.min.css"/>
    <link type="text/css" rel="stylesheet" href="assets/css/pryv.css"/>
  </head>
  <body>
    <article class="markdown-body"><link rel="stylesheet" href="http://api.pryv.com/assets/style.css">

<h1 id="get-started-with-pryv.io-api"><a class="header-link" href="#get-started-with-pryv.io-api"></a>Get started with Pryv.IO API</h1>
<p>In this tutorial, we will help you to try out and evaluate Pryv API for your projects.</p>
<p>Throughout all the steps, we will use <strong>Pryv.me</strong>, our <a href="http://pryv.com/pryvlab/">Lab platform</a> for testing Pryv API.</p>
<p>We will guide you through:</p>
<ol class="list">
<li><a href="#user-creation">User creation</a></li>
<li><a href="#data-model">Data model</a></li>
<li><a href="#authorize-your-application">Authorizing your application</a></li>
<li><a href="#crud-operations">CRUD operations</a></li>
<li><a href="#access-management">Access management</a></li>
</ol>
<h2 id="user-creation"><a class="header-link" href="#user-creation"></a>User creation</h2>
<p>By registering in <strong>Pryv.me</strong>, you will have access to a Pryv user and a fully-functional Pryv.IO environment hosted in our infrastructure which is free for testing.</p>
<ol class="list">
<li>Go to <a href="https://sw.pryv.me/access/register.html">https://sw.pryv.me/access/register.html</a></li>
<li>Fill in the form, choose where you want to store your data <img src="http://api.pryv.com/concepts/#servers" alt="data locality"> and click on <strong>Create</strong></li>
</ol>
<p>That&#39;s it! You will receive a welcome email from Pryv.me with your account details.</p>
<h3 id="sign-in-with-your-pryv.me-user"><a class="header-link" href="#sign-in-with-your-pryv.me-user"></a>Sign-in with your Pryv.me user</h3>
<p>Go to the following address to sign-in with your Pryv account :</p>
<p><code>https://{username}.pryv.me/#/SignIn</code></p>
<p>You have now access to your Pryv account through the Pryv.IO demo dashboard.</p>
<p>As shown below, the Streams for this account are listed, especially a default Stream which is automatically created for you:  <code>Diary</code>.</p>
<p class="img-container"><img src="images/streams_dashboard.png" alt="stream_dashboard"></p>
<h2 id="data-model"><a class="header-link" href="#data-model"></a>Data model</h2>
<p>Pryv.IO data model is composed mainly by two entities: <strong>Events</strong> and <strong>Streams</strong>.</p>
<p>On the picture below, you can see an example of two Pryv.IO user accounts and their respective Streams, which store Events on a time scale.</p>
<p class="img-container"><img src="images/PryvIO.png" alt="data_model"></p>
<h3 id="events"><a class="header-link" href="#events"></a>Events</h3>
<p>Events are the primary units of content in Pryv. An event is a timestamped piece of typed data.</p>
<p>Here an example of an Event :</p>
<pre class="hljs"><code>{
  <span class="hljs-attr">"streamId"</span>: <span class="hljs-string">"heartRate"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"blood-pressure/mmhg-bpm"</span>,
  <span class="hljs-attr">"content"</span>:
  {
    <span class="hljs-attr">"rate"</span>: <span class="hljs-number">90</span>,
    <span class="hljs-attr">"systolic"</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">"diastolic"</span>: <span class="hljs-number">60</span>
  },
  <span class="hljs-attr">"time"</span>: <span class="hljs-number">1528446260.693</span>,
  <span class="hljs-attr">"tags"</span>: [],
  <span class="hljs-attr">"created"</span>: <span class="hljs-number">1528446260.693</span>,
  <span class="hljs-attr">"createdBy"</span>: <span class="hljs-string">"cji5os3u11ntt0b40tg0xhfea"</span>,
  <span class="hljs-attr">"modified"</span>: <span class="hljs-number">1528446260.693</span>,
  <span class="hljs-attr">"modifiedBy"</span>: <span class="hljs-string">"cji5os3u11ntt0b40tg0xhfea"</span>,
  <span class="hljs-attr">"id"</span>: <span class="hljs-string">"cji5pfumt1nu90b40chlpetyp"</span>
}</code></pre><p>Events can be of severals type. See all <a href="http://api.pryv.com/event-types/#directory">standard event types</a> and the <a href="http://api.pryv.com/reference/#event">events API reference</a> in details.</p>
<h3 id="streams"><a class="header-link" href="#streams"></a>Streams</h3>
<p>Streams are the fundamental contexts in which events occur. Every event occurs in one stream. Streams follow a hierarchical structure—streams can have sub-streams—and usually match either user/app-specific organizational levels (e.g. life journal, work projects, etc.) or data sources (e.g. apps and/or devices).</p>
<p>Here an example of a Streams with childrens :</p>
<pre class="hljs"><code>{
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Pulse Oximeter"</span>,
  <span class="hljs-attr">"parentId"</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">"created"</span>: <span class="hljs-number">1528445539.785</span>,
  <span class="hljs-attr">"createdBy"</span>: <span class="hljs-string">"cji5os3u11ntt0b40tg0xhfea"</span>,
  <span class="hljs-attr">"modified"</span>: <span class="hljs-number">1528445581.592</span>,
  <span class="hljs-attr">"modifiedBy"</span>: <span class="hljs-string">"cjhagb5up1b950b40xsbeh5yj"</span>,
  <span class="hljs-attr">"clientData"</span>:
  {
    <span class="hljs-attr">"pryv-browser:bgColor"</span>: <span class="hljs-string">"#e81034"</span>
  },
  <span class="hljs-attr">"id"</span>: <span class="hljs-string">"pulseOximeter"</span>,
  <span class="hljs-attr">"children"</span>: [
    {
      <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Heart"</span>,
      <span class="hljs-attr">"parentId"</span>: <span class="hljs-string">"pulseOximeter"</span>,
      <span class="hljs-attr">"created"</span>: <span class="hljs-number">1528445684.508</span>,
      <span class="hljs-attr">"createdBy"</span>: <span class="hljs-string">"cji5os3u11ntt0b40tg0xhfea"</span>,
      <span class="hljs-attr">"modified"</span>: <span class="hljs-number">1528445684.508</span>,
      <span class="hljs-attr">"modifiedBy"</span>: <span class="hljs-string">"cji5os3u11ntt0b40tg0xhfea"</span>,
      <span class="hljs-attr">"id"</span>: <span class="hljs-string">"heart"</span>,
      <span class="hljs-attr">"children"</span>: [
        {
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Heart Rate"</span>,
          <span class="hljs-attr">"parentId"</span>: <span class="hljs-string">"heart"</span>,
          <span class="hljs-attr">"created"</span>: <span class="hljs-number">1528445704.807</span>,
          <span class="hljs-attr">"createdBy"</span>: <span class="hljs-string">"cji5os3u11ntt0b40tg0xhfea"</span>,
          <span class="hljs-attr">"modified"</span>: <span class="hljs-number">1528445704.807</span>,
          <span class="hljs-attr">"modifiedBy"</span>: <span class="hljs-string">"cji5os3u11ntt0b40tg0xhfea"</span>,
          <span class="hljs-attr">"id"</span>: <span class="hljs-string">"heartRate"</span>,
          <span class="hljs-attr">"children"</span>: []
        }
      ]
    }
  ]
}</code></pre><p>Let&#39;s now illustrate the Pryv.IO data model through a concret example of the Pryv account of an athlete, who is using four applications. All applications act as data source to this Pryv account.</p>
<p>The applications are the followings, three of them collect data from connected devices :</p>
<ul class="list">
<li>Nutrition mobile app: Allows to track the consumption of various types of food (<code>calories ingested</code>)</li>
<li>Connected smartwatch <code>A</code>: Used to monitor performances during the training (<code>calories burned</code>, <code>pulse rate</code>)</li>
<li>Connected smartwatch <code>B</code>: Linked to the same application but only used to monitor the <code>calories burned</code> during the daily life</li>
<li>Connected pulse oximeter: Used at home to check the health of the heart (<code>pulse rate</code>, <code>blood oxygenation=SpO2</code>)</li>
</ul>
<p>Here is a list of data generated by the applications and their corresponding Pryv types :</p>
<table>
<thead>
<tr>
<th>Data</th>
<th style="text-align:left">Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>Heart rate</td>
<td style="text-align:left"><code>frequency/bpm</code></td>
</tr>
<tr>
<td>Blood oxygenation</td>
<td style="text-align:left"><code>oxygen-rate/spo2</code></td>
</tr>
<tr>
<td>Nutrition</td>
<td style="text-align:left"><code>energy/calories</code></td>
</tr>
<tr>
<td>Physical activity</td>
<td style="text-align:left"><code>energy/calories</code></td>
</tr>
</tbody>
</table>
<p>For our example, we would recommend a Stream structure similar to the following :</p>
<p class="img-container"><img src="images/example_streams.png" alt="example_stream"></p>
<p>This Stream structure has multiple benefits:</p>
<ul class="list">
<li>Provides enough context to the data and thus avoids ambiguities :<ul class="list">
<li>between food consumption (<code>calories ingested</code>) and physical activity (<code>calories burned</code>)</li>
<li>between consumption of different food (<code>foodA</code>, <code>foodB</code>)</li>
</ul>
</li>
<li>Allows interoperability in the case of multiple devices that :<ul class="list">
<li>measure the same type of data through different apps (pulseOximeterApp/heart/heartRate, smartwatchApp/smartwatchA/heart/heartRate)</li>
<li>use the same app but measure different parameters (smartwatchApp/smartwatchA: heartRate + calories burned, smartwatchApp/smartwatchB: only calories burned)</li>
</ul>
</li>
</ul>
<h2 id="authorize-your-application"><a class="header-link" href="#authorize-your-application"></a>Authorize your application</h2>
<p>Continuing with our previous example, we would like the pulse oximeter application to be able to provision our Pryv.me account with Streams and Events.</p>
<p>For this purpose, the application first needs to request access to the Pryv account. We present below two methods to generate a new Access for our application, which materializes in the form of an app token.</p>
<p>We will describe <a href="Access management">Pryv Accesses</a> in more details later in this guide.</p>
<h3 id="use-pryv-access-token-generator"><a class="header-link" href="#use-pryv-access-token-generator"></a>Use Pryv Access Token Generator</h3>
<p>The easiest way to generate an app access token is to use the Pryv Access Token Generation page.</p>
<ol class="list">
<li><p>Go to <a href="http://pryv.github.io/app-web-access">http://pryv.github.io/app-web-access</a></p>
</li>
<li><p>Set up the required parameters</p>
</li>
<li><p>Enter the Application ID</p>
</li>
<li><p>Setup the Streams you want to grant access to in the permissions box</p>
</li>
</ol>
<p class="img-container"><img src="images/permissions_box.png" alt="permissions_box"></p>
<ul class="list">
<li><p>Click on <strong>Request Access</strong> button</p>
</li>
<li><p>Now click on <strong>Sign in</strong> button <img src="images/sign_in_button.png" alt="sign_in_button"> - A new tab will open</p>
</li>
<li><p>Sign in with your Pryv account</p>
</li>
</ul>
<p class="img-container"><img src="images/sign_in.png" width="400" height="400"></p>
<p>A popup will open to inform you about the access you are about to grant.</p>
<ul class="list">
<li>Click on <strong>Accept</strong> button</li>
</ul>
<p>By accepting, you consent that the <code>demopryv-access</code> application can access to the Stream <code>Pulse Oximeter</code> with a <code>manage</code> access-level. Since this Stream is not yet existing, it will be automatically created with a name corresponding to the <code>defaultName</code> parameter we provided above in the permissions box.</p>
<p>For now, you just have to understand that we are generating a token that gives enough permissions to interact with our Pryv account, in the scope of our example. You will learn more about Accesses in <a href="#access-management">Access management</a>. </p>
<p class="img-container"><img src="images/accept_button.png" width="400" height="400"></p>
<ul class="list">
<li><strong>Your access token have been generated</strong></li>
</ul>
<p class="img-container"><img src="images/access_token.png" alt="access_token"></p>
<h3 id="use-your-own-implementation"><a class="header-link" href="#use-your-own-implementation"></a>Use your own implementation</h3>
<p>Instead of using the token generator page, it is also possible to implement the authorization process on its own and obtain an access token by following the steps below.</p>
<details>
<summary>Details</summary>
<p>

1. Send an access request with a <code>POST</code> call to <code>https://access.${domain}/access</code> :

<del>~bash
curl -X POST <a href="https://reg.pryv.me/access">https://reg.pryv.me/access</a> -H &#39;Content-Type: application/json&#39; \
  -d &#39;{
  &quot;requestingAppId&quot;: &quot;demopryv-access&quot;,
  &quot;requestedPermissions&quot;: [
    {
      &quot;streamId&quot;: &quot;pulseOximeter&quot;,
      &quot;level&quot;: &quot;manage&quot;,
      &quot;defaultName&quot;: &quot;Pulse Oximeter&quot;
    }
  ],
  &quot;languageCode&quot;: &quot;fr&quot;,
  &quot;returnURL&quot;: false
}&#39;
~</del>

As a response, you should receive information similar to the following :
<del>~json
{
    &quot;status&quot;: &quot;NEED_SIGNIN&quot;,
    &quot;code&quot;: 201,
    &quot;key&quot;: &quot;Rp3NBpMBnkCOuuAo&quot;,
    &quot;requestingAppId&quot;: &quot;demopryv-access&quot;,
    &quot;requestedPermissions&quot;: [
        {
            &quot;streamId&quot;: &quot;pulseOximeter&quot;,
            &quot;level&quot;: &quot;manage&quot;,
            &quot;defaultName&quot;: &quot;Pulse Oximeter&quot;
        }
    ],
    &quot;url&quot;: &quot;<a href="https://sw.pryv.me/access/access.html?lang=fr&amp;key=Rp3NBpMBnkCOuuAo&amp;requestingAppId=demopryv-access&amp;returnURL=false&amp;domain=pryv.io&amp;registerURL=https%3A%2F%2Freg.pryv.me%3A443&amp;requestedPermissions=%5B%7B%22streamId%22%3A%22pulseOximeter%22%2C%22level%22%3A%22manage%22%2C%22defaultName%22%3A%22Pulse%20Oximeter%22%7D%5D&quot;">https://sw.pryv.me/access/access.html?lang=fr&amp;key=Rp3NBpMBnkCOuuAo&amp;requestingAppId=demopryv-access&amp;returnURL=false&amp;domain=pryv.io&amp;registerURL=https%3A%2F%2Freg.pryv.me%3A443&amp;requestedPermissions=%5B%7B%22streamId%22%3A%22pulseOximeter%22%2C%22level%22%3A%22manage%22%2C%22defaultName%22%3A%22Pulse%20Oximeter%22%7D%5D&quot;</a>,
    &quot;poll&quot;: &quot;<a href="https://reg.pryv.me:443/access/Rp3NBpMBnkCOuuAo&quot;">https://reg.pryv.me:443/access/Rp3NBpMBnkCOuuAo&quot;</a>,
    &quot;returnURL&quot;: false,
    &quot;poll_rate_ms&quot;: 1000
}
~</del>

- Get the url parameter from the previous response and copy it into your favorite browser.

<del>~raw
<a href="https://sw.pryv.me/access/access.html?lang=fr&amp;key=Rp3NBpMBnkCOuuAo&amp;requestingAppId=demopryv-access&amp;returnURL=false&amp;domain=pryv.io&amp;registerURL=https%3A%2F%2Freg.pryv.me%3A443&amp;requestedPermissions=%5B%7B%22streamId%22%3A%22diary%22%2C%22level%22%3A%22read%22%2C%22defaultName%22%3A%22diary%22%7D%5D">https://sw.pryv.me/access/access.html?lang=fr&amp;key=Rp3NBpMBnkCOuuAo&amp;requestingAppId=demopryv-access&amp;returnURL=false&amp;domain=pryv.io&amp;registerURL=https%3A%2F%2Freg.pryv.me%3A443&amp;requestedPermissions=%5B%7B%22streamId%22%3A%22diary%22%2C%22level%22%3A%22read%22%2C%22defaultName%22%3A%22diary%22%7D%5D</a>
~</del>

- Sign in with your Pryv account:

A popup will open to inform you about the access are about to grant.

- Click on <strong>Accept</strong> button


2. Retrieve the poll url from the previous response.

<del>~json
&quot;poll&quot;: &quot;<a href="https://reg.pryv.me:443/access/Rp3NBpMBnkCOuuAo&quot;">https://reg.pryv.me:443/access/Rp3NBpMBnkCOuuAo&quot;</a>
~</del>

3. Poll the access token with  <code>GET</code> calls to the polling url:

<del>~bash
curl -i GET <a href="https://reg.pryv.me:443/access/Rp3NBpMBnkCOuuAo">https://reg.pryv.me:443/access/Rp3NBpMBnkCOuuAo</a>
~</del>

Once the access is generated, you should get a response with status <em>Accepted</em> and containing the token :
<del>~json
{
    &quot;status&quot;: &quot;ACCEPTED&quot;,
    &quot;username&quot;: &quot;demopryv&quot;,
    &quot;token&quot;: &quot;cjhj7i2821eq60b40dzcdx6gt&quot;,
    &quot;code&quot;: 200
}
~</del>

</p>
</details>

<h2 id="crud-operations"><a class="header-link" href="#crud-operations"></a>CRUD operations</h2>
<p>Now that we generated an app token, we can use it against Pryv API to manipulate data of our Pryv account, still based on the example of our athlete.</p>
<h3 id="create-operations"><a class="header-link" href="#create-operations"></a>Create Operations</h3>
<h4 id="streams-1"><a class="header-link" href="#streams-1"></a>Streams</h4>
<p>First, let&#39;s setup the context for the pulse oximeter measures by attaching children Streams to the <code>pulseOximeter</code> root Stream.</p>
<p>We perform a <code>POST</code> call to the streams route, providing the <code>id</code> and <code>name</code> of the Stream to create and a <code>parentId</code>, the id of the parent Stream.</p>
<pre class="hljs"><code>curl -X POST \
  -H <span class="hljs-string">'https://${username}.${domain}/streams?auth=${token}'</span> \
  <span class="hljs-_">-d</span> <span class="hljs-string">'{
  "id":"heart",
  "name":"Heart",
  "parentId":"pulseOximeter"
}'</span></code></pre><p>Do the same for the <code>heartRate</code> Stream.</p>
<pre class="hljs"><code>curl -X POST \
  -H <span class="hljs-string">'https://${username}.${domain}/streams?auth=${token}'</span> \
  <span class="hljs-_">-d</span> <span class="hljs-string">'{
  "id":"heartRate",
  "name":"Heart Rate",
  "parentId":"heart"
}'</span></code></pre><h4 id="events-1"><a class="header-link" href="#events-1"></a>Events</h4>
<p>Once the Streams have been created, we can collect the pulse oximeter measures as Events.</p>
<p>Create an Event of type <code>frequency/bpm</code> with a pulse rate (integer) as content in the Stream <code>heartRate</code>.</p>
<pre class="hljs"><code>curl -X POST \
  -H <span class="hljs-string">'https://${username}.${domain}/events?auth=${token}'</span> \
  <span class="hljs-_">-d</span> <span class="hljs-string">'{
    "streamId": "heartRate",
    "type": "frequency/bpm",
    "content": 90
}'</span></code></pre><h3 id="read-operations"><a class="header-link" href="#read-operations"></a>Read Operations</h3>
<h4 id="streams-2"><a class="header-link" href="#streams-2"></a>Streams</h4>
<p>Use a <code>GET</code> call to retrieve the pulse oximeter Stream and its childrens.</p>
<pre class="hljs"><code>curl -i https://<span class="hljs-variable">${username}</span>.<span class="hljs-variable">${domain}</span>/streams?auth=<span class="hljs-variable">${token}</span></code></pre><p>Response :</p>
<pre class="hljs"><code>{
  <span class="hljs-attr">"streams"</span>: [
    {
      <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Pulse Oximeter"</span>,
      <span class="hljs-attr">"created"</span>: <span class="hljs-number">1528445539.785</span>,
      <span class="hljs-attr">"createdBy"</span>: <span class="hljs-string">"cji5os3u11ntt0b40tg0xhfea"</span>,
      <span class="hljs-attr">"modified"</span>: <span class="hljs-number">1528445581.592</span>,
      <span class="hljs-attr">"modifiedBy"</span>: <span class="hljs-string">"cjhagb5up1b950b40xsbeh5yj"</span>,
      <span class="hljs-attr">"clientData"</span>: {
        <span class="hljs-attr">"pryv-browser:bgColor"</span>: <span class="hljs-string">"#e81034"</span>
      },
      <span class="hljs-attr">"id"</span>: <span class="hljs-string">"pulseOximeter"</span>,
      <span class="hljs-attr">"children"</span>: [
        {
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Heart"</span>,
          <span class="hljs-attr">"parentId"</span>: <span class="hljs-string">"pulseOximeter"</span>,
          <span class="hljs-attr">"created"</span>: <span class="hljs-number">1528445684.508</span>,
          <span class="hljs-attr">"createdBy"</span>: <span class="hljs-string">"cji5os3u11ntt0b40tg0xhfea"</span>,
          <span class="hljs-attr">"modified"</span>: <span class="hljs-number">1528445684.508</span>,
          <span class="hljs-attr">"modifiedBy"</span>: <span class="hljs-string">"cji5os3u11ntt0b40tg0xhfea"</span>,
          <span class="hljs-attr">"id"</span>: <span class="hljs-string">"heart"</span>,
          <span class="hljs-attr">"children"</span>: [
            {
              <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Heart Rate"</span>,
              <span class="hljs-attr">"parentId"</span>: <span class="hljs-string">"heart"</span>,
              <span class="hljs-attr">"created"</span>: <span class="hljs-number">1528445704.807</span>,
              <span class="hljs-attr">"createdBy"</span>: <span class="hljs-string">"cji5os3u11ntt0b40tg0xhfea"</span>,
              <span class="hljs-attr">"modified"</span>: <span class="hljs-number">1528815172.551</span>,
              <span class="hljs-attr">"modifiedBy"</span>: <span class="hljs-string">"cji5os3u11ntt0b40tg0xhfea"</span>,
              <span class="hljs-attr">"id"</span>: <span class="hljs-string">"heartRate"</span>,
              <span class="hljs-attr">"children"</span>: [
              ]
            }
          ]
        }
      ]
    }
  ],
  <span class="hljs-attr">"meta"</span>: {
    <span class="hljs-attr">"apiVersion"</span>: <span class="hljs-string">"1.2.18"</span>,
    <span class="hljs-attr">"serverTime"</span>: <span class="hljs-number">1528815903.187</span>
  }
}</code></pre><h4 id="events-2"><a class="header-link" href="#events-2"></a>Events</h4>
<p>Similarly, retrieve all the pulse oximeter Events.</p>
<pre class="hljs"><code>curl -i https://<span class="hljs-variable">${username}</span>.<span class="hljs-variable">${domain}</span>/events?auth=<span class="hljs-variable">${token}</span></code></pre><p>Response :</p>
<pre class="hljs"><code>{
  <span class="hljs-attr">"events"</span>: [
    {
      <span class="hljs-attr">"streamId"</span>: <span class="hljs-string">"heartRate"</span>,
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"frequency/bpm"</span>,
      <span class="hljs-attr">"content"</span>: <span class="hljs-number">90</span>,
      <span class="hljs-attr">"time"</span>: <span class="hljs-number">1528447710.816</span>,
      <span class="hljs-attr">"tags"</span>: [
      ],
      <span class="hljs-attr">"created"</span>: <span class="hljs-number">1528447710.816</span>,
      <span class="hljs-attr">"createdBy"</span>: <span class="hljs-string">"cji5os3u11ntt0b40tg0xhfea"</span>,
      <span class="hljs-attr">"modified"</span>: <span class="hljs-number">1528447710.816</span>,
      <span class="hljs-attr">"modifiedBy"</span>: <span class="hljs-string">"cji5os3u11ntt0b40tg0xhfea"</span>,
      <span class="hljs-attr">"id"</span>: <span class="hljs-string">"cji5qaxk01nui0b40ec370p94"</span>
    }
  ],
  <span class="hljs-attr">"meta"</span>: {
    <span class="hljs-attr">"apiVersion"</span>: <span class="hljs-string">"1.2.18"</span>,
    <span class="hljs-attr">"serverTime"</span>: <span class="hljs-number">1528467864.397</span>
    }
}</code></pre><h3 id="update-operations"><a class="header-link" href="#update-operations"></a>Update Operations</h3>
<h4 id="events-3"><a class="header-link" href="#events-3"></a>Events</h4>
<p>Now, let&#39;s imagine we want to modify a pulse rate measure from the Stream <code>heartRate</code>.</p>
<p>First, retrieve the id of one Event to update from the previous responses of our Read operations.</p>
<pre class="hljs"><code><span class="hljs-variable">${event_id}</span> = cji5qaxk01nui0b40ec370p94</code></pre><p>Then, use a <code>PUT</code> call to update the Event with a new content value.</p>
<pre class="hljs"><code>curl -X PUT \
  -H <span class="hljs-string">'https://${username}.${domain}/events/${event_id}?auth=${token}'</span> \
  <span class="hljs-_">-d</span> <span class="hljs-string">'{
    "content": 80
    }'</span></code></pre><h4 id="streams-3"><a class="header-link" href="#streams-3"></a>Streams</h4>
<p>Similarly, if we want to update the Stream <code>heart</code> by changing its name, we first retrieve the id of the Stream we want to update.</p>
<pre class="hljs"><code><span class="hljs-variable">${streamId}</span> = heart</code></pre><p>Then, use a <code>PUT</code> call to update the name <code>Heart</code> to <code>Mike Heart</code>.</p>
<pre class="hljs"><code>curl -X PUT \
  -H <span class="hljs-string">'https://${username}.${domain}/streams/${streamId}?auth=${token}'</span> \
  <span class="hljs-_">-d</span> <span class="hljs-string">'
    {
        "name": "Mike Heart"
    }'</span></code></pre><h3 id="delete-operations"><a class="header-link" href="#delete-operations"></a>Delete Operations</h3>
<p>The delete operation is composed by 2 steps:</p>
<ul class="list">
<li>Trash</li>
<li>Delete</li>
</ul>
<p>When deleting an Event or a Stream, it is first flagged as trashed and irreversibly deleted only when repeating the delete operation a second time.</p>
<h4 id="events-4"><a class="header-link" href="#events-4"></a>Events</h4>
<p>For example, if we want to delete our pulse rate Event, we use a <code>DELETE</code> call to trash it first and a second same call to delete it completely.</p>
<p>First, we retrieve the id of the Event to delete.</p>
<pre class="hljs"><code><span class="hljs-variable">${event_id}</span> = cji5qaxk01nui0b40ec370p94</code></pre><p>Then, we trash the Event, it sets a <em>trashed</em> flag to <em>true</em>.</p>
<pre class="hljs"><code>curl -X DELETE \
  -H <span class="hljs-string">'https://${username}.${domain}/events/${event_id}?auth=${token}'</span></code></pre><p>Response</p>
<pre class="hljs"><code>{
    <span class="hljs-attr">"event"</span>: {
        <span class="hljs-attr">"streamId"</span>: <span class="hljs-string">"heart"</span>,
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"frequency/bpm"</span>,
        <span class="hljs-attr">"content"</span>: <span class="hljs-number">105</span>,
        <span class="hljs-attr">"time"</span>: <span class="hljs-number">1528878365.385</span>,
        <span class="hljs-attr">"tags"</span>: [],
        <span class="hljs-attr">"created"</span>: <span class="hljs-number">1528878365.385</span>,
        <span class="hljs-attr">"createdBy"</span>: <span class="hljs-string">"cji5os3u11ntt0b40tg0xhfea"</span>,
        <span class="hljs-attr">"modified"</span>: <span class="hljs-number">1528895740.264</span>,
        <span class="hljs-attr">"modifiedBy"</span>: <span class="hljs-string">"cjicv106i1q580b40678kjb17"</span>,
        <span class="hljs-attr">"trashed"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"cjicupcqx1q530b40oao5ob02"</span>
    },
    <span class="hljs-attr">"meta"</span>: {
        <span class="hljs-attr">"apiVersion"</span>: <span class="hljs-string">"1.2.18"</span>,
        <span class="hljs-attr">"serverTime"</span>: <span class="hljs-number">1528895740.267</span>
    }
}</code></pre><p>Deleting the event:</p>
<p>Finally, we delete the Event completely, it returns a list of deletion ids.</p>
<pre class="hljs"><code>curl -X DELETE \
  -H <span class="hljs-string">'https://${username}.${domain}/events/${event_id}?auth=${token}'</span></code></pre><p>Response :</p>
<pre class="hljs"><code>{
    <span class="hljs-attr">"eventDeletion"</span>: {
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"cji5qaxk01nui0b40ec370p94"</span>
    },
    <span class="hljs-attr">"meta"</span>: {
        <span class="hljs-attr">"apiVersion"</span>: <span class="hljs-string">"1.2.18"</span>,
        <span class="hljs-attr">"serverTime"</span>: <span class="hljs-number">1528817673.092</span>
    }
}</code></pre><h4 id="streams-4"><a class="header-link" href="#streams-4"></a>Streams</h4>
<p>Now, we will delete the Stream <code>heartRate</code>, the steps are similar to the ones for deleting an Event.</p>
<pre class="hljs"><code><span class="hljs-variable">${stream_id}</span> = heartRate</code></pre><p>We repeat the following command two times, one for trashing the stream and another for deleting it :</p>
<pre class="hljs"><code>curl -X DELETE \
  -H <span class="hljs-string">'https://${username}.${domain}/streams/${stream_id}?auth=${token}'</span></code></pre><p>When trying to delete the Stream, you may encounter the following error message:</p>
<pre class="hljs"><code>{
    <span class="hljs-attr">"error"</span>: {
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"invalid-parameters-format"</span>,
        <span class="hljs-attr">"message"</span>: <span class="hljs-string">"There are events referring to the deleted items and the `mergeEventsWithParent` parameter is missing."</span>
    },
    <span class="hljs-attr">"meta"</span>: {
        <span class="hljs-attr">"apiVersion"</span>: <span class="hljs-string">"1.2.18"</span>,
        <span class="hljs-attr">"serverTime"</span>: <span class="hljs-number">1528890640.148</span>
    }
}</code></pre><p>This means that the Stream you are trying to delete still contains some Events and Pryv.IO needs to know what to do with them. Thus, you need to provide the <code>mergeEventsWithParent</code> boolean as query parameter of your delete call. Set it to <em>true</em> if you want to merge the Events in the parent Stream or to <em>false</em> if you want to delete them aswell.</p>
<p>Here is the command for deleting the Stream and merging the Events in the parent Stream :</p>
<pre class="hljs"><code>curl -X DELETE \
  -H <span class="hljs-string">'https://${username}.${domain}/streams/${streamId}?auth=${token}&amp;mergeEventsWithParent=true'</span></code></pre><p>Response</p>
<pre class="hljs"><code>{
    <span class="hljs-attr">"streamDeletion"</span>: {
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"heartRate"</span>
    },
    <span class="hljs-attr">"meta"</span>: {
        <span class="hljs-attr">"apiVersion"</span>: <span class="hljs-string">"1.2.18"</span>,
        <span class="hljs-attr">"serverTime"</span>: <span class="hljs-number">1528890935.505</span>
    }
}</code></pre><h2 id="access-management"><a class="header-link" href="#access-management"></a>Access management</h2>
<p>In our previous examples, we used an app token corresponding to a new Access we generated at the end of the <a href="authorize-your-application">Authorization flow</a>. Beside that, the Pryv.IO allows you to manage Accesses also with calls agains the API.</p>
<p>Each Access is defined by a <code>name</code>, a <code>type</code> and a set of <code>permissions</code>.</p>
<p>There is three different Access types :</p>
<ul class="list">
<li>Shared: used for person-to-person sharing. They grant access to a specific set of data and/or with limited permission levels, depending on the sharing user&#39;s choice.</li>
<li>App: used by applications which don&#39;t need full, unrestricted access to the user&#39;s data. They grant access to a specific set of data and/or with limited permission levels (e.g. read-only), according to the app&#39;s needs. This is the type of access we used for our pulse oximeter application.</li>
<li>Personal: used by applications that need to access to the entirety of the user&#39;s data and/or manage account settings.</li>
</ul>
<p>If you create an Access but omit to provide its <code>type</code>, then it will be <code>shared</code> by default.</p>
<p>Each permission specifies a <code>streamId</code>, the id of the Stream to which we want to give access, and an access <code>level</code>, which can be one of the following:</p>
<ul class="list">
<li>Read: Enable users to view the stream and it content (sub-streams and events)</li>
<li>Contribute: Enable users to contribute to one or multiple events of the stream. Cannot create, update, delete and move streams.</li>
<li>Manage: Enable users to fully control the stream. Possibility to create, update, delete and move the stream.</li>
</ul>
<p>Finally, note that an existing Access can be used to create other Accesses, but only if the new Access has lower permissions (Shared &lt; App &lt; Personal and Read &lt; Contribute &lt; Manage). Also, an Access can create other Accesses only in the same scope, namely with permissions on the same Streams and their childrens.</p>
<h3 id="create-access"><a class="header-link" href="#create-access"></a>Create access</h3>
<p>Let&#39;s imagine we want to create a shared Access with <code>read</code> level for the <code>heartRate</code> Stream for our doctor.</p>
<p>Use a <code>POST</code> call to the accesses route to create the access :</p>
<pre class="hljs"><code>curl -X POST \
  -H <span class="hljs-string">'https://${username}.${domain}/accesses?auth=${token}'</span> \
  <span class="hljs-_">-d</span> <span class="hljs-string">'{
    "name":"For doctor",
    "permissions":
    [
        {
            "streamId":"heartRate",
            "level":"read",
            "type": "shared"
        }
    ]
}'</span></code></pre><p><strong>A new token has been generated four our new access</strong></p>
<h3 id="read-access"><a class="header-link" href="#read-access"></a>Read access</h3>
<p>Once the access has been created, we can retrieve the token by using the <code>GET</code> below :</p>
<pre class="hljs"><code>curl -i https://<span class="hljs-variable">${username}</span>.<span class="hljs-variable">${domain}</span>/accesses?auth=<span class="hljs-variable">${token}</span></code></pre><pre class="hljs"><code>{
    <span class="hljs-attr">"access"</span>: {
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"For doctor"</span>,
        <span class="hljs-attr">"permissions"</span>: [
            {
                <span class="hljs-attr">"streamId"</span>: <span class="hljs-string">"heartRate"</span>,
                <span class="hljs-attr">"level"</span>: <span class="hljs-string">"read"</span>
            }
        ],
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"shared"</span>,
        <span class="hljs-attr">"token"</span>: <span class="hljs-string">"cjicvd5gg1q5h0b40u8k0ng5d"</span>,
        <span class="hljs-attr">"created"</span>: <span class="hljs-number">1528879475.68</span>,
        <span class="hljs-attr">"createdBy"</span>: <span class="hljs-string">"cjicv333j1q5c0b40lsl6nwzu"</span>,
        <span class="hljs-attr">"modified"</span>: <span class="hljs-number">1528879475.68</span>,
        <span class="hljs-attr">"modifiedBy"</span>: <span class="hljs-string">"cjicv333j1q5c0b40lsl6nwzu"</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"cjicvd5gg1q5i0b40z0swq0cu"</span>
    },
    <span class="hljs-attr">"meta"</span>: {
        <span class="hljs-attr">"apiVersion"</span>: <span class="hljs-string">"1.2.18"</span>,
        <span class="hljs-attr">"serverTime"</span>: <span class="hljs-number">1528879475.682</span>
    }
}</code></pre><h3 id="update-access"><a class="header-link" href="#update-access"></a>Update access</h3>
<p>Let&#39;s now imagine that we want our doctor to be able not only to read our data but also to contribute to the <code>heartRate</code> Stream.</p>
<p>First, retrieve the <code>access_id</code> of the Access we want to update.</p>
<pre class="hljs"><code><span class="hljs-variable">${access_id}</span> = cjicvd5gg1q5i0b40z0swq0cu</code></pre><p>Then use the below <code>PUT /accesses</code> method to update Access permissions :</p>
<pre class="hljs"><code>curl -X PUT \
  -H <span class="hljs-string">'https://${username}.${domain}/accesses/${access_id}?auth=${token}'</span> \
  <span class="hljs-_">-d</span> <span class="hljs-string">'
  {
    "permissions":
    [
        {
        "level":"contribute",
        "streamId":"heartRate"
        }
    ]
}'</span></code></pre><h3 id="delete-access"><a class="header-link" href="#delete-access"></a>Delete access</h3>
<p>Finally, we want to revoke the Access we granted to the doctor.</p>
<p>Use the <code>DELETE / accesses</code> method to delete permanently the respective Access.</p>
<pre class="hljs"><code>curl -X DELETE \
  -H <span class="hljs-string">'https://${username}.${domain}/accesses/${access_id}?auth=${token}'</span></code></pre><p>Response</p>
<pre class="hljs"><code>{
    <span class="hljs-attr">"accessDeletion"</span>: {
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"cjicvd5gg1q5i0b40z0swq0cu"</span>
    },
    <span class="hljs-attr">"meta"</span>: {
        <span class="hljs-attr">"apiVersion"</span>: <span class="hljs-string">"1.2.18"</span>,
        <span class="hljs-attr">"serverTime"</span>: <span class="hljs-number">1528882357.205</span>
    }
}</code></pre><h3 id="slices-sharing"><a class="header-link" href="#slices-sharing"></a>Slices sharing</h3>
<p>As described above, shared Accesses are suitable for person-to-person sharing.</p>
<p>You can use them to share a subset of your data also via the Pryv dashboard: we call it a <em>shared slice</em>.</p>
<p>Follow the steps below to create a shared slice:</p>
<ol class="list">
<li>Go to your Pryv account</li>
</ol>
<pre class="hljs"><code>https://{username}.pryv.me/#/SignIn</code></pre><ol start="2">
<li>Click on <em>Share a slice</em> button <img src="images/share_slice_button.png" alt="share_slice_button"></li>
<li>Enter the slice name</li>
<li>Choose the permission level for the shared slice (Read, Contribute or Manage)</li>
<li>Select the Streams you want to give access to</li>
<li>Click on <strong>Share</strong> button <img src="images/share_button.png" alt="share_button"></li>
<li>Your slice has been created! You can share it with a contact.</li>
</ol>
<p class="img-container"><img src="images/shared_link.png" alt="shared_link"></p>
    </article>
  </body>
</html>
